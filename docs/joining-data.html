<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>6 Joining Data | Intermediate R</title>
  <meta name="description" content="6 Joining Data | Intermediate R" />
  <meta name="generator" content="bookdown 0.37 and GitBook 2.6.7" />

  <meta property="og:title" content="6 Joining Data | Intermediate R" />
  <meta property="og:type" content="book" />
  
  
  <meta name="github-repo" content="ucdavisdatalab/workshop_intermediate_r" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="6 Joining Data | Intermediate R" />
  
  
  

<meta name="author" content="Nick Ulle and Wesley Brooks" />


<meta name="date" content="2024-01-10" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="assessment.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="https://datalab.ucdavis.edu/">
  <img src="https://datalab.ucdavis.edu/wp-content/uploads/2019/07/datalab-logo-full-color-rgb-1.png" style="height: 100%; width: 100%; object-fit: contain" />
</a></li>
<li><a href="./" style="font-size: 18px">Intermediate R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Overview</a></li>
<li class="part"><span><b>I Thinking in R</b></span></li>
<li class="chapter" data-level="1" data-path="language-fundamentals.html"><a href="language-fundamentals.html"><i class="fa fa-check"></i><b>1</b> Language Fundamentals</a>
<ul>
<li class="chapter" data-level="1.1" data-path="language-fundamentals.html"><a href="language-fundamentals.html#variables-environments"><i class="fa fa-check"></i><b>1.1</b> Variables &amp; Environments</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="language-fundamentals.html"><a href="language-fundamentals.html#whats-an-environment"><i class="fa fa-check"></i><b>1.1.1</b> What’s an Environment?</a></li>
<li class="chapter" data-level="1.1.2" data-path="language-fundamentals.html"><a href="language-fundamentals.html#reference-objects"><i class="fa fa-check"></i><b>1.1.2</b> Reference Objects</a></li>
<li class="chapter" data-level="1.1.3" data-path="language-fundamentals.html"><a href="language-fundamentals.html#the-local-environment"><i class="fa fa-check"></i><b>1.1.3</b> The Local Environment</a></li>
<li class="chapter" data-level="1.1.4" data-path="language-fundamentals.html"><a href="language-fundamentals.html#call-environments"><i class="fa fa-check"></i><b>1.1.4</b> Call Environments</a></li>
<li class="chapter" data-level="1.1.5" data-path="language-fundamentals.html"><a href="language-fundamentals.html#lexical-scoping"><i class="fa fa-check"></i><b>1.1.5</b> Lexical Scoping</a></li>
<li class="chapter" data-level="1.1.6" data-path="language-fundamentals.html"><a href="language-fundamentals.html#variable-lookup"><i class="fa fa-check"></i><b>1.1.6</b> Variable Lookup</a></li>
<li class="chapter" data-level="1.1.7" data-path="language-fundamentals.html"><a href="language-fundamentals.html#the-search-path"><i class="fa fa-check"></i><b>1.1.7</b> The Search Path</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="language-fundamentals.html"><a href="language-fundamentals.html#closures"><i class="fa fa-check"></i><b>1.2</b> Closures</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="language-fundamentals.html"><a href="language-fundamentals.html#tidy-closures"><i class="fa fa-check"></i><b>1.2.1</b> Tidy Closures</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="language-fundamentals.html"><a href="language-fundamentals.html#attributes"><i class="fa fa-check"></i><b>1.3</b> Attributes</a></li>
<li class="chapter" data-level="1.4" data-path="language-fundamentals.html"><a href="language-fundamentals.html#s3"><i class="fa fa-check"></i><b>1.4</b> S3</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="language-fundamentals.html"><a href="language-fundamentals.html#method-dispatch"><i class="fa fa-check"></i><b>1.4.1</b> Method Dispatch</a></li>
<li class="chapter" data-level="1.4.2" data-path="language-fundamentals.html"><a href="language-fundamentals.html#creating-objects"><i class="fa fa-check"></i><b>1.4.2</b> Creating Objects</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="language-fundamentals.html"><a href="language-fundamentals.html#other-object-systems"><i class="fa fa-check"></i><b>1.5</b> Other Object Systems</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="output-errors-and-bugs.html"><a href="output-errors-and-bugs.html"><i class="fa fa-check"></i><b>2</b> Output, Errors, and Bugs</a>
<ul>
<li class="chapter" data-level="2.1" data-path="output-errors-and-bugs.html"><a href="output-errors-and-bugs.html#printing-output"><i class="fa fa-check"></i><b>2.1</b> Printing Output</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="output-errors-and-bugs.html"><a href="output-errors-and-bugs.html#the-print-function"><i class="fa fa-check"></i><b>2.1.1</b> The <code>print</code> Function</a></li>
<li class="chapter" data-level="2.1.2" data-path="output-errors-and-bugs.html"><a href="output-errors-and-bugs.html#the-message-function"><i class="fa fa-check"></i><b>2.1.2</b> The <code>message</code> Function</a></li>
<li class="chapter" data-level="2.1.3" data-path="output-errors-and-bugs.html"><a href="output-errors-and-bugs.html#the-cat-function"><i class="fa fa-check"></i><b>2.1.3</b> The <code>cat</code> Function</a></li>
<li class="chapter" data-level="2.1.4" data-path="output-errors-and-bugs.html"><a href="output-errors-and-bugs.html#formatting-output"><i class="fa fa-check"></i><b>2.1.4</b> Formatting Output</a></li>
<li class="chapter" data-level="2.1.5" data-path="output-errors-and-bugs.html"><a href="output-errors-and-bugs.html#logging-output"><i class="fa fa-check"></i><b>2.1.5</b> Logging Output</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="output-errors-and-bugs.html"><a href="output-errors-and-bugs.html#the-conditions-system"><i class="fa fa-check"></i><b>2.2</b> The Conditions System</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="output-errors-and-bugs.html"><a href="output-errors-and-bugs.html#raising-conditions"><i class="fa fa-check"></i><b>2.2.1</b> Raising Conditions</a></li>
<li class="chapter" data-level="2.2.2" data-path="output-errors-and-bugs.html"><a href="output-errors-and-bugs.html#handling-conditions"><i class="fa fa-check"></i><b>2.2.2</b> Handling Conditions</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="output-errors-and-bugs.html"><a href="output-errors-and-bugs.html#global-options"><i class="fa fa-check"></i><b>2.3</b> Global Options</a></li>
<li class="chapter" data-level="2.4" data-path="output-errors-and-bugs.html"><a href="output-errors-and-bugs.html#debugging"><i class="fa fa-check"></i><b>2.4</b> Debugging</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="output-errors-and-bugs.html"><a href="output-errors-and-bugs.html#other-functions"><i class="fa fa-check"></i><b>2.4.1</b> Other Functions</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="output-errors-and-bugs.html"><a href="output-errors-and-bugs.html#measuring-performance"><i class="fa fa-check"></i><b>2.5</b> Measuring Performance</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="output-errors-and-bugs.html"><a href="output-errors-and-bugs.html#estimating-memory-usage"><i class="fa fa-check"></i><b>2.5.1</b> Estimating Memory Usage</a></li>
<li class="chapter" data-level="2.5.2" data-path="output-errors-and-bugs.html"><a href="output-errors-and-bugs.html#benchmarking"><i class="fa fa-check"></i><b>2.5.2</b> Benchmarking</a></li>
<li class="chapter" data-level="2.5.3" data-path="output-errors-and-bugs.html"><a href="output-errors-and-bugs.html#profiling"><i class="fa fa-check"></i><b>2.5.3</b> Profiling</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Cleaning Data &amp; Automating Tasks</b></span></li>
<li class="chapter" data-level="3" data-path="string-date-processing.html"><a href="string-date-processing.html"><i class="fa fa-check"></i><b>3</b> String &amp; Date Processing</a>
<ul>
<li class="chapter" data-level="3.1" data-path="string-date-processing.html"><a href="string-date-processing.html#the-tidyverse"><i class="fa fa-check"></i><b>3.1</b> The Tidyverse</a></li>
<li class="chapter" data-level="3.2" data-path="string-date-processing.html"><a href="string-date-processing.html#parsing-dates-times"><i class="fa fa-check"></i><b>3.2</b> Parsing Dates &amp; Times</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="string-date-processing.html"><a href="string-date-processing.html#the-lubridate-package"><i class="fa fa-check"></i><b>3.2.1</b> The lubridate Package</a></li>
<li class="chapter" data-level="3.2.2" data-path="string-date-processing.html"><a href="string-date-processing.html#case-study-ocean-temperatures"><i class="fa fa-check"></i><b>3.2.2</b> Case Study: Ocean Temperatures</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="string-date-processing.html"><a href="string-date-processing.html#string-fundamentals"><i class="fa fa-check"></i><b>3.3</b> String Fundamentals</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="string-date-processing.html"><a href="string-date-processing.html#printing"><i class="fa fa-check"></i><b>3.3.1</b> Printing</a></li>
<li class="chapter" data-level="3.3.2" data-path="string-date-processing.html"><a href="string-date-processing.html#escape-sequences-1"><i class="fa fa-check"></i><b>3.3.2</b> Escape Sequences</a></li>
<li class="chapter" data-level="3.3.3" data-path="string-date-processing.html"><a href="string-date-processing.html#raw-strings"><i class="fa fa-check"></i><b>3.3.3</b> Raw Strings</a></li>
<li class="chapter" data-level="3.3.4" data-path="string-date-processing.html"><a href="string-date-processing.html#character-encodings"><i class="fa fa-check"></i><b>3.3.4</b> Character Encodings</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="string-date-processing.html"><a href="string-date-processing.html#processing-strings"><i class="fa fa-check"></i><b>3.4</b> Processing Strings</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="string-date-processing.html"><a href="string-date-processing.html#the-stringr-package"><i class="fa fa-check"></i><b>3.4.1</b> The stringr Package</a></li>
<li class="chapter" data-level="3.4.2" data-path="string-date-processing.html"><a href="string-date-processing.html#regular-expressions"><i class="fa fa-check"></i><b>3.4.2</b> Regular Expressions</a></li>
<li class="chapter" data-level="3.4.3" data-path="string-date-processing.html"><a href="string-date-processing.html#replacing-parts-of-strings"><i class="fa fa-check"></i><b>3.4.3</b> Replacing Parts of Strings</a></li>
<li class="chapter" data-level="3.4.4" data-path="string-date-processing.html"><a href="string-date-processing.html#splitting-strings"><i class="fa fa-check"></i><b>3.4.4</b> Splitting Strings</a></li>
<li class="chapter" data-level="3.4.5" data-path="string-date-processing.html"><a href="string-date-processing.html#extracting-matches"><i class="fa fa-check"></i><b>3.4.5</b> Extracting Matches</a></li>
<li class="chapter" data-level="3.4.6" data-path="string-date-processing.html"><a href="string-date-processing.html#case-study-u.s.-warehouse-stocks"><i class="fa fa-check"></i><b>3.4.6</b> Case Study: U.S. Warehouse Stocks</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="string-date-processing.html"><a href="string-date-processing.html#regular-expression-examples"><i class="fa fa-check"></i><b>3.5</b> Regular Expression Examples</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="string-date-processing.html"><a href="string-date-processing.html#the-wildcard"><i class="fa fa-check"></i><b>3.5.1</b> The Wildcard</a></li>
<li class="chapter" data-level="3.5.2" data-path="string-date-processing.html"><a href="string-date-processing.html#escape-sequences-2"><i class="fa fa-check"></i><b>3.5.2</b> Escape Sequences</a></li>
<li class="chapter" data-level="3.5.3" data-path="string-date-processing.html"><a href="string-date-processing.html#anchors"><i class="fa fa-check"></i><b>3.5.3</b> Anchors</a></li>
<li class="chapter" data-level="3.5.4" data-path="string-date-processing.html"><a href="string-date-processing.html#character-classes"><i class="fa fa-check"></i><b>3.5.4</b> Character Classes</a></li>
<li class="chapter" data-level="3.5.5" data-path="string-date-processing.html"><a href="string-date-processing.html#quantifiers"><i class="fa fa-check"></i><b>3.5.5</b> Quantifiers</a></li>
<li class="chapter" data-level="3.5.6" data-path="string-date-processing.html"><a href="string-date-processing.html#groups"><i class="fa fa-check"></i><b>3.5.6</b> Groups</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="reshaping-data-automating-tasks.html"><a href="reshaping-data-automating-tasks.html"><i class="fa fa-check"></i><b>4</b> Reshaping Data &amp; Automating Tasks</a>
<ul>
<li class="chapter" data-level="4.1" data-path="reshaping-data-automating-tasks.html"><a href="reshaping-data-automating-tasks.html#tidy-datasets"><i class="fa fa-check"></i><b>4.1</b> Tidy Datasets</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="reshaping-data-automating-tasks.html"><a href="reshaping-data-automating-tasks.html#the-tidyr-package"><i class="fa fa-check"></i><b>4.1.1</b> The tidyr Package</a></li>
<li class="chapter" data-level="4.1.2" data-path="reshaping-data-automating-tasks.html"><a href="reshaping-data-automating-tasks.html#rows-into-columns"><i class="fa fa-check"></i><b>4.1.2</b> Rows into Columns</a></li>
<li class="chapter" data-level="4.1.3" data-path="reshaping-data-automating-tasks.html"><a href="reshaping-data-automating-tasks.html#columns-into-rows"><i class="fa fa-check"></i><b>4.1.3</b> Columns into Rows</a></li>
<li class="chapter" data-level="4.1.4" data-path="reshaping-data-automating-tasks.html"><a href="reshaping-data-automating-tasks.html#separating-values"><i class="fa fa-check"></i><b>4.1.4</b> Separating Values</a></li>
<li class="chapter" data-level="4.1.5" data-path="reshaping-data-automating-tasks.html"><a href="reshaping-data-automating-tasks.html#case-study-smart-ridership"><i class="fa fa-check"></i><b>4.1.5</b> Case Study: SMART Ridership</a></li>
<li class="chapter" data-level="4.1.6" data-path="reshaping-data-automating-tasks.html"><a href="reshaping-data-automating-tasks.html#without-tidyr"><i class="fa fa-check"></i><b>4.1.6</b> Without tidyr</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="reshaping-data-automating-tasks.html"><a href="reshaping-data-automating-tasks.html#iteration-strategies"><i class="fa fa-check"></i><b>4.2</b> Iteration Strategies</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="reshaping-data-automating-tasks.html"><a href="reshaping-data-automating-tasks.html#for-loops"><i class="fa fa-check"></i><b>4.2.1</b> For-loops</a></li>
<li class="chapter" data-level="4.2.2" data-path="reshaping-data-automating-tasks.html"><a href="reshaping-data-automating-tasks.html#while-loops"><i class="fa fa-check"></i><b>4.2.2</b> While-loops</a></li>
<li class="chapter" data-level="4.2.3" data-path="reshaping-data-automating-tasks.html"><a href="reshaping-data-automating-tasks.html#saving-multiple-results"><i class="fa fa-check"></i><b>4.2.3</b> Saving Multiple Results</a></li>
<li class="chapter" data-level="4.2.4" data-path="reshaping-data-automating-tasks.html"><a href="reshaping-data-automating-tasks.html#break-next"><i class="fa fa-check"></i><b>4.2.4</b> Break &amp; Next</a></li>
<li class="chapter" data-level="4.2.5" data-path="reshaping-data-automating-tasks.html"><a href="reshaping-data-automating-tasks.html#planning-for-iteration"><i class="fa fa-check"></i><b>4.2.5</b> Planning for Iteration</a></li>
<li class="chapter" data-level="4.2.6" data-path="reshaping-data-automating-tasks.html"><a href="reshaping-data-automating-tasks.html#case-study-the-collatz-conjecture"><i class="fa fa-check"></i><b>4.2.6</b> Case Study: The Collatz Conjecture</a></li>
<li class="chapter" data-level="4.2.7" data-path="reshaping-data-automating-tasks.html"><a href="reshaping-data-automating-tasks.html#case-study-u.s.-fruit-prices"><i class="fa fa-check"></i><b>4.2.7</b> Case Study: U.S. Fruit Prices</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III Data Visualization and Analysis in R</b></span></li>
<li class="chapter" data-level="5" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html"><i class="fa fa-check"></i><b>5</b> Data Visualization in R</a>
<ul>
<li class="chapter" data-level="5.1" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#our-friend-ggplot2"><i class="fa fa-check"></i><b>5.1</b> Our Friend <code>ggplot2</code></a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#the-grammar-of-graphics"><i class="fa fa-check"></i><b>5.1.1</b> The Grammar of Graphics</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#example-palmer-penguins"><i class="fa fa-check"></i><b>5.2</b> Example: Palmer Penguins</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#examining-the-plot"><i class="fa fa-check"></i><b>5.2.1</b> Examining the Plot</a></li>
<li class="chapter" data-level="5.2.2" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#duplicating-the-palmer-penguins-plot"><i class="fa fa-check"></i><b>5.2.2</b> Duplicating the Palmer Penguins Plot</a></li>
<li class="chapter" data-level="5.2.3" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#analysis"><i class="fa fa-check"></i><b>5.2.3</b> Analysis</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#layers"><i class="fa fa-check"></i><b>5.3</b> Layers</a></li>
<li class="chapter" data-level="5.4" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#guidelines-for-graphics"><i class="fa fa-check"></i><b>5.4</b> Guidelines for Graphics</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#data"><i class="fa fa-check"></i><b>5.4.1</b> Data</a></li>
<li class="chapter" data-level="5.4.2" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#feature-types"><i class="fa fa-check"></i><b>5.4.2</b> Feature Types</a></li>
<li class="chapter" data-level="5.4.3" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#theme-guidelines"><i class="fa fa-check"></i><b>5.4.3</b> Theme Guidelines</a></li>
<li class="chapter" data-level="5.4.4" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#scale-guidelines"><i class="fa fa-check"></i><b>5.4.4</b> Scale Guidelines</a></li>
<li class="chapter" data-level="5.4.5" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#facet-guidelines"><i class="fa fa-check"></i><b>5.4.5</b> Facet Guidelines</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#case-studies"><i class="fa fa-check"></i><b>5.5</b> Case Studies</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#counting-penguins"><i class="fa fa-check"></i><b>5.5.1</b> Counting Penguins</a></li>
<li class="chapter" data-level="5.5.2" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#experimental-data-with-error-bars"><i class="fa fa-check"></i><b>5.5.2</b> Experimental Data with Error Bars</a></li>
<li class="chapter" data-level="5.5.3" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#bird-flu-mortality"><i class="fa fa-check"></i><b>5.5.3</b> Bird Flu Mortality</a></li>
<li class="chapter" data-level="5.5.4" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#small-business-loans"><i class="fa fa-check"></i><b>5.5.4</b> Small Business Loans</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV Backmatter</b></span></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="chapter" data-level="" data-path="assessment.html"><a href="assessment.html"><i class="fa fa-check"></i>Assessment</a></li>
<li class="chapter" data-level="6" data-path="joining-data.html"><a href="joining-data.html"><i class="fa fa-check"></i><b>6</b> Joining Data</a>
<ul>
<li class="chapter" data-level="6.1" data-path="joining-data.html"><a href="joining-data.html#objective"><i class="fa fa-check"></i><b>6.1</b> Objective:</a></li>
<li class="chapter" data-level="6.2" data-path="joining-data.html"><a href="joining-data.html#the-dplyr-package"><i class="fa fa-check"></i><b>6.2</b> The <code>dplyr</code> Package</a></li>
<li class="chapter" data-level="6.3" data-path="joining-data.html"><a href="joining-data.html#gradebook-data"><i class="fa fa-check"></i><b>6.3</b> Gradebook data</a></li>
<li class="chapter" data-level="6.4" data-path="joining-data.html"><a href="joining-data.html#left-and-right-joins"><i class="fa fa-check"></i><b>6.4</b> Left and Right Joins</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="joining-data.html"><a href="joining-data.html#left-join"><i class="fa fa-check"></i><b>6.4.1</b> Left Join</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="joining-data.html"><a href="joining-data.html#other-joins"><i class="fa fa-check"></i><b>6.5</b> Other Joins</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="joining-data.html"><a href="joining-data.html#right-join"><i class="fa fa-check"></i><b>6.5.1</b> Right Join</a></li>
<li class="chapter" data-level="6.5.2" data-path="joining-data.html"><a href="joining-data.html#inner-join"><i class="fa fa-check"></i><b>6.5.2</b> Inner Join</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="joining-data.html"><a href="joining-data.html#getting-clever-with-join_by"><i class="fa fa-check"></i><b>6.6</b> Getting Clever with <code>join_by</code></a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="joining-data.html"><a href="joining-data.html#matching-multiple-columns"><i class="fa fa-check"></i><b>6.6.1</b> Matching multiple columns</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="joining-data.html"><a href="joining-data.html#examples"><i class="fa fa-check"></i><b>6.7</b> Examples</a>
<ul>
<li class="chapter" data-level="6.7.1" data-path="joining-data.html"><a href="joining-data.html#three-or-more-tables"><i class="fa fa-check"></i><b>6.7.1</b> Three Or More Tables</a></li>
</ul></li>
<li class="chapter" data-level="6.8" data-path="joining-data.html"><a href="joining-data.html#be-explicit"><i class="fa fa-check"></i><b>6.8</b> Be Explicit</a>
<ul>
<li class="chapter" data-level="6.8.1" data-path="joining-data.html"><a href="joining-data.html#handling-duplicate-keys"><i class="fa fa-check"></i><b>6.8.1</b> Handling Duplicate Keys</a></li>
<li class="chapter" data-level="6.8.2" data-path="joining-data.html"><a href="joining-data.html#ambiguous-columns"><i class="fa fa-check"></i><b>6.8.2</b> Ambiguous Columns</a></li>
<li class="chapter" data-level="6.8.3" data-path="joining-data.html"><a href="joining-data.html#missing-values"><i class="fa fa-check"></i><b>6.8.3</b> Missing Values</a></li>
</ul></li>
<li class="chapter" data-level="6.9" data-path="joining-data.html"><a href="joining-data.html#conclusion"><i class="fa fa-check"></i><b>6.9</b> Conclusion</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Intermediate R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="joining-data" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">6</span> Joining Data<a href="joining-data.html#joining-data" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>You will often have two or more data sets that are part of the same project. For example, our library keeps track of its books using three tables: one identifying books, one identifying borrowers, and one that records each book checkout.</p>
<div id="objective" class="section level2 hasAnchor" number="6.1">
<h2><span class="header-section-number">6.1</span> Objective:<a href="joining-data.html#objective" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The goal of this workshop is to familiarize students with the concept of joining tables in R using the dplyr package. Participants will learn how to merge datasets based on common columns, handle different types of joins, and understand the implications of each type.</p>
</div>
<div id="the-dplyr-package" class="section level2 hasAnchor" number="6.2">
<h2><span class="header-section-number">6.2</span> The <code>dplyr</code> Package<a href="joining-data.html#the-dplyr-package" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This workshop uses R and the <a href="https://dplyr.tidyverse.org/index.html"><code>dplyr</code> package</a>. The next link goes to a <a href="https://dplyr.tidyverse.org/reference/index.html">list of all the functions provided by <code>dplyr</code></a>. Let’s check them out. If you’ve ever used SQL, youll probably recognize functions like <code>select()</code>, <code>left_join()</code>, <code>group_by()</code>. In fact, <code>dplyr</code> was designed to bring SQL-style data manipulation to R. As a result the concepts of <code>dplyr</code> and SQL are nearly identical, and even the language overlaps a lot. I’ll point out some examples of this as we go, because I think some people might find it helpful.</p>
</div>
<div id="gradebook-data" class="section level2 hasAnchor" number="6.3">
<h2><span class="header-section-number">6.3</span> Gradebook data<a href="joining-data.html#gradebook-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Data joins are what make databases possible because they link separate tables. There are a lot of benefits of storing data in several small tables rather than one comprehensive table (reducing repetition and reducing storage requirements are probably the two biggest reasons). An example of databases that we all interact with regularly is the university gradebook. One table stores information about students and another table stores grades. The grades are linked to the student records by student ID. Looking at a student’s grades requires joining these two tables.</p>
<p>We are going to use made-up gradebook data for some preliminary examples. The rows and columns of these tables have different meanings, so we won’t be able to stack them side-by-side or one on top of the other. The “key” piece of information is the student ID that is a column in both tables. If you’ve ever used SQL, you may recall that each table should have a <strong>primary key</strong>, which is a column of values that identify the rows. In a database, the primary key must be unique - there can be no duplicates. Most spreadsheets are not designed as databases, and they may have key columns that are not unique. How to handle non-unique keys is going to be a recurring feature of this workshop.</p>
<p>In our made-up gradebook data, <code>student_id</code> will be the primary key for the table of students. Each student should have grades for each class they take, so the student ID is not a unique identifier in the table of grades. When the primary key of one table is used as an indicator in another table, it is called a <strong>foreign key</strong>.</p>
</div>
<div id="left-and-right-joins" class="section level2 hasAnchor" number="6.4">
<h2><span class="header-section-number">6.4</span> Left and Right Joins<a href="joining-data.html#left-and-right-joins" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In the previous section, we set a goal of augmenting the table of students with the information in the grades table. To augment means to add to. We are going to be adding to the <code>students</code> table, but do we add rows or columns? Each row of <code>grades</code> is an event that matches one student to one grade. Adding new rows would be like adding new grades that didn’t occur: not good! Each row has a student and each student may have many columns of information in the <code>students</code> table. So we can maintain the relationships in the data while adding new columns of information to <code>students</code>.</p>
<p>When you want to augment one dataset with information from another, you’ll use a directional join: either left or right. Here, left and right refer to the order that the tables are written in the join command. Left and right joins work almost exactly the same and left joins are far more common in practice, so we will focus on those.</p>
<div id="left-join" class="section level3 hasAnchor" number="6.4.1">
<h3><span class="header-section-number">6.4.1</span> Left Join<a href="joining-data.html#left-join" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A left join combines all rows from the left dataset with the matching rows from the right dataset. Let’s get familiar with a contrived example before actually working on the library data. We’ll create two tables of made-up data: the first identifies students by name and ID, and the second lists their grades in a class.</p>
<div class="sourceCode" id="cb558"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb558-1"><a href="joining-data.html#cb558-1" tabindex="-1"></a><span class="co"># load dplyr package</span></span>
<span id="cb558-2"><a href="joining-data.html#cb558-2" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb558-3"><a href="joining-data.html#cb558-3" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb558-4"><a href="joining-data.html#cb558-4" tabindex="-1"></a></span>
<span id="cb558-5"><a href="joining-data.html#cb558-5" tabindex="-1"></a><span class="co"># Example datasets</span></span>
<span id="cb558-6"><a href="joining-data.html#cb558-6" tabindex="-1"></a>students <span class="ot">=</span> <span class="fu">data.frame</span>(</span>
<span id="cb558-7"><a href="joining-data.html#cb558-7" tabindex="-1"></a>  <span class="at">student_id =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>),</span>
<span id="cb558-8"><a href="joining-data.html#cb558-8" tabindex="-1"></a>  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">&quot;Angel&quot;</span>, <span class="st">&quot;Beto&quot;</span>, <span class="st">&quot;Cici&quot;</span>, <span class="st">&quot;Desmond&quot;</span>)</span>
<span id="cb558-9"><a href="joining-data.html#cb558-9" tabindex="-1"></a>  )</span>
<span id="cb558-10"><a href="joining-data.html#cb558-10" tabindex="-1"></a></span>
<span id="cb558-11"><a href="joining-data.html#cb558-11" tabindex="-1"></a>grades <span class="ot">=</span> <span class="fu">data.frame</span>(</span>
<span id="cb558-12"><a href="joining-data.html#cb558-12" tabindex="-1"></a>  <span class="at">student_id =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>),</span>
<span id="cb558-13"><a href="joining-data.html#cb558-13" tabindex="-1"></a>  <span class="at">grade =</span> <span class="fu">c</span>(<span class="dv">90</span>, <span class="dv">85</span>, <span class="dv">80</span>, <span class="dv">75</span>, <span class="dv">60</span>)</span>
<span id="cb558-14"><a href="joining-data.html#cb558-14" tabindex="-1"></a>  )</span>
<span id="cb558-15"><a href="joining-data.html#cb558-15" tabindex="-1"></a></span>
<span id="cb558-16"><a href="joining-data.html#cb558-16" tabindex="-1"></a><span class="co"># Left join</span></span>
<span id="cb558-17"><a href="joining-data.html#cb558-17" tabindex="-1"></a><span class="fu">left_join</span>(students, grades, <span class="at">by =</span> <span class="st">&quot;student_id&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb558-18"><a href="joining-data.html#cb558-18" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">student_id</th>
<th align="left">name</th>
<th align="right">grade</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">Angel</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">Beto</td>
<td align="right">90</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="left">Cici</td>
<td align="right">85</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">Desmond</td>
<td align="right">80</td>
</tr>
</tbody>
</table>
<p>There are four rows in the <code>students</code> table, and four rows in the <code>grades</code>
table. I have provided <code>students</code> as the first table in the left join (it is written on the left in the function) so the result will have one row per row of <code>students</code>. I have also provided <code>student_id</code> as the <strong>by</strong> or <strong>key</strong> column for the join. That means that rows will be matched between the tables based on whether their <code>student_id</code> columns match.</p>
<p>Note that the keys are not identical between tables: the <code>grades</code> table has no <code>student_id</code> of 1, which is the ID for Angel. This shows up in the result as an <code>NA</code> in the grade column for Angel. There is no row in the result for <code>student_id</code> 5 because a left join brings in augments the left table (<code>students</code>) with columns from the right table (<code>grades</code>). It does not add rows just because they are found in the right table.</p>
<p>There is one reason that a left join will add rows to the result: when the key is not unique. In that case, every possible match will be provided in the result. For an example, let’s add rows with repeat IDs to both the <code>students</code> and <code>grades</code> tables. Let’s also rename the <code>student_id</code> column of <code>grades</code> to be <code>sid</code> so we can see how to join tables where the key column names don’t match.</p>
<div class="sourceCode" id="cb559"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb559-1"><a href="joining-data.html#cb559-1" tabindex="-1"></a><span class="co"># Example datasets</span></span>
<span id="cb559-2"><a href="joining-data.html#cb559-2" tabindex="-1"></a>students <span class="ot">=</span> <span class="fu">data.frame</span>(</span>
<span id="cb559-3"><a href="joining-data.html#cb559-3" tabindex="-1"></a>  <span class="at">student_id =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">4</span>),</span>
<span id="cb559-4"><a href="joining-data.html#cb559-4" tabindex="-1"></a>  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">&quot;Angel&quot;</span>, <span class="st">&quot;Beto&quot;</span>, <span class="st">&quot;Cici&quot;</span>, <span class="st">&quot;Desmond&quot;</span>, <span class="st">&quot;Erik&quot;</span>))</span>
<span id="cb559-5"><a href="joining-data.html#cb559-5" tabindex="-1"></a></span>
<span id="cb559-6"><a href="joining-data.html#cb559-6" tabindex="-1"></a>grades <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">sid =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">2</span>),</span>
<span id="cb559-7"><a href="joining-data.html#cb559-7" tabindex="-1"></a>                        <span class="at">grade =</span> <span class="fu">c</span>(<span class="dv">90</span>, <span class="dv">85</span>, <span class="dv">80</span>, <span class="dv">75</span>, <span class="dv">60</span>))</span>
<span id="cb559-8"><a href="joining-data.html#cb559-8" tabindex="-1"></a></span>
<span id="cb559-9"><a href="joining-data.html#cb559-9" tabindex="-1"></a><span class="co"># Left join</span></span>
<span id="cb559-10"><a href="joining-data.html#cb559-10" tabindex="-1"></a><span class="fu">left_join</span>(students, grades, <span class="at">by =</span> <span class="fu">join_by</span>(student_id <span class="sc">==</span> sid)) <span class="sc">|&gt;</span></span>
<span id="cb559-11"><a href="joining-data.html#cb559-11" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code></pre></div>
<pre><code>## Warning in left_join(students, grades, by = join_by(student_id == sid)): Detected an unexpected many-to-many relationship between `x` and `y`.
## ℹ Row 2 of `x` matches multiple rows in `y`.
## ℹ Row 3 of `y` matches multiple rows in `x`.
## ℹ If a many-to-many relationship is expected, set `relationship = &quot;many-to-many&quot;` to silence this warning.</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">student_id</th>
<th align="left">name</th>
<th align="right">grade</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">Angel</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">Beto</td>
<td align="right">90</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="left">Beto</td>
<td align="right">60</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="left">Cici</td>
<td align="right">85</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="left">Desmond</td>
<td align="right">80</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">Erik</td>
<td align="right">80</td>
</tr>
</tbody>
</table>
<p>Both of the tables had five rows but the result has six rows because <code>student_id</code> is 4 for two rows of <code>students</code> and <code>sid</code> is 2 for two rows of <code>grades</code>. R has warned us that there is a many-to-many relationship in the join, which means that duplicate keys were matched in the left table and the right table. Where there are no duplicate keys in either table, the match is one-to-one. When there are duplicate in one table only, the match is one-to-many or many-to-one. These are often desired behavior and so R just complies silently. A many-to-many match may be desired but it is often a sign that something has gone wrong, so R gives a warning. You can get funky results when your keys are not unique!</p>
<div class="float">
<img src="img/cat-legs-left-join-meme.jpg" alt="Cats join meme" />
<div class="figcaption">Cats join meme</div>
</div>
</div>
</div>
<div id="other-joins" class="section level2 hasAnchor" number="6.5">
<h2><span class="header-section-number">6.5</span> Other Joins<a href="joining-data.html#other-joins" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>I’ve already mentioned that a right join is like a left join, but augments the right table with the left, rather than vice versa. The next most commong join is an inner join, which includes only the rows that match. And a full join includes all rows from both tables, even if there was no match. I’ve created a picture to help identify the differences.</p>
<div class="float">
<img src="img/disney-meme.jpg" alt="Disney characters illustrate differences between joins" />
<div class="figcaption">Disney characters illustrate differences between joins</div>
</div>
<div id="right-join" class="section level3 hasAnchor" number="6.5.1">
<h3><span class="header-section-number">6.5.1</span> Right Join<a href="joining-data.html#right-join" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A right join is exactly like a left join, except…</p>
</div>
<div id="inner-join" class="section level3 hasAnchor" number="6.5.2">
<h3><span class="header-section-number">6.5.2</span> Inner Join<a href="joining-data.html#inner-join" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>An inner join returns the same columns as a left join, but potentially fewer rows. The result of a inner join only includes the rows that matched according to the join specification. This will leave out some rows from the left table if they aren’t matched in the right table, which is the difference between an inner join and a left join.</p>
<div class="sourceCode" id="cb561"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb561-1"><a href="joining-data.html#cb561-1" tabindex="-1"></a><span class="co"># Example datasets</span></span>
<span id="cb561-2"><a href="joining-data.html#cb561-2" tabindex="-1"></a>students <span class="ot">=</span> <span class="fu">data.frame</span>(</span>
<span id="cb561-3"><a href="joining-data.html#cb561-3" tabindex="-1"></a>  <span class="at">student_id =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">4</span>),</span>
<span id="cb561-4"><a href="joining-data.html#cb561-4" tabindex="-1"></a>  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">&quot;Angel&quot;</span>, <span class="st">&quot;Beto&quot;</span>, <span class="st">&quot;Cici&quot;</span>, <span class="st">&quot;Desmond&quot;</span>, <span class="st">&quot;Erik&quot;</span>))</span>
<span id="cb561-5"><a href="joining-data.html#cb561-5" tabindex="-1"></a></span>
<span id="cb561-6"><a href="joining-data.html#cb561-6" tabindex="-1"></a>grades <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">student_id =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">2</span>),</span>
<span id="cb561-7"><a href="joining-data.html#cb561-7" tabindex="-1"></a>                        <span class="at">grade =</span> <span class="fu">c</span>(<span class="dv">90</span>, <span class="dv">85</span>, <span class="dv">80</span>, <span class="dv">75</span>, <span class="dv">60</span>))</span>
<span id="cb561-8"><a href="joining-data.html#cb561-8" tabindex="-1"></a></span>
<span id="cb561-9"><a href="joining-data.html#cb561-9" tabindex="-1"></a><span class="co"># Inner join</span></span>
<span id="cb561-10"><a href="joining-data.html#cb561-10" tabindex="-1"></a><span class="fu">inner_join</span>(students, grades, <span class="at">by=</span><span class="st">&quot;student_id&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb561-11"><a href="joining-data.html#cb561-11" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code></pre></div>
<pre><code>## Warning in inner_join(students, grades, by = &quot;student_id&quot;): Detected an unexpected many-to-many relationship between `x` and `y`.
## ℹ Row 2 of `x` matches multiple rows in `y`.
## ℹ Row 3 of `y` matches multiple rows in `x`.
## ℹ If a many-to-many relationship is expected, set `relationship = &quot;many-to-many&quot;` to silence this warning.</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">student_id</th>
<th align="left">name</th>
<th align="right">grade</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">2</td>
<td align="left">Beto</td>
<td align="right">90</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">Beto</td>
<td align="right">60</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="left">Cici</td>
<td align="right">85</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">Desmond</td>
<td align="right">80</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="left">Erik</td>
<td align="right">80</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="getting-clever-with-join_by" class="section level2 hasAnchor" number="6.6">
<h2><span class="header-section-number">6.6</span> Getting Clever with <code>join_by</code><a href="joining-data.html#getting-clever-with-join_by" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>So far, we’ve focused on the join types and the tables. There’s been a third element in all of the examples that we’ve mostly ignored until now: the <code>by</code> argument in the joins. Specifying a single column name (like <code>student_id</code>) works great when the key columns have the same names in both tables. However, real examples are often more complicated. For those times, <code>dplyr</code> provides a function called <code>join_by()</code>, which lets you create <strong>join specifications</strong> to solve even very complicated problems. We begin with an example where the key name in the <code>grades</code> table has been changed from <code>student_id</code> to <code>sid</code>.</p>
<div class="sourceCode" id="cb563"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb563-1"><a href="joining-data.html#cb563-1" tabindex="-1"></a><span class="co"># Example datasets</span></span>
<span id="cb563-2"><a href="joining-data.html#cb563-2" tabindex="-1"></a>students <span class="ot">=</span> <span class="fu">data.frame</span>(</span>
<span id="cb563-3"><a href="joining-data.html#cb563-3" tabindex="-1"></a>  <span class="at">student_id =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>),</span>
<span id="cb563-4"><a href="joining-data.html#cb563-4" tabindex="-1"></a>  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">&quot;Angel&quot;</span>, <span class="st">&quot;Beto&quot;</span>, <span class="st">&quot;Cici&quot;</span>, <span class="st">&quot;Desmond&quot;</span>))</span>
<span id="cb563-5"><a href="joining-data.html#cb563-5" tabindex="-1"></a></span>
<span id="cb563-6"><a href="joining-data.html#cb563-6" tabindex="-1"></a>grades <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">sid =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>),</span>
<span id="cb563-7"><a href="joining-data.html#cb563-7" tabindex="-1"></a>                        <span class="at">grade =</span> <span class="fu">c</span>(<span class="dv">90</span>, <span class="dv">85</span>, <span class="dv">80</span>, <span class="dv">75</span>))</span>
<span id="cb563-8"><a href="joining-data.html#cb563-8" tabindex="-1"></a></span>
<span id="cb563-9"><a href="joining-data.html#cb563-9" tabindex="-1"></a><span class="co"># Left join</span></span>
<span id="cb563-10"><a href="joining-data.html#cb563-10" tabindex="-1"></a><span class="fu">left_join</span>(students, grades, <span class="at">by =</span> <span class="fu">join_by</span>(student_id<span class="sc">==</span>sid)) <span class="sc">|&gt;</span></span>
<span id="cb563-11"><a href="joining-data.html#cb563-11" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">student_id</th>
<th align="left">name</th>
<th align="right">grade</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">Angel</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">Beto</td>
<td align="right">90</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="left">Cici</td>
<td align="right">85</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">Desmond</td>
<td align="right">80</td>
</tr>
</tbody>
</table>
<p>Since the key column names don’t match, I have provied a <code>join_by</code> specification. Specifying a match via <code>join_by</code> is very powerful and flexible, but the main thing to recognize here is that R searches for the column name on the left of the double-equals in the left table and searches for the column name on the right of the double-equals in the right table. In this example, that means the join will try to match <code>students$student_id</code> to <code>grades$sid</code>.</p>
<div id="matching-multiple-columns" class="section level3 hasAnchor" number="6.6.1">
<h3><span class="header-section-number">6.6.1</span> Matching multiple columns<a href="joining-data.html#matching-multiple-columns" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Sometimes it takes more than one key to uniquely identify a row of data. For example, suppose some of our students are retaking the class in 2023 because they got a failing grade in 2022. Then we would need to combine the student ID with the year to uniquely identify a student’s grade. You can include multiple comparisons in a <code>join_by</code> specification by separating them with commas. In the following example, student ID still has different names between the tables but the year column has the same name in both tables.</p>
<div class="sourceCode" id="cb564"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb564-1"><a href="joining-data.html#cb564-1" tabindex="-1"></a><span class="co"># Example datasets</span></span>
<span id="cb564-2"><a href="joining-data.html#cb564-2" tabindex="-1"></a>students <span class="ot">=</span> <span class="fu">data.frame</span>(</span>
<span id="cb564-3"><a href="joining-data.html#cb564-3" tabindex="-1"></a>  <span class="at">student_id =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>),</span>
<span id="cb564-4"><a href="joining-data.html#cb564-4" tabindex="-1"></a>  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">&quot;Angel&quot;</span>, <span class="st">&quot;Beto&quot;</span>, <span class="st">&quot;Cici&quot;</span>, <span class="st">&quot;Desmond&quot;</span>))</span>
<span id="cb564-5"><a href="joining-data.html#cb564-5" tabindex="-1"></a></span>
<span id="cb564-6"><a href="joining-data.html#cb564-6" tabindex="-1"></a><span class="co"># duplicate the students for two years</span></span>
<span id="cb564-7"><a href="joining-data.html#cb564-7" tabindex="-1"></a>students <span class="ot">=</span> <span class="fu">bind_rows</span>(</span>
<span id="cb564-8"><a href="joining-data.html#cb564-8" tabindex="-1"></a>  <span class="fu">mutate</span>(students, <span class="at">year=</span><span class="dv">2022</span>),</span>
<span id="cb564-9"><a href="joining-data.html#cb564-9" tabindex="-1"></a>  <span class="fu">mutate</span>(students, <span class="at">year=</span><span class="dv">2023</span>)</span>
<span id="cb564-10"><a href="joining-data.html#cb564-10" tabindex="-1"></a>)</span>
<span id="cb564-11"><a href="joining-data.html#cb564-11" tabindex="-1"></a>                      </span>
<span id="cb564-12"><a href="joining-data.html#cb564-12" tabindex="-1"></a><span class="co"># create the grades data.frame</span></span>
<span id="cb564-13"><a href="joining-data.html#cb564-13" tabindex="-1"></a>grades <span class="ot">=</span> <span class="fu">data.frame</span>(</span>
<span id="cb564-14"><a href="joining-data.html#cb564-14" tabindex="-1"></a>  <span class="at">sid =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>),</span>
<span id="cb564-15"><a href="joining-data.html#cb564-15" tabindex="-1"></a>  <span class="at">grade =</span> <span class="fu">c</span>(<span class="dv">90</span>, <span class="dv">85</span>, <span class="dv">80</span>, <span class="dv">75</span>)</span>
<span id="cb564-16"><a href="joining-data.html#cb564-16" tabindex="-1"></a>  )</span>
<span id="cb564-17"><a href="joining-data.html#cb564-17" tabindex="-1"></a></span>
<span id="cb564-18"><a href="joining-data.html#cb564-18" tabindex="-1"></a><span class="co"># duplicate the grades table for two years</span></span>
<span id="cb564-19"><a href="joining-data.html#cb564-19" tabindex="-1"></a>grades <span class="ot">=</span> <span class="fu">bind_rows</span>(</span>
<span id="cb564-20"><a href="joining-data.html#cb564-20" tabindex="-1"></a>  <span class="fu">mutate</span>(grades, <span class="at">grade =</span> grade<span class="dv">-50</span>, <span class="at">year=</span><span class="dv">2022</span>),</span>
<span id="cb564-21"><a href="joining-data.html#cb564-21" tabindex="-1"></a>  <span class="fu">mutate</span>(grades, <span class="at">year=</span><span class="dv">2023</span>)</span>
<span id="cb564-22"><a href="joining-data.html#cb564-22" tabindex="-1"></a>)</span>
<span id="cb564-23"><a href="joining-data.html#cb564-23" tabindex="-1"></a></span>
<span id="cb564-24"><a href="joining-data.html#cb564-24" tabindex="-1"></a><span class="co"># Left join</span></span>
<span id="cb564-25"><a href="joining-data.html#cb564-25" tabindex="-1"></a><span class="fu">left_join</span>(students, grades, <span class="at">by =</span> <span class="fu">join_by</span>(student_id<span class="sc">==</span>sid, year)) <span class="sc">|&gt;</span></span>
<span id="cb564-26"><a href="joining-data.html#cb564-26" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">student_id</th>
<th align="left">name</th>
<th align="right">year</th>
<th align="right">grade</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">Angel</td>
<td align="right">2022</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">Beto</td>
<td align="right">2022</td>
<td align="right">40</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="left">Cici</td>
<td align="right">2022</td>
<td align="right">35</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">Desmond</td>
<td align="right">2022</td>
<td align="right">30</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">Angel</td>
<td align="right">2023</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">Beto</td>
<td align="right">2023</td>
<td align="right">90</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="left">Cici</td>
<td align="right">2023</td>
<td align="right">85</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">Desmond</td>
<td align="right">2023</td>
<td align="right">80</td>
</tr>
</tbody>
</table>
<p>To learn clever tricks for complicated joins, see the documentation at <code>?join_by</code>.</p>
<!--
# 12. Conclusion and Resources (10 mins)
- Summary of key concepts learned.
- Recommended resources for further learning.


# Special topics

## Semi Joins
The semi_join() function in the dplyr package is used to return all rows from the first (left) data frame that have matching rows in the second (right) data frame based on specified columns. Unlike other join functions in dplyr, semi_join() only retains the rows from the left data frame where there is a match in the right data frame, but it does not include any columns from the right data frame in the result. It is a way to filter rows from the left data frame based on their presence in the right data frame.

### Syntax:
`semi_join(x, y, by = "common_column")`
`x`: The left data frame.
`y`: The right data frame.
`by`: A character vector specifying the column(s) by which the data frames should be joined.

### Example:


```r
# Example datasets
employees = data.frame(emp_id = c(1, 2, 3, 4),
                        name = c("Angel", "Beto", "Cici", "Desmond"))

salaries = data.frame(emp_id = c(2, 3, 4, 5),
                        salary = c(60000, 75000, 80000, 70000))

# Semi-join
semi_result = semi_join(employees, salaries, by = "emp_id")

# View the result
print(semi_result)
```

```
##   emp_id    name
## 1      2    Beto
## 2      3    Cici
## 3      4 Desmond
```

In this example, the `semi_join()` function is used to retain only those rows from the `employees` data frame where the `emp_id` values have a match in the `salaries` data frame. The resulting `semi_result` will only contain the rows with `emp_id` values 2, 3, and 4.

### Use Cases:
Filtering rows in the left data frame based on the presence of matching values in the right data frame.
Useful when you are interested in a subset of records from the left data frame that has corresponding records in the right data frame.

## Anti Joins
The `semi_join()` function is the opposite of `anti_join()`, which returns rows from the left data frame that do not have matching rows in the right data frame.


```r
# Example of anti-join (rows in employees without a match in salaries)
anti_result = anti_join(employees, salaries, by = "emp_id")
```
-->
</div>
</div>
<div id="examples" class="section level2 hasAnchor" number="6.7">
<h2><span class="header-section-number">6.7</span> Examples<a href="joining-data.html#examples" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We’ve seen enough of the made-up grades example! Let’s look at some real data and practice our skills!</p>
<p>Let’s begin by looking at the data on books, borrowers, and checkouts.</p>
<div class="sourceCode" id="cb565"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb565-1"><a href="joining-data.html#cb565-1" tabindex="-1"></a>borrowers <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">&quot;data/library/borrowers.csv&quot;</span>)</span>
<span id="cb565-2"><a href="joining-data.html#cb565-2" tabindex="-1"></a>books <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">&quot;data/library/books.csv&quot;</span>)</span>
<span id="cb565-3"><a href="joining-data.html#cb565-3" tabindex="-1"></a>checkouts <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">&quot;data/library/checkouts.csv&quot;</span>)</span>
<span id="cb565-4"><a href="joining-data.html#cb565-4" tabindex="-1"></a></span>
<span id="cb565-5"><a href="joining-data.html#cb565-5" tabindex="-1"></a><span class="co"># show the top rows</span></span>
<span id="cb565-6"><a href="joining-data.html#cb565-6" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(books))</span></code></pre></div>
<pre><code>##   book_id                                   title          author subject
## 1       1                               my alaska        guy noir      NA
## 2       2                                 jubilee          charro      NA
## 3       3     the window ruiner ruined my windows       zipperman      NA
## 4       4                    clowns in the clouds       dark doug      NA
## 5       5 dogs walked, tigers tamed, bars emptied    lucky pierre      NA
## 6       6                             ace ventura sandy mackinnon      NA
##   Keywords minority_author Description. Contents. Series. Pages. Publisher.
## 1       NA              NA           NA        NA      NA    100         NA
## 2       NA              NA           NA        NA      NA    100         NA
## 3       NA              NA           NA        NA      NA    100         NA
## 4       NA              NA           NA        NA      NA    100         NA
## 5       NA              NA           NA        NA      NA    100         NA
## 6       NA              NA           NA        NA      NA    100         NA
##   creation_date publication_date Edition. format venue Language. Source.
## 1            NA               NA       NA     NA    NA        NA      NA
## 2            NA               NA       NA     NA    NA        NA      NA
## 3            NA               NA       NA     NA    NA        NA      NA
## 4            NA               NA       NA     NA    NA        NA      NA
## 5            NA               NA       NA     NA    NA        NA      NA
## 6            NA               NA       NA     NA    NA        NA      NA
##   Identifier. ISBN. location copies type Barcode.
## 1          NA    NA       NA     NA   NA       NA
## 2          NA    NA       NA     NA   NA       NA
## 3          NA    NA       NA     NA   NA       NA
## 4          NA    NA       NA     NA   NA       NA
## 5          NA    NA       NA     NA   NA       NA
## 6          NA    NA       NA     NA   NA       NA</code></pre>
<div class="sourceCode" id="cb567"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb567-1"><a href="joining-data.html#cb567-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(borrowers))</span></code></pre></div>
<pre><code>##   borrower_id account_type major date_created
## 1           1      student    NA           NA
## 2           2        staff    NA           NA
## 3           3      student    NA           NA
## 4           4      student    NA           NA
## 5           5      faculty    NA           NA
## 6           6        staff    NA           NA</code></pre>
<div class="sourceCode" id="cb569"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb569-1"><a href="joining-data.html#cb569-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(checkouts))</span></code></pre></div>
<pre><code>##   borrower_id book_id checkout_date due_date
## 1           1       1      12/21/23  6/18/24
## 2           1       2        1/3/22   7/2/22
## 3           2       2      10/12/20  4/10/21
## 4           2       3        5/5/23  11/1/23
## 5           2       4      12/12/21  6/10/22
## 6           4       2        6/7/18  12/4/18</code></pre>
<div class="sourceCode" id="cb571"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb571-1"><a href="joining-data.html#cb571-1" tabindex="-1"></a><span class="co"># get the table sizes</span></span>
<span id="cb571-2"><a href="joining-data.html#cb571-2" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">dim</span>(books))</span></code></pre></div>
<pre><code>## [1]  9 24</code></pre>
<div class="sourceCode" id="cb573"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb573-1"><a href="joining-data.html#cb573-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">dim</span>(borrowers))</span></code></pre></div>
<pre><code>## [1] 10  4</code></pre>
<div class="sourceCode" id="cb575"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb575-1"><a href="joining-data.html#cb575-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">dim</span>(checkouts))</span></code></pre></div>
<pre><code>## [1] 7 4</code></pre>
<p>One thing we can see is that the <code>books</code> table refers to physical copies of a book, so if the library owns two copies of the same book then the same title, publisher, etc. will appear on the same row.</p>
<p>In the previous section, we set a goal of augmenting the <code>checkouts</code> table with the information in the <code>books</code> table. To augment means to add to. We are going to be adding to the <code>checkouts</code> table, but do we add rows or columns? Each row of <code>checkouts</code> is an event that matches one book and one borrower. Adding new rows would be like adding new events that didn’t occur: not good! Each row has a book and each book has many columns of information in the <code>books</code> table. So we can maintain the relationships in the data while adding new columns of information to <code>checkouts</code>.</p>
<p>How are we to know which books were checked out most often, or were generaly checked out by the same people? The tables have different numbers of rows and columns, so we won’t be able to stack them side-by-side or one on top of the other. The “key” pieces of information are the columns <code>books$book_id</code> and <code>borrowers$borrower_id</code>. If you’ve ever used SQL, you may recall that each table should have a <strong>primary key</strong>, which is a column of values that identify the rows. In a database, the primary key must be unique - there can be no duplicates. Most spreadsheets are not designed as databases, and they may have key or ID columns that are not unique. How to handle non-unique keys is going to be a recurring feature of this workshop.</p>
<p>Now look at the <code>checkouts</code> table again. It has two ID columns: <code>book_id</code> and <code>borrower_id</code>. These match the borrower and book IDs in the <code>borrowers</code> and <code>books</code> tables. Obviously, these aren’t unique: one person may check out multiple books, and an exceptionaly popular book might be checked out as many as three times from the same library! These are columns that identify unique keys other tables, which SQL calls <strong>foreign keys</strong>.</p>
<p>Now we can begin to reason about how to approach the goal of identifying the books that are most often checked out. We want to augment the <code>checkouts</code> table with the information in the <code>books</code> table, matching rows where <code>book_id</code> matches. Every row in the checkouts table should match exactly one row in the results and every row in the results should match exactly one row in the checkouts table. In the next section we will translate this plain-english description into the language used by <code>dplyr</code>.</p>
<div class="sourceCode" id="cb577"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb577-1"><a href="joining-data.html#cb577-1" tabindex="-1"></a><span class="co"># Top ten books with most checkouts</span></span>
<span id="cb577-2"><a href="joining-data.html#cb577-2" tabindex="-1"></a><span class="fu">left_join</span>(checkouts, books, <span class="at">by=</span><span class="st">&quot;book_id&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb577-3"><a href="joining-data.html#cb577-3" tabindex="-1"></a>  <span class="fu">group_by</span>(book_id) <span class="sc">|&gt;</span></span>
<span id="cb577-4"><a href="joining-data.html#cb577-4" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">title=</span><span class="fu">first</span>(title), <span class="at">author=</span><span class="fu">first</span>(author), <span class="at">n_checkouts=</span><span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb577-5"><a href="joining-data.html#cb577-5" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n_checkouts)) <span class="sc">|&gt;</span></span>
<span id="cb577-6"><a href="joining-data.html#cb577-6" tabindex="-1"></a>  <span class="fu">head</span>(<span class="at">n=</span><span class="dv">10</span>) <span class="sc">|&gt;</span></span>
<span id="cb577-7"><a href="joining-data.html#cb577-7" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code></pre></div>
<table>
<colgroup>
<col width="10%" />
<col width="54%" />
<col width="17%" />
<col width="16%" />
</colgroup>
<thead>
<tr class="header">
<th align="right">book_id</th>
<th align="left">title</th>
<th align="left">author</th>
<th align="right">n_checkouts</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">2</td>
<td align="left">jubilee</td>
<td align="left">charro</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">my alaska</td>
<td align="left">guy noir</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="left">the window ruiner ruined my windows</td>
<td align="left">zipperman</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">clowns in the clouds</td>
<td align="left">dark doug</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="left">dogs walked, tigers tamed, bars emptied</td>
<td align="left">lucky pierre</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>Just for fun, here is an instructive example of why relational tables are a better way to store data than putting everything into one spreadsheet. If we want to identify the authors whose books were most checked out from the UCD library, we might think to adapt our previous example to group by author rather than by book_id.</p>
<div class="sourceCode" id="cb578"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb578-1"><a href="joining-data.html#cb578-1" tabindex="-1"></a><span class="co"># Top ten authors with most checkouts</span></span>
<span id="cb578-2"><a href="joining-data.html#cb578-2" tabindex="-1"></a><span class="fu">left_join</span>(checkouts, books, <span class="at">by=</span><span class="st">&quot;book_id&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb578-3"><a href="joining-data.html#cb578-3" tabindex="-1"></a>  <span class="fu">group_by</span>(author) <span class="sc">|&gt;</span></span>
<span id="cb578-4"><a href="joining-data.html#cb578-4" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">author=</span><span class="fu">first</span>(author), <span class="at">n_checkouts =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb578-5"><a href="joining-data.html#cb578-5" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n_checkouts)) <span class="sc">|&gt;</span></span>
<span id="cb578-6"><a href="joining-data.html#cb578-6" tabindex="-1"></a>  <span class="fu">head</span>(<span class="at">n=</span><span class="dv">10</span>) <span class="sc">|&gt;</span></span>
<span id="cb578-7"><a href="joining-data.html#cb578-7" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">author</th>
<th align="right">n_checkouts</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">charro</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">dark doug</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">guy noir</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">lucky pierre</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">zipperman</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>The problem is that the <code>author</code> column is a text field for author name(s), which is not a one-to-one match to a person. There are a lot of reasons: some books have multiple authors, some authors change their names, the order of personal name and family name may be reversed, and middle initials are sometimes included, sometimes not. A table of authors would allow you to refer to authors by a unique identifier and have it always point to the same name (<a href="https://orcid.org">this is what ORCID does for scientific publishing</a>).</p>
<div id="three-or-more-tables" class="section level3 hasAnchor" number="6.7.1">
<h3><span class="header-section-number">6.7.1</span> Three Or More Tables<a href="joining-data.html#three-or-more-tables" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>All of he join functions can only work on two tables but you can join as many tables as you want by iteratively building them up two at a time. We are going to look at an example that combines <code>checkouts</code>, <code>books</code>, and <code>borrowers</code> in order to see how many books were checked out by students, faculty, and staff.</p>
<div class="sourceCode" id="cb579"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb579-1"><a href="joining-data.html#cb579-1" tabindex="-1"></a><span class="co"># list the account types who checked out the most books</span></span>
<span id="cb579-2"><a href="joining-data.html#cb579-2" tabindex="-1"></a><span class="fu">left_join</span>(checkouts, books, <span class="at">by=</span><span class="st">&quot;book_id&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb579-3"><a href="joining-data.html#cb579-3" tabindex="-1"></a>  <span class="fu">left_join</span>(borrowers, <span class="at">by=</span><span class="st">&quot;borrower_id&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb579-4"><a href="joining-data.html#cb579-4" tabindex="-1"></a>  <span class="fu">group_by</span>(borrower_id) <span class="sc">|&gt;</span></span>
<span id="cb579-5"><a href="joining-data.html#cb579-5" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">account_type=</span><span class="fu">first</span>(account_type), <span class="at">n_checkouts =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb579-6"><a href="joining-data.html#cb579-6" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n_checkouts)) <span class="sc">|&gt;</span></span>
<span id="cb579-7"><a href="joining-data.html#cb579-7" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">borrower_id</th>
<th align="left">account_type</th>
<th align="right">n_checkouts</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">2</td>
<td align="left">staff</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">student</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="left">student</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">5</td>
<td align="left">faculty</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="be-explicit" class="section level2 hasAnchor" number="6.8">
<h2><span class="header-section-number">6.8</span> Be Explicit<a href="joining-data.html#be-explicit" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Do you find it odd that we have to tell R exactly what kind of data join to do by calling one of <code>left_join()</code>, <code>right_join()</code>, <code>inner_join()</code>, or <code>full_join()</code>? Why isn’t there just one function called <code>join()</code> that assumes you’re doing a left join unless you specifically provide an argument <code>type</code> like <code>join(..., type="inner")</code>? If you think it would be confusing for R to make assumptions about what kind of data join we want, then you’re on the right track but you’ll want to watch out for these other cases where R has strong assumptions about what the default behavior should be.</p>
<p>A general principle of programming is that explicit is better than implicit because writing information into your code explicitly makes it easier to understand what the code does. Here are some examples of implicit assumptions R will make unless you provide explicit instructions.</p>
<div id="handling-duplicate-keys" class="section level3 hasAnchor" number="6.8.1">
<h3><span class="header-section-number">6.8.1</span> Handling Duplicate Keys<a href="joining-data.html#handling-duplicate-keys" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Values in the key columns may not be unique. What do you think happens when you join using keys that aren’t unique?</p>
<div class="sourceCode" id="cb580"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb580-1"><a href="joining-data.html#cb580-1" tabindex="-1"></a><span class="co"># Example datasets</span></span>
<span id="cb580-2"><a href="joining-data.html#cb580-2" tabindex="-1"></a>students <span class="ot">=</span> <span class="fu">data.frame</span>(</span>
<span id="cb580-3"><a href="joining-data.html#cb580-3" tabindex="-1"></a>  <span class="at">student_id =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">4</span>),</span>
<span id="cb580-4"><a href="joining-data.html#cb580-4" tabindex="-1"></a>  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">&quot;Angel&quot;</span>, <span class="st">&quot;Beto&quot;</span>, <span class="st">&quot;Cici&quot;</span>, <span class="st">&quot;Desmond&quot;</span>, <span class="st">&quot;Erik&quot;</span>))</span>
<span id="cb580-5"><a href="joining-data.html#cb580-5" tabindex="-1"></a></span>
<span id="cb580-6"><a href="joining-data.html#cb580-6" tabindex="-1"></a>grades <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">student_id =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">5</span>),</span>
<span id="cb580-7"><a href="joining-data.html#cb580-7" tabindex="-1"></a>                        <span class="at">grade =</span> <span class="fu">c</span>(<span class="dv">90</span>, <span class="dv">50</span>, <span class="dv">85</span>, <span class="dv">80</span>, <span class="dv">75</span>, <span class="dv">30</span>))</span>
<span id="cb580-8"><a href="joining-data.html#cb580-8" tabindex="-1"></a></span>
<span id="cb580-9"><a href="joining-data.html#cb580-9" tabindex="-1"></a><span class="co"># Left join</span></span>
<span id="cb580-10"><a href="joining-data.html#cb580-10" tabindex="-1"></a><span class="fu">left_join</span>(students, grades, <span class="at">by =</span> <span class="st">&quot;student_id&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb580-11"><a href="joining-data.html#cb580-11" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code></pre></div>
<pre><code>## Warning in left_join(students, grades, by = &quot;student_id&quot;): Detected an unexpected many-to-many relationship between `x` and `y`.
## ℹ Row 2 of `x` matches multiple rows in `y`.
## ℹ Row 4 of `y` matches multiple rows in `x`.
## ℹ If a many-to-many relationship is expected, set `relationship = &quot;many-to-many&quot;` to silence this warning.</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">student_id</th>
<th align="left">name</th>
<th align="right">grade</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">Angel</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">Beto</td>
<td align="right">90</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="left">Beto</td>
<td align="right">50</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="left">Cici</td>
<td align="right">85</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="left">Desmond</td>
<td align="right">80</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">Desmond</td>
<td align="right">75</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="left">Erik</td>
<td align="right">80</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">Erik</td>
<td align="right">75</td>
</tr>
</tbody>
</table>
<p>We get one row in the result for every possible combination of the matching keys. Sometimes that is what you want, and other times not. In this case, it might be reasonable that Beto, Desmond, and Erik have multiple grades in the book, but it is probably not reasonable that both Desmond and Erik have student ID 4 and have the same grades as each other. This is a many-to-many match, with all the risks we’ve mentioned before.</p>
<div id="specifying-the-expected-relationship" class="section level4 hasAnchor" number="6.8.1.1">
<h4><span class="header-section-number">6.8.1.1</span> Specifying The Expected Relationship<a href="joining-data.html#specifying-the-expected-relationship" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>You can be explicit about what kind of relationship you expect in the join by specifying the <code>relationship</code> parameter. Your options are <code>one-to-one</code>, <code>one-to-many</code>, or <code>many-to-one</code>. Any of those will stop the code with an error if the data doesn’t match the relationship you told it to expect.</p>
<p>If you leave the <code>relationship</code> parameter blank, R will allow a many-to-many join but will raise a warning. Pay attention to your warning messages! If you know in advance that you want a many-to-many join, then you can provide the argument <code>relatonship='many-to-many'</code>, which will do the same as leaving <code>relationship</code> blank, except it will not raise the warning.</p>
</div>
<div id="using-only-distinct-rows" class="section level4 hasAnchor" number="6.8.1.2">
<h4><span class="header-section-number">6.8.1.2</span> Using Only Distinct Rows<a href="joining-data.html#using-only-distinct-rows" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>An alternative to handling duplicate keys is to subset the data to avoid duplicates in the first place. The <code>dplyr</code> package provides a function, <code>distinct()</code>, which can help. When <code>distinct()</code> finds duplicated rows, it keeps the first one.</p>
<div class="sourceCode" id="cb582"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb582-1"><a href="joining-data.html#cb582-1" tabindex="-1"></a><span class="co"># Example datasets</span></span>
<span id="cb582-2"><a href="joining-data.html#cb582-2" tabindex="-1"></a>students <span class="ot">=</span> <span class="fu">data.frame</span>(</span>
<span id="cb582-3"><a href="joining-data.html#cb582-3" tabindex="-1"></a>  <span class="at">student_id =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">4</span>),</span>
<span id="cb582-4"><a href="joining-data.html#cb582-4" tabindex="-1"></a>  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">&quot;Angel&quot;</span>, <span class="st">&quot;Beto&quot;</span>, <span class="st">&quot;Cici&quot;</span>, <span class="st">&quot;Desmond&quot;</span>, <span class="st">&quot;Erik&quot;</span>))</span>
<span id="cb582-5"><a href="joining-data.html#cb582-5" tabindex="-1"></a></span>
<span id="cb582-6"><a href="joining-data.html#cb582-6" tabindex="-1"></a>grades <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">student_id =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">5</span>),</span>
<span id="cb582-7"><a href="joining-data.html#cb582-7" tabindex="-1"></a>                        <span class="at">grade =</span> <span class="fu">c</span>(<span class="dv">90</span>, <span class="dv">50</span>, <span class="dv">85</span>, <span class="dv">80</span>, <span class="dv">75</span>, <span class="dv">30</span>))</span>
<span id="cb582-8"><a href="joining-data.html#cb582-8" tabindex="-1"></a></span>
<span id="cb582-9"><a href="joining-data.html#cb582-9" tabindex="-1"></a><span class="co"># Left join</span></span>
<span id="cb582-10"><a href="joining-data.html#cb582-10" tabindex="-1"></a>distinct_keys_result <span class="ot">=</span> students <span class="sc">|&gt;</span> <span class="fu">distinct</span>(student_id, <span class="at">.keep_all=</span><span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb582-11"><a href="joining-data.html#cb582-11" tabindex="-1"></a>  <span class="fu">left_join</span>(grades, <span class="at">by =</span> <span class="st">&quot;student_id&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb582-12"><a href="joining-data.html#cb582-12" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code></pre></div>
</div>
</div>
<div id="ambiguous-columns" class="section level3 hasAnchor" number="6.8.2">
<h3><span class="header-section-number">6.8.2</span> Ambiguous Columns<a href="joining-data.html#ambiguous-columns" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>When the two tables have columns with the same names, it is ambiguous which one to use in the result. R handles that situation by keeping both but changing the names to include the table names. So the column from the left table gets a <code>.x</code> appended by default and the column from the right table gets a <code>.y</code> appended by default. Let’s see an example. Suppose that the <code>date_created</code> column of the borrowers table had the name <code>date</code> instead. Then in the joined data it would be ambiguous with the <code>date</code> column of the checkouts table.</p>
<div class="sourceCode" id="cb583"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb583-1"><a href="joining-data.html#cb583-1" tabindex="-1"></a><span class="co"># Rename the date_created column of borrowers</span></span>
<span id="cb583-2"><a href="joining-data.html#cb583-2" tabindex="-1"></a>borrowers <span class="ot">=</span> <span class="fu">rename</span>(borrowers, <span class="at">date=</span>date_created)</span>
<span id="cb583-3"><a href="joining-data.html#cb583-3" tabindex="-1"></a></span>
<span id="cb583-4"><a href="joining-data.html#cb583-4" tabindex="-1"></a><span class="co"># Now create the list of checkouts</span></span>
<span id="cb583-5"><a href="joining-data.html#cb583-5" tabindex="-1"></a><span class="fu">left_join</span>(checkouts, books, <span class="at">by=</span><span class="st">&quot;book_id&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb583-6"><a href="joining-data.html#cb583-6" tabindex="-1"></a>  <span class="fu">left_join</span>(borrowers, <span class="at">by=</span><span class="st">&quot;borrower_id&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb583-7"><a href="joining-data.html#cb583-7" tabindex="-1"></a>  <span class="fu">head</span>(<span class="at">n=</span><span class="dv">10</span>) <span class="sc">|&gt;</span></span>
<span id="cb583-8"><a href="joining-data.html#cb583-8" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code></pre></div>
<table>
<colgroup>
<col width="3%" />
<col width="2%" />
<col width="4%" />
<col width="2%" />
<col width="12%" />
<col width="4%" />
<col width="2%" />
<col width="2%" />
<col width="4%" />
<col width="4%" />
<col width="3%" />
<col width="2%" />
<col width="2%" />
<col width="3%" />
<col width="4%" />
<col width="5%" />
<col width="2%" />
<col width="2%" />
<col width="1%" />
<col width="3%" />
<col width="2%" />
<col width="3%" />
<col width="1%" />
<col width="2%" />
<col width="2%" />
<col width="1%" />
<col width="2%" />
<col width="4%" />
<col width="1%" />
<col width="1%" />
</colgroup>
<thead>
<tr class="header">
<th align="right">borrower_id</th>
<th align="right">book_id</th>
<th align="left">checkout_date</th>
<th align="left">due_date</th>
<th align="left">title</th>
<th align="left">author</th>
<th align="left">subject</th>
<th align="left">Keywords</th>
<th align="left">minority_author</th>
<th align="left">Description.</th>
<th align="left">Contents.</th>
<th align="left">Series.</th>
<th align="right">Pages.</th>
<th align="left">Publisher.</th>
<th align="left">creation_date</th>
<th align="left">publication_date</th>
<th align="left">Edition.</th>
<th align="left">format</th>
<th align="left">venue</th>
<th align="left">Language.</th>
<th align="left">Source.</th>
<th align="left">Identifier.</th>
<th align="left">ISBN.</th>
<th align="left">location</th>
<th align="left">copies</th>
<th align="left">type</th>
<th align="left">Barcode.</th>
<th align="left">account_type</th>
<th align="left">major</th>
<th align="left">date</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">1</td>
<td align="left">12/21/23</td>
<td align="left">6/18/24</td>
<td align="left">my alaska</td>
<td align="left">guy noir</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">100</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">student</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">2</td>
<td align="left">1/3/22</td>
<td align="left">7/2/22</td>
<td align="left">jubilee</td>
<td align="left">charro</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">100</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">student</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="right">2</td>
<td align="left">10/12/20</td>
<td align="left">4/10/21</td>
<td align="left">jubilee</td>
<td align="left">charro</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">100</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">staff</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">3</td>
<td align="left">5/5/23</td>
<td align="left">11/1/23</td>
<td align="left">the window ruiner ruined my windows</td>
<td align="left">zipperman</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">100</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">staff</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="right">4</td>
<td align="left">12/12/21</td>
<td align="left">6/10/22</td>
<td align="left">clowns in the clouds</td>
<td align="left">dark doug</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">100</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">staff</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">2</td>
<td align="left">6/7/18</td>
<td align="left">12/4/18</td>
<td align="left">jubilee</td>
<td align="left">charro</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">100</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">student</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">5</td>
<td align="left">10/1/23</td>
<td align="left">3/29/24</td>
<td align="left">dogs walked, tigers tamed, bars emptied</td>
<td align="left">lucky pierre</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">100</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">faculty</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
<p>If you aren’t satisfied with appending <code>.x</code> and <code>.y</code> to the ambiguous columns, then you can specify the <code>suffix</code> argument with a pair of strings like this:</p>
<div class="sourceCode" id="cb584"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb584-1"><a href="joining-data.html#cb584-1" tabindex="-1"></a><span class="co"># Now create the list of checkouts</span></span>
<span id="cb584-2"><a href="joining-data.html#cb584-2" tabindex="-1"></a><span class="fu">left_join</span>(checkouts, books, <span class="at">by=</span><span class="st">&quot;book_id&quot;</span>, <span class="at">suffix=</span><span class="fu">c</span>(<span class="st">&quot;_checkout&quot;</span>, <span class="st">&quot;_book&quot;</span>)) <span class="sc">|&gt;</span></span>
<span id="cb584-3"><a href="joining-data.html#cb584-3" tabindex="-1"></a>  <span class="fu">head</span>(<span class="at">n=</span><span class="dv">10</span>) <span class="sc">|&gt;</span></span>
<span id="cb584-4"><a href="joining-data.html#cb584-4" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code></pre></div>
<table style="width:100%;">
<colgroup>
<col width="4%" />
<col width="2%" />
<col width="4%" />
<col width="3%" />
<col width="13%" />
<col width="4%" />
<col width="2%" />
<col width="3%" />
<col width="5%" />
<col width="4%" />
<col width="3%" />
<col width="2%" />
<col width="2%" />
<col width="3%" />
<col width="4%" />
<col width="5%" />
<col width="3%" />
<col width="2%" />
<col width="2%" />
<col width="3%" />
<col width="2%" />
<col width="4%" />
<col width="2%" />
<col width="3%" />
<col width="2%" />
<col width="1%" />
<col width="3%" />
</colgroup>
<thead>
<tr class="header">
<th align="right">borrower_id</th>
<th align="right">book_id</th>
<th align="left">checkout_date</th>
<th align="left">due_date</th>
<th align="left">title</th>
<th align="left">author</th>
<th align="left">subject</th>
<th align="left">Keywords</th>
<th align="left">minority_author</th>
<th align="left">Description.</th>
<th align="left">Contents.</th>
<th align="left">Series.</th>
<th align="right">Pages.</th>
<th align="left">Publisher.</th>
<th align="left">creation_date</th>
<th align="left">publication_date</th>
<th align="left">Edition.</th>
<th align="left">format</th>
<th align="left">venue</th>
<th align="left">Language.</th>
<th align="left">Source.</th>
<th align="left">Identifier.</th>
<th align="left">ISBN.</th>
<th align="left">location</th>
<th align="left">copies</th>
<th align="left">type</th>
<th align="left">Barcode.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">1</td>
<td align="left">12/21/23</td>
<td align="left">6/18/24</td>
<td align="left">my alaska</td>
<td align="left">guy noir</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">100</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">2</td>
<td align="left">1/3/22</td>
<td align="left">7/2/22</td>
<td align="left">jubilee</td>
<td align="left">charro</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">100</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="right">2</td>
<td align="left">10/12/20</td>
<td align="left">4/10/21</td>
<td align="left">jubilee</td>
<td align="left">charro</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">100</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">3</td>
<td align="left">5/5/23</td>
<td align="left">11/1/23</td>
<td align="left">the window ruiner ruined my windows</td>
<td align="left">zipperman</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">100</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="right">4</td>
<td align="left">12/12/21</td>
<td align="left">6/10/22</td>
<td align="left">clowns in the clouds</td>
<td align="left">dark doug</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">100</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">2</td>
<td align="left">6/7/18</td>
<td align="left">12/4/18</td>
<td align="left">jubilee</td>
<td align="left">charro</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">100</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">5</td>
<td align="left">10/1/23</td>
<td align="left">3/29/24</td>
<td align="left">dogs walked, tigers tamed, bars emptied</td>
<td align="left">lucky pierre</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">100</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
<p>By specifying the <code>suffix</code> argument, we get column names in the result with more meaningful names.</p>
</div>
<div id="missing-values" class="section level3 hasAnchor" number="6.8.3">
<h3><span class="header-section-number">6.8.3</span> Missing Values<a href="joining-data.html#missing-values" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>dplyr</code> package has a default behavior that I think is dangerous. In the conditions of a join, <code>NA==NA</code> evaluates to <code>TRUE</code>, which is unlike the behavior anywhere else in R. This means that keys identified as <code>NA</code> will match other <code>NA</code>s in the join. This is a very strong assumption that seems to contradict the idea of a missing value since if we actually don’t know two keys, how can we say that they match? And if we know two keys have the same value then they should be labeled in the data. In my opinion, it’s a mistake to have the computer make strong assumptions by default, and especially if it does so without warning the user. Fortunately, there is a way to make the more sensible decision that <code>NA</code>s don’t match anything: include the argument <code>na_matches='never'</code> in the join.</p>
<div class="sourceCode" id="cb585"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb585-1"><a href="joining-data.html#cb585-1" tabindex="-1"></a><span class="co"># Example datasets</span></span>
<span id="cb585-2"><a href="joining-data.html#cb585-2" tabindex="-1"></a>students <span class="ot">=</span> <span class="fu">data.frame</span>(</span>
<span id="cb585-3"><a href="joining-data.html#cb585-3" tabindex="-1"></a>  <span class="at">student_id =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="cn">NA</span>, <span class="dv">3</span>, <span class="dv">4</span>),</span>
<span id="cb585-4"><a href="joining-data.html#cb585-4" tabindex="-1"></a>  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">&quot;Angel&quot;</span>, <span class="st">&quot;Beto&quot;</span>, <span class="st">&quot;Cici&quot;</span>, <span class="st">&quot;Desmond&quot;</span>))</span>
<span id="cb585-5"><a href="joining-data.html#cb585-5" tabindex="-1"></a></span>
<span id="cb585-6"><a href="joining-data.html#cb585-6" tabindex="-1"></a>grades <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">student_id =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="cn">NA</span>, <span class="dv">4</span>, <span class="dv">5</span>),</span>
<span id="cb585-7"><a href="joining-data.html#cb585-7" tabindex="-1"></a>                        <span class="at">grade =</span> <span class="fu">c</span>(<span class="dv">90</span>, <span class="dv">85</span>, <span class="dv">80</span>, <span class="dv">75</span>))</span>
<span id="cb585-8"><a href="joining-data.html#cb585-8" tabindex="-1"></a></span>
<span id="cb585-9"><a href="joining-data.html#cb585-9" tabindex="-1"></a><span class="co"># Left joins</span></span>
<span id="cb585-10"><a href="joining-data.html#cb585-10" tabindex="-1"></a><span class="fu">left_join</span>(students, grades, <span class="at">by =</span> <span class="st">&quot;student_id&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb585-11"><a href="joining-data.html#cb585-11" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">student_id</th>
<th align="left">name</th>
<th align="right">grade</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">Angel</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">NA</td>
<td align="left">Beto</td>
<td align="right">85</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="left">Cici</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">Desmond</td>
<td align="right">80</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb586"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb586-1"><a href="joining-data.html#cb586-1" tabindex="-1"></a><span class="fu">left_join</span>(students, grades, <span class="at">by =</span> <span class="st">&quot;student_id&quot;</span>, <span class="at">na_matches =</span> <span class="st">&quot;never&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb586-2"><a href="joining-data.html#cb586-2" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">student_id</th>
<th align="left">name</th>
<th align="right">grade</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">Angel</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">NA</td>
<td align="left">Beto</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="left">Cici</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">Desmond</td>
<td align="right">80</td>
</tr>
</tbody>
</table>
<p>Notice that since Beto’s student ID is <code>NA</code>, none of the rows in the <code>grades</code> table can match him. As a result, his grade is left <code>NA</code> in the result.</p>
</div>
</div>
<div id="conclusion" class="section level2 hasAnchor" number="6.9">
<h2><span class="header-section-number">6.9</span> Conclusion<a href="joining-data.html#conclusion" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>You’ve now seen how to join data tables that can be linked by key columns. I encourage you to expand on the examples by posing questions and trying to write the code to answer them. Reading the documentation for <a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">join functions</a> and <a href="https://dplyr.tidyverse.org/reference/join_by.html"><code>join_by</code> specifications</a> is a great way to continue your learning journey by studying the (many!) special cases that we skipped over here.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="assessment.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/ucdavisdatalab/workshop_intermediate_r/edit/master/xx_joins.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/ucdavisdatalab/workshop_intermediate_r/blob/master/xx_joins.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
