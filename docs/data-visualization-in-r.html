<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5 Data Visualization in R | Intermediate R</title>
  <meta name="description" content="5 Data Visualization in R | Intermediate R" />
  <meta name="generator" content="bookdown 0.37 and GitBook 2.6.7" />

  <meta property="og:title" content="5 Data Visualization in R | Intermediate R" />
  <meta property="og:type" content="book" />
  
  
  <meta name="github-repo" content="ucdavisdatalab/workshop_intermediate_r" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5 Data Visualization in R | Intermediate R" />
  
  
  

<meta name="author" content="Nick Ulle and Wesley Brooks" />


<meta name="date" content="2024-01-29" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="squashing-bugs-with-rs-debugging-tools.html"/>
<link rel="next" href="language-fundamentals.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="https://datalab.ucdavis.edu/">
  <img src="https://datalab.ucdavis.edu/wp-content/uploads/2019/07/datalab-logo-full-color-rgb-1.png" style="height: 100%; width: 100%; object-fit: contain" />
</a></li>
<li><a href="./" style="font-size: 18px">Intermediate R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Overview</a></li>
<li class="part"><span><b>I Cleaning &amp; Reshaping Data</b></span></li>
<li class="chapter" data-level="1" data-path="string-date-processing.html"><a href="string-date-processing.html"><i class="fa fa-check"></i><b>1</b> String &amp; Date Processing</a>
<ul>
<li class="chapter" data-level="1.1" data-path="string-date-processing.html"><a href="string-date-processing.html#the-tidyverse"><i class="fa fa-check"></i><b>1.1</b> The Tidyverse</a></li>
<li class="chapter" data-level="1.2" data-path="string-date-processing.html"><a href="string-date-processing.html#parsing-dates-times"><i class="fa fa-check"></i><b>1.2</b> Parsing Dates &amp; Times</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="string-date-processing.html"><a href="string-date-processing.html#the-lubridate-package"><i class="fa fa-check"></i><b>1.2.1</b> The lubridate Package</a></li>
<li class="chapter" data-level="1.2.2" data-path="string-date-processing.html"><a href="string-date-processing.html#case-study-ocean-temperatures"><i class="fa fa-check"></i><b>1.2.2</b> Case Study: Ocean Temperatures</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="string-date-processing.html"><a href="string-date-processing.html#string-fundamentals"><i class="fa fa-check"></i><b>1.3</b> String Fundamentals</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="string-date-processing.html"><a href="string-date-processing.html#printing"><i class="fa fa-check"></i><b>1.3.1</b> Printing</a></li>
<li class="chapter" data-level="1.3.2" data-path="string-date-processing.html"><a href="string-date-processing.html#escape-sequences"><i class="fa fa-check"></i><b>1.3.2</b> Escape Sequences</a></li>
<li class="chapter" data-level="1.3.3" data-path="string-date-processing.html"><a href="string-date-processing.html#raw-strings"><i class="fa fa-check"></i><b>1.3.3</b> Raw Strings</a></li>
<li class="chapter" data-level="1.3.4" data-path="string-date-processing.html"><a href="string-date-processing.html#character-encodings"><i class="fa fa-check"></i><b>1.3.4</b> Character Encodings</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="string-date-processing.html"><a href="string-date-processing.html#processing-strings"><i class="fa fa-check"></i><b>1.4</b> Processing Strings</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="string-date-processing.html"><a href="string-date-processing.html#the-stringr-package"><i class="fa fa-check"></i><b>1.4.1</b> The stringr Package</a></li>
<li class="chapter" data-level="1.4.2" data-path="string-date-processing.html"><a href="string-date-processing.html#regular-expressions"><i class="fa fa-check"></i><b>1.4.2</b> Regular Expressions</a></li>
<li class="chapter" data-level="1.4.3" data-path="string-date-processing.html"><a href="string-date-processing.html#replacing-parts-of-strings"><i class="fa fa-check"></i><b>1.4.3</b> Replacing Parts of Strings</a></li>
<li class="chapter" data-level="1.4.4" data-path="string-date-processing.html"><a href="string-date-processing.html#splitting-strings"><i class="fa fa-check"></i><b>1.4.4</b> Splitting Strings</a></li>
<li class="chapter" data-level="1.4.5" data-path="string-date-processing.html"><a href="string-date-processing.html#extracting-matches"><i class="fa fa-check"></i><b>1.4.5</b> Extracting Matches</a></li>
<li class="chapter" data-level="1.4.6" data-path="string-date-processing.html"><a href="string-date-processing.html#case-study-u.s.-warehouse-stocks"><i class="fa fa-check"></i><b>1.4.6</b> Case Study: U.S. Warehouse Stocks</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="string-date-processing.html"><a href="string-date-processing.html#regular-expression-examples"><i class="fa fa-check"></i><b>1.5</b> Regular Expression Examples</a>
<ul>
<li class="chapter" data-level="1.5.1" data-path="string-date-processing.html"><a href="string-date-processing.html#the-wildcard"><i class="fa fa-check"></i><b>1.5.1</b> The Wildcard</a></li>
<li class="chapter" data-level="1.5.2" data-path="string-date-processing.html"><a href="string-date-processing.html#escape-sequences-1"><i class="fa fa-check"></i><b>1.5.2</b> Escape Sequences</a></li>
<li class="chapter" data-level="1.5.3" data-path="string-date-processing.html"><a href="string-date-processing.html#anchors"><i class="fa fa-check"></i><b>1.5.3</b> Anchors</a></li>
<li class="chapter" data-level="1.5.4" data-path="string-date-processing.html"><a href="string-date-processing.html#character-classes"><i class="fa fa-check"></i><b>1.5.4</b> Character Classes</a></li>
<li class="chapter" data-level="1.5.5" data-path="string-date-processing.html"><a href="string-date-processing.html#quantifiers"><i class="fa fa-check"></i><b>1.5.5</b> Quantifiers</a></li>
<li class="chapter" data-level="1.5.6" data-path="string-date-processing.html"><a href="string-date-processing.html#groups"><i class="fa fa-check"></i><b>1.5.6</b> Groups</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="tidy-relational-data.html"><a href="tidy-relational-data.html"><i class="fa fa-check"></i><b>2</b> Tidy &amp; Relational Data</a>
<ul>
<li class="chapter" data-level="2.1" data-path="tidy-relational-data.html"><a href="tidy-relational-data.html#tidy-datasets"><i class="fa fa-check"></i><b>2.1</b> Tidy Datasets</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="tidy-relational-data.html"><a href="tidy-relational-data.html#the-tidyr-package"><i class="fa fa-check"></i><b>2.1.1</b> The tidyr Package</a></li>
<li class="chapter" data-level="2.1.2" data-path="tidy-relational-data.html"><a href="tidy-relational-data.html#rows-into-columns"><i class="fa fa-check"></i><b>2.1.2</b> Rows into Columns</a></li>
<li class="chapter" data-level="2.1.3" data-path="tidy-relational-data.html"><a href="tidy-relational-data.html#columns-into-rows"><i class="fa fa-check"></i><b>2.1.3</b> Columns into Rows</a></li>
<li class="chapter" data-level="2.1.4" data-path="tidy-relational-data.html"><a href="tidy-relational-data.html#separating-values"><i class="fa fa-check"></i><b>2.1.4</b> Separating Values</a></li>
<li class="chapter" data-level="2.1.5" data-path="tidy-relational-data.html"><a href="tidy-relational-data.html#case-study-smart-ridership"><i class="fa fa-check"></i><b>2.1.5</b> Case Study: SMART Ridership</a></li>
<li class="chapter" data-level="2.1.6" data-path="tidy-relational-data.html"><a href="tidy-relational-data.html#without-tidyr"><i class="fa fa-check"></i><b>2.1.6</b> Without <code>tidyr</code></a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="tidy-relational-data.html"><a href="tidy-relational-data.html#relational-datasets"><i class="fa fa-check"></i><b>2.2</b> Relational Datasets</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="tidy-relational-data.html"><a href="tidy-relational-data.html#the-dplyr-package"><i class="fa fa-check"></i><b>2.2.1</b> The dplyr Package</a></li>
<li class="chapter" data-level="2.2.2" data-path="tidy-relational-data.html"><a href="tidy-relational-data.html#gradebook-dataset"><i class="fa fa-check"></i><b>2.2.2</b> Gradebook Dataset</a></li>
<li class="chapter" data-level="2.2.3" data-path="tidy-relational-data.html"><a href="tidy-relational-data.html#left-joins"><i class="fa fa-check"></i><b>2.2.3</b> Left Joins</a></li>
<li class="chapter" data-level="2.2.4" data-path="tidy-relational-data.html"><a href="tidy-relational-data.html#other-joins"><i class="fa fa-check"></i><b>2.2.4</b> Other Joins</a></li>
<li class="chapter" data-level="2.2.5" data-path="tidy-relational-data.html"><a href="tidy-relational-data.html#getting-clever-with-join_by"><i class="fa fa-check"></i><b>2.2.5</b> Getting Clever with <code>join_by</code></a></li>
<li class="chapter" data-level="2.2.6" data-path="tidy-relational-data.html"><a href="tidy-relational-data.html#examples"><i class="fa fa-check"></i><b>2.2.6</b> Examples</a></li>
<li class="chapter" data-level="2.2.7" data-path="tidy-relational-data.html"><a href="tidy-relational-data.html#be-explicit"><i class="fa fa-check"></i><b>2.2.7</b> Be Explicit</a></li>
<li class="chapter" data-level="2.2.8" data-path="tidy-relational-data.html"><a href="tidy-relational-data.html#conclusion"><i class="fa fa-check"></i><b>2.2.8</b> Conclusion</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Writing &amp; Debugging R Code</b></span></li>
<li class="chapter" data-level="3" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html"><i class="fa fa-check"></i><b>3</b> Best Practices for Writing R Scripts</a>
<ul>
<li class="chapter" data-level="3.1" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#introduction"><i class="fa fa-check"></i><b>3.1</b> Introduction</a></li>
<li class="chapter" data-level="3.2" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#case-study-us-fruit-prices"><i class="fa fa-check"></i><b>3.2</b> Case Study: U.S. Fruit Prices</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#setting-up-the-project"><i class="fa fa-check"></i><b>3.2.1</b> Setting Up the Project</a></li>
<li class="chapter" data-level="3.2.2" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#setting-up-the-script"><i class="fa fa-check"></i><b>3.2.2</b> Setting Up the Script</a></li>
<li class="chapter" data-level="3.2.3" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#reading-the-pear-data"><i class="fa fa-check"></i><b>3.2.3</b> Reading the Pear Data</a></li>
<li class="chapter" data-level="3.2.4" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#getting-the-fruit-name"><i class="fa fa-check"></i><b>3.2.4</b> Getting the Fruit Name</a></li>
<li class="chapter" data-level="3.2.5" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#getting-the-column-names"><i class="fa fa-check"></i><b>3.2.5</b> Getting the Column Names</a></li>
<li class="chapter" data-level="3.2.6" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#getting-the-price-data"><i class="fa fa-check"></i><b>3.2.6</b> Getting the Price Data</a></li>
<li class="chapter" data-level="3.2.7" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#testing-the-script"><i class="fa fa-check"></i><b>3.2.7</b> Testing the Script</a></li>
<li class="chapter" data-level="3.2.8" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#iterating-over-all-fruit"><i class="fa fa-check"></i><b>3.2.8</b> Iterating Over All Fruit</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#managing-environments"><i class="fa fa-check"></i><b>3.3</b> Managing Environments</a></li>
<li class="chapter" data-level="3.4" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#iteration-strategies"><i class="fa fa-check"></i><b>3.4</b> Iteration Strategies</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#for-loops"><i class="fa fa-check"></i><b>3.4.1</b> For-loops</a></li>
<li class="chapter" data-level="3.4.2" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#while-loops"><i class="fa fa-check"></i><b>3.4.2</b> While-loops</a></li>
<li class="chapter" data-level="3.4.3" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#saving-multiple-results"><i class="fa fa-check"></i><b>3.4.3</b> Saving Multiple Results</a></li>
<li class="chapter" data-level="3.4.4" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#break-next"><i class="fa fa-check"></i><b>3.4.4</b> Break &amp; Next</a></li>
<li class="chapter" data-level="3.4.5" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#planning-for-iteration"><i class="fa fa-check"></i><b>3.4.5</b> Planning for Iteration</a></li>
<li class="chapter" data-level="3.4.6" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#case-study-the-collatz-conjecture"><i class="fa fa-check"></i><b>3.4.6</b> Case Study: The Collatz Conjecture</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#printing-output"><i class="fa fa-check"></i><b>3.5</b> Printing Output</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#the-print-function"><i class="fa fa-check"></i><b>3.5.1</b> The <code>print</code> Function</a></li>
<li class="chapter" data-level="3.5.2" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#the-message-function"><i class="fa fa-check"></i><b>3.5.2</b> The <code>message</code> Function</a></li>
<li class="chapter" data-level="3.5.3" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#the-cat-function"><i class="fa fa-check"></i><b>3.5.3</b> The <code>cat</code> Function</a></li>
<li class="chapter" data-level="3.5.4" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#formatting-output"><i class="fa fa-check"></i><b>3.5.4</b> Formatting Output</a></li>
<li class="chapter" data-level="3.5.5" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#logging-output"><i class="fa fa-check"></i><b>3.5.5</b> Logging Output</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#reading-input"><i class="fa fa-check"></i><b>3.6</b> Reading Input</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#command-line-arguments"><i class="fa fa-check"></i><b>3.6.1</b> Command Line Arguments</a></li>
<li class="chapter" data-level="3.6.2" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#configuration-files"><i class="fa fa-check"></i><b>3.6.2</b> Configuration Files</a></li>
<li class="chapter" data-level="3.6.3" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#prompts"><i class="fa fa-check"></i><b>3.6.3</b> Prompts</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="squashing-bugs-with-rs-debugging-tools.html"><a href="squashing-bugs-with-rs-debugging-tools.html"><i class="fa fa-check"></i><b>4</b> Squashing Bugs with R’s Debugging Tools</a>
<ul>
<li class="chapter" data-level="4.1" data-path="squashing-bugs-with-rs-debugging-tools.html"><a href="squashing-bugs-with-rs-debugging-tools.html#printing-1"><i class="fa fa-check"></i><b>4.1</b> Printing</a></li>
<li class="chapter" data-level="4.2" data-path="squashing-bugs-with-rs-debugging-tools.html"><a href="squashing-bugs-with-rs-debugging-tools.html#the-conditions-system"><i class="fa fa-check"></i><b>4.2</b> The Conditions System</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="squashing-bugs-with-rs-debugging-tools.html"><a href="squashing-bugs-with-rs-debugging-tools.html#raising-conditions"><i class="fa fa-check"></i><b>4.2.1</b> Raising Conditions</a></li>
<li class="chapter" data-level="4.2.2" data-path="squashing-bugs-with-rs-debugging-tools.html"><a href="squashing-bugs-with-rs-debugging-tools.html#handling-conditions"><i class="fa fa-check"></i><b>4.2.2</b> Handling Conditions</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="squashing-bugs-with-rs-debugging-tools.html"><a href="squashing-bugs-with-rs-debugging-tools.html#global-options"><i class="fa fa-check"></i><b>4.3</b> Global Options</a></li>
<li class="chapter" data-level="4.4" data-path="squashing-bugs-with-rs-debugging-tools.html"><a href="squashing-bugs-with-rs-debugging-tools.html#debugging"><i class="fa fa-check"></i><b>4.4</b> Debugging</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="squashing-bugs-with-rs-debugging-tools.html"><a href="squashing-bugs-with-rs-debugging-tools.html#read-your-errors-and-warnings"><i class="fa fa-check"></i><b>4.4.1</b> Read Your Errors and Warnings</a></li>
<li class="chapter" data-level="4.4.2" data-path="squashing-bugs-with-rs-debugging-tools.html"><a href="squashing-bugs-with-rs-debugging-tools.html#workflow-debugging"><i class="fa fa-check"></i><b>4.4.2</b> Workflow Debugging</a></li>
<li class="chapter" data-level="4.4.3" data-path="squashing-bugs-with-rs-debugging-tools.html"><a href="squashing-bugs-with-rs-debugging-tools.html#isolate-the-problem"><i class="fa fa-check"></i><b>4.4.3</b> Isolate the Problem</a></li>
<li class="chapter" data-level="4.4.4" data-path="squashing-bugs-with-rs-debugging-tools.html"><a href="squashing-bugs-with-rs-debugging-tools.html#other-functions"><i class="fa fa-check"></i><b>4.4.4</b> Other Functions</a></li>
<li class="chapter" data-level="4.4.5" data-path="squashing-bugs-with-rs-debugging-tools.html"><a href="squashing-bugs-with-rs-debugging-tools.html#debugging-case-study-boottrapping-average-penguin-mass"><i class="fa fa-check"></i><b>4.4.5</b> Debugging Case Study: Boottrapping Average Penguin Mass</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="squashing-bugs-with-rs-debugging-tools.html"><a href="squashing-bugs-with-rs-debugging-tools.html#measuring-performance"><i class="fa fa-check"></i><b>4.5</b> Measuring Performance</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="squashing-bugs-with-rs-debugging-tools.html"><a href="squashing-bugs-with-rs-debugging-tools.html#estimating-memory-usage"><i class="fa fa-check"></i><b>4.5.1</b> Estimating Memory Usage</a></li>
<li class="chapter" data-level="4.5.2" data-path="squashing-bugs-with-rs-debugging-tools.html"><a href="squashing-bugs-with-rs-debugging-tools.html#benchmarking"><i class="fa fa-check"></i><b>4.5.2</b> Benchmarking</a></li>
<li class="chapter" data-level="4.5.3" data-path="squashing-bugs-with-rs-debugging-tools.html"><a href="squashing-bugs-with-rs-debugging-tools.html#profiling"><i class="fa fa-check"></i><b>4.5.3</b> Profiling</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III Data Visualization &amp; Analysis in R</b></span></li>
<li class="chapter" data-level="5" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html"><i class="fa fa-check"></i><b>5</b> Data Visualization in R</a>
<ul>
<li class="chapter" data-level="5.1" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#our-friend-ggplot2"><i class="fa fa-check"></i><b>5.1</b> Our Friend <code>ggplot2</code></a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#the-grammar-of-graphics"><i class="fa fa-check"></i><b>5.1.1</b> The Grammar of Graphics</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#example-palmer-penguins"><i class="fa fa-check"></i><b>5.2</b> Example: Palmer Penguins</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#examining-the-plot"><i class="fa fa-check"></i><b>5.2.1</b> Examining the Plot</a></li>
<li class="chapter" data-level="5.2.2" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#duplicating-the-palmer-penguins-plot"><i class="fa fa-check"></i><b>5.2.2</b> Duplicating the Palmer Penguins Plot</a></li>
<li class="chapter" data-level="5.2.3" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#analysis"><i class="fa fa-check"></i><b>5.2.3</b> Analysis</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#layers"><i class="fa fa-check"></i><b>5.3</b> Layers</a></li>
<li class="chapter" data-level="5.4" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#guidelines-for-graphics"><i class="fa fa-check"></i><b>5.4</b> Guidelines for Graphics</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#data"><i class="fa fa-check"></i><b>5.4.1</b> Data</a></li>
<li class="chapter" data-level="5.4.2" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#feature-types"><i class="fa fa-check"></i><b>5.4.2</b> Feature Types</a></li>
<li class="chapter" data-level="5.4.3" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#theme-guidelines"><i class="fa fa-check"></i><b>5.4.3</b> Theme Guidelines</a></li>
<li class="chapter" data-level="5.4.4" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#scale-guidelines"><i class="fa fa-check"></i><b>5.4.4</b> Scale Guidelines</a></li>
<li class="chapter" data-level="5.4.5" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#facet-guidelines"><i class="fa fa-check"></i><b>5.4.5</b> Facet Guidelines</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#case-studies"><i class="fa fa-check"></i><b>5.5</b> Case Studies</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#counting-penguins"><i class="fa fa-check"></i><b>5.5.1</b> Counting Penguins</a></li>
<li class="chapter" data-level="5.5.2" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#experimental-data-with-error-bars"><i class="fa fa-check"></i><b>5.5.2</b> Experimental Data with Error Bars</a></li>
<li class="chapter" data-level="5.5.3" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#bird-flu-mortality"><i class="fa fa-check"></i><b>5.5.3</b> Bird Flu Mortality</a></li>
<li class="chapter" data-level="5.5.4" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#small-business-loans"><i class="fa fa-check"></i><b>5.5.4</b> Small Business Loans</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV Thinking in R</b></span></li>
<li class="chapter" data-level="6" data-path="language-fundamentals.html"><a href="language-fundamentals.html"><i class="fa fa-check"></i><b>6</b> Language Fundamentals</a>
<ul>
<li class="chapter" data-level="6.1" data-path="language-fundamentals.html"><a href="language-fundamentals.html#variables-environments"><i class="fa fa-check"></i><b>6.1</b> Variables &amp; Environments</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="language-fundamentals.html"><a href="language-fundamentals.html#whats-an-environment"><i class="fa fa-check"></i><b>6.1.1</b> What’s an Environment?</a></li>
<li class="chapter" data-level="6.1.2" data-path="language-fundamentals.html"><a href="language-fundamentals.html#reference-objects"><i class="fa fa-check"></i><b>6.1.2</b> Reference Objects</a></li>
<li class="chapter" data-level="6.1.3" data-path="language-fundamentals.html"><a href="language-fundamentals.html#the-local-environment"><i class="fa fa-check"></i><b>6.1.3</b> The Local Environment</a></li>
<li class="chapter" data-level="6.1.4" data-path="language-fundamentals.html"><a href="language-fundamentals.html#call-environments"><i class="fa fa-check"></i><b>6.1.4</b> Call Environments</a></li>
<li class="chapter" data-level="6.1.5" data-path="language-fundamentals.html"><a href="language-fundamentals.html#lexical-scoping"><i class="fa fa-check"></i><b>6.1.5</b> Lexical Scoping</a></li>
<li class="chapter" data-level="6.1.6" data-path="language-fundamentals.html"><a href="language-fundamentals.html#variable-lookup"><i class="fa fa-check"></i><b>6.1.6</b> Variable Lookup</a></li>
<li class="chapter" data-level="6.1.7" data-path="language-fundamentals.html"><a href="language-fundamentals.html#the-search-path"><i class="fa fa-check"></i><b>6.1.7</b> The Search Path</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="language-fundamentals.html"><a href="language-fundamentals.html#closures"><i class="fa fa-check"></i><b>6.2</b> Closures</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="language-fundamentals.html"><a href="language-fundamentals.html#tidy-closures"><i class="fa fa-check"></i><b>6.2.1</b> Tidy Closures</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="language-fundamentals.html"><a href="language-fundamentals.html#attributes"><i class="fa fa-check"></i><b>6.3</b> Attributes</a></li>
<li class="chapter" data-level="6.4" data-path="language-fundamentals.html"><a href="language-fundamentals.html#s3"><i class="fa fa-check"></i><b>6.4</b> S3</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="language-fundamentals.html"><a href="language-fundamentals.html#method-dispatch"><i class="fa fa-check"></i><b>6.4.1</b> Method Dispatch</a></li>
<li class="chapter" data-level="6.4.2" data-path="language-fundamentals.html"><a href="language-fundamentals.html#creating-objects"><i class="fa fa-check"></i><b>6.4.2</b> Creating Objects</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="language-fundamentals.html"><a href="language-fundamentals.html#other-object-systems"><i class="fa fa-check"></i><b>6.5</b> Other Object Systems</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="part-2.html"><a href="part-2.html"><i class="fa fa-check"></i><b>7</b> Part 2</a></li>
<li class="part"><span><b>V Backmatter</b></span></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="chapter" data-level="" data-path="assessment.html"><a href="assessment.html"><i class="fa fa-check"></i>Assessment</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Intermediate R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-visualization-in-r" class="section level1 hasAnchor" number="5">
<h1><span class="header-section-number">5</span> Data Visualization in R<a href="data-visualization-in-r.html#data-visualization-in-r" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>We are here today to learn how to do data visualization in R. Some of you will have recently done the Principles of Data Visualization workshop. There you were given a checklist of questions to guide you as you create a plot, which we are going to use today. <a href="./img/graphics_checklist.pdf">The checklist is here</a>.</p>
<div id="our-friend-ggplot2" class="section level2 hasAnchor" number="5.1">
<h2><span class="header-section-number">5.1</span> Our Friend <code>ggplot2</code><a href="data-visualization-in-r.html#our-friend-ggplot2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We will be using the R package <code>ggplot2</code> to create data visualizations. Install it via the <code>install.packages()</code> function. While we are at it, let’s make sure we install all of the packages that we’ll need for today’s workshop. Beyone <code>ggplot2</code>, we’ll use <code>readr</code> for reading data files, <code>dplyr</code> for manupulating data, and <code>palmerpenguins</code> provides a nice dataset.</p>
<div class="sourceCode" id="cb461"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb461-1"><a href="data-visualization-in-r.html#cb461-1" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;ggplot2&quot;</span>)</span>
<span id="cb461-2"><a href="data-visualization-in-r.html#cb461-2" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;dplyr&quot;</span>)</span>
<span id="cb461-3"><a href="data-visualization-in-r.html#cb461-3" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;readr&quot;</span>)</span>
<span id="cb461-4"><a href="data-visualization-in-r.html#cb461-4" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;palmerpenguins&quot;</span>)</span></code></pre></div>
<p><code>ggplot2</code> is an enormously popular R package that provides a way to create data visualizations through a so-called “grammar of graphics” (hence the “gg” in the name). That grammar interface may be a little bit unintuitive at first but once you grasp it, you hold enormous power to quickly craft plots. It doesn’t hurt that the <code>ggplot2</code> plots look great, too.</p>
<div id="the-grammar-of-graphics" class="section level3 hasAnchor" number="5.1.1">
<h3><span class="header-section-number">5.1.1</span> The Grammar of Graphics<a href="data-visualization-in-r.html#the-grammar-of-graphics" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The grammar of graphics breaks the elements of statistical graphics into parts in an analogy to human language grammars. Knowing how to put together subject nouns, object nouns, verbs, and adjectives allows you to construct sentences that express meaning. Similarly, the grammar of graphics is a collection of layers and the rules for putting them together to graphically express the meaning of your data.</p>
</div>
</div>
<div id="example-palmer-penguins" class="section level2 hasAnchor" number="5.2">
<h2><span class="header-section-number">5.2</span> Example: Palmer Penguins<a href="data-visualization-in-r.html#example-palmer-penguins" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let’s look at an example. This uses data from the <code>palmerpenguins</code> package that you just installed (make sure to load the package with <code>library(palmerpenguins)</code>). It is measurements of 344 penguins, collected and made available by <a href="https://www.uaf.edu/cfos/people/faculty/detail/kristen-gorman.php">Dr. Kristen Gorman</a> and the <a href="https://pallter.marine.rutgers.edu/">Palmer Station, Antarctica LTER</a>, a member of the <a href="https://lternet.edu/">Long Term Ecological Research Network</a>. <a href="https://allisonhorst.github.io/palmerpenguins/">The data package</a> was created by <a href="https://allisonhorst.com">Allison Horst</a>. Before jumping in, let’s have a look at the data and the image we want to create.</p>
<div class="sourceCode" id="cb462"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb462-1"><a href="data-visualization-in-r.html#cb462-1" tabindex="-1"></a><span class="fu">head</span>(penguins)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 8
##   species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g
##   &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt;
## 1 Adelie  Torgersen           39.1          18.7               181        3750
## 2 Adelie  Torgersen           39.5          17.4               186        3800
## 3 Adelie  Torgersen           40.3          18                 195        3250
## 4 Adelie  Torgersen           NA            NA                  NA          NA
## 5 Adelie  Torgersen           36.7          19.3               193        3450
## 6 Adelie  Torgersen           39.3          20.6               190        3650
## # ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt;</code></pre>
<div class="float">
<img src="img/flipper-bill.png" alt="Plot of bill length vs. flipper length for the Palmer Penguins" />
<div class="figcaption">Plot of bill length vs. flipper length for the Palmer Penguins</div>
</div>
<div id="examining-the-plot" class="section level3 hasAnchor" number="5.2.1">
<h3><span class="header-section-number">5.2.1</span> Examining the Plot<a href="data-visualization-in-r.html#examining-the-plot" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Referring to the graphics checklist, we see that this plot has two numerical features (bill length and flipper length), expressed using a scatter plot. There is also a categorical feature (species), which is indicated by the different colors and shapes of the plot. The plot expresses the fact that flipper length is positively associated with bill length for all thre species of penguins, but the sizes and the relationships between them are unique to each species. There is a title and a legend, the axes are labeled with units, and all of the text is in plain language. There is a risk that the data may hide the message, so a smoothing line is added to each species for clarity. The colors are accessible (avoiding red/green colorblindness issues).</p>
<p>This is a good dataviz, now let’s duplicate it!</p>
</div>
<div id="duplicating-the-palmer-penguins-plot" class="section level3 hasAnchor" number="5.2.2">
<h3><span class="header-section-number">5.2.2</span> Duplicating the Palmer Penguins Plot<a href="data-visualization-in-r.html#duplicating-the-palmer-penguins-plot" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Here is the code to make the plot:</p>
<div class="sourceCode" id="cb464"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb464-1"><a href="data-visualization-in-r.html#cb464-1" tabindex="-1"></a><span class="co"># matching the Allison Horst peguins plot</span></span>
<span id="cb464-2"><a href="data-visualization-in-r.html#cb464-2" tabindex="-1"></a><span class="fu">ggplot</span>(penguins) <span class="sc">+</span></span>
<span id="cb464-3"><a href="data-visualization-in-r.html#cb464-3" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> flipper_length_mm, </span>
<span id="cb464-4"><a href="data-visualization-in-r.html#cb464-4" tabindex="-1"></a>      <span class="at">y =</span> bill_length_mm, </span>
<span id="cb464-5"><a href="data-visualization-in-r.html#cb464-5" tabindex="-1"></a>      <span class="at">color =</span> species, </span>
<span id="cb464-6"><a href="data-visualization-in-r.html#cb464-6" tabindex="-1"></a>      <span class="at">shape =</span> species) <span class="sc">+</span></span>
<span id="cb464-7"><a href="data-visualization-in-r.html#cb464-7" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb464-8"><a href="data-visualization-in-r.html#cb464-8" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> lm, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb464-9"><a href="data-visualization-in-r.html#cb464-9" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Flipper length (mm)&quot;</span>) <span class="sc">+</span></span>
<span id="cb464-10"><a href="data-visualization-in-r.html#cb464-10" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Bill length (mm)&quot;</span>) <span class="sc">+</span></span>
<span id="cb464-11"><a href="data-visualization-in-r.html#cb464-11" tabindex="-1"></a>  <span class="fu">ggtitle</span>(</span>
<span id="cb464-12"><a href="data-visualization-in-r.html#cb464-12" tabindex="-1"></a>    <span class="st">&quot;Flipper and bill length&quot;</span>,</span>
<span id="cb464-13"><a href="data-visualization-in-r.html#cb464-13" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;Dimensions for Adelie, Chinstrap, and Gentoo penguins at Palmer Station LTER&quot;</span></span>
<span id="cb464-14"><a href="data-visualization-in-r.html#cb464-14" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb464-15"><a href="data-visualization-in-r.html#cb464-15" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">&quot;Penguin species&quot;</span>, <span class="at">shape =</span> <span class="st">&quot;Penguin species&quot;</span>) <span class="sc">+</span></span>
<span id="cb464-16"><a href="data-visualization-in-r.html#cb464-16" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Dark2&quot;</span>)</span></code></pre></div>
<p><img src="05_visualization_files/figure-html/penguin-plot-1.png" width="672" /></p>
</div>
<div id="analysis" class="section level3 hasAnchor" number="5.2.3">
<h3><span class="header-section-number">5.2.3</span> Analysis<a href="data-visualization-in-r.html#analysis" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This is a complicated data visualization that includes features we haven’t covered yet, so let’s go into how it works. You might have noticed how the code to make the plot is separated into a bunch of function calls, all separated by plus signs (<code>+</code>). Each function does something small and specific. The functions and the ability to add them together provide a powerful and flexible “grammar” to describe the desired plot.</p>
<p>Our plot begins the way that most do - by calling <code>ggplot()</code> with the data as the argument. This creates a plot object (but doesn’t draw it) and sets the data. Then we add the a so-called “aesthetic mapping” with the <code>aes()</code> function. An aesthetic mapping describes how features of the data map to visual channels of the plot. In our case, that means mapping the flipper length to the <code>x</code> (horizontal) direction, the bill length to the <code>y</code> (vertical) direction, and mapping species to both color and shape. Next, we add a geometry to describe what kind of marks to use in drawing the plot. Here you can refer to the table at the top of the graphics checklist that suggests geometries to use for different kinds of features. We have numeric features for both <code>x</code> and <code>y</code>, so the table suggests line, scatter (points), and heatmap. We’ve selected points (<code>geom_point()</code>) because we want to show the individual penguins (lines would imply a chain of connections from one penguin to the next.)</p>
<p>Those three parts (data, a geometry, and a map between the two) would be enough to get a basic plot that looks like this:</p>
<div class="sourceCode" id="cb465"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb465-1"><a href="data-visualization-in-r.html#cb465-1" tabindex="-1"></a><span class="co"># Make a basic penguin plot with just data, </span></span>
<span id="cb465-2"><a href="data-visualization-in-r.html#cb465-2" tabindex="-1"></a><span class="co"># a geometry, and a map between the two.</span></span>
<span id="cb465-3"><a href="data-visualization-in-r.html#cb465-3" tabindex="-1"></a><span class="fu">ggplot</span>(penguins) <span class="sc">+</span></span>
<span id="cb465-4"><a href="data-visualization-in-r.html#cb465-4" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> flipper_length_mm,</span>
<span id="cb465-5"><a href="data-visualization-in-r.html#cb465-5" tabindex="-1"></a>      <span class="at">y =</span> bill_length_mm, </span>
<span id="cb465-6"><a href="data-visualization-in-r.html#cb465-6" tabindex="-1"></a>      <span class="at">color =</span> species, </span>
<span id="cb465-7"><a href="data-visualization-in-r.html#cb465-7" tabindex="-1"></a>      <span class="at">shape =</span> species) <span class="sc">+</span></span>
<span id="cb465-8"><a href="data-visualization-in-r.html#cb465-8" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="05_visualization_files/figure-html/basic-points-1.png" width="672" /></p>
<p>We know, though, that this plot is not complete. In particular, there is no title and the axes aren’t labeled meaningfully. Also, the clouds of points seem to hide the meaning that we are trying to convey and the colors aren’t colorblind-safe. The rest of the pieces of the plot call are meant to address those shortcomings.</p>
<p>We add a second geometry layer with <code>geom_smooth(method=lm, se=FALSE)</code>, which specifies the <code>lm</code> method in order to draw a straight (instead of wiggly) smoother through the data. The <code>x</code>-axis label, <code>y</code>-axis label and title are set by <code>xlab()</code>, <code>ylab()</code>, and <code>ggtitle()</code>, respectively. We want a more informative label for the legend title than just the variable name (“Penguin Species” instead of “species”), which is handled by the <code>labs()</code> function. And you’ll recall from the principles of data visualization that you can use <a href="https://colorbrewer2.org/">Cynthia Brewer’s Color Brewer website</a> to select colorblind-friendly color schemes. Color Brewer is integrated directly into <code>ggplot2</code>, so the <code>scale_color_brewer()</code> function can pull a named color scheme from Color Brewer directly into your plot as the color scale.</p>
<p>We can begin to better understand the grammar of graphics as we consider this example. Recognize that we our data visualization conveys information via several visual channels that express data as visual marks. The geometry determines how those marks are drawn on the page, which can be set separately from the mapping. Let’s see a couple examples of that:</p>
<div class="sourceCode" id="cb466"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb466-1"><a href="data-visualization-in-r.html#cb466-1" tabindex="-1"></a><span class="co"># placing plots via gridExtra</span></span>
<span id="cb466-2"><a href="data-visualization-in-r.html#cb466-2" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb466-3"><a href="data-visualization-in-r.html#cb466-3" tabindex="-1"></a></span>
<span id="cb466-4"><a href="data-visualization-in-r.html#cb466-4" tabindex="-1"></a><span class="co"># plot the Palmer penguin data with a line geometry</span></span>
<span id="cb466-5"><a href="data-visualization-in-r.html#cb466-5" tabindex="-1"></a>peng_line <span class="ot">=</span> <span class="fu">ggplot</span>(penguins) <span class="sc">+</span></span>
<span id="cb466-6"><a href="data-visualization-in-r.html#cb466-6" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> flipper_length_mm, </span>
<span id="cb466-7"><a href="data-visualization-in-r.html#cb466-7" tabindex="-1"></a>      <span class="at">y =</span> bill_length_mm, </span>
<span id="cb466-8"><a href="data-visualization-in-r.html#cb466-8" tabindex="-1"></a>      <span class="at">color =</span> species, </span>
<span id="cb466-9"><a href="data-visualization-in-r.html#cb466-9" tabindex="-1"></a>      <span class="at">shape =</span> species) <span class="sc">+</span></span>
<span id="cb466-10"><a href="data-visualization-in-r.html#cb466-10" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span>
<span id="cb466-11"><a href="data-visualization-in-r.html#cb466-11" tabindex="-1"></a></span>
<span id="cb466-12"><a href="data-visualization-in-r.html#cb466-12" tabindex="-1"></a><span class="co"># plot the Palmer penguin data with a hex heatmap geometry</span></span>
<span id="cb466-13"><a href="data-visualization-in-r.html#cb466-13" tabindex="-1"></a>peng_hex <span class="ot">=</span> <span class="fu">ggplot</span>(penguins) <span class="sc">+</span></span>
<span id="cb466-14"><a href="data-visualization-in-r.html#cb466-14" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> flipper_length_mm, </span>
<span id="cb466-15"><a href="data-visualization-in-r.html#cb466-15" tabindex="-1"></a>      <span class="at">y =</span> bill_length_mm, </span>
<span id="cb466-16"><a href="data-visualization-in-r.html#cb466-16" tabindex="-1"></a>      <span class="at">color =</span> species, </span>
<span id="cb466-17"><a href="data-visualization-in-r.html#cb466-17" tabindex="-1"></a>      <span class="at">shape =</span> species) <span class="sc">+</span></span>
<span id="cb466-18"><a href="data-visualization-in-r.html#cb466-18" tabindex="-1"></a>  <span class="fu">geom_hex</span>()</span>
<span id="cb466-19"><a href="data-visualization-in-r.html#cb466-19" tabindex="-1"></a></span>
<span id="cb466-20"><a href="data-visualization-in-r.html#cb466-20" tabindex="-1"></a><span class="co"># place the plts side-by-side</span></span>
<span id="cb466-21"><a href="data-visualization-in-r.html#cb466-21" tabindex="-1"></a><span class="fu">grid.arrange</span>(peng_line, peng_hex)</span></code></pre></div>
<p><img src="05_visualization_files/figure-html/alternate-penguin-geoms-1.png" width="672" /></p>
<p>You can see how changing the geometry but not the mapping will plot the same data with a different method. Separating the mapping of features to channels from the drawing of marks is at the core of the grammar of graphics.</p>
<p>This separation of functions gives <code>ggplot2</code> its power by allowing us to compose a small number of functions to express data in unlimited ways (kind of like poetry). Recognizing the grammar of graphics allows us to reason in a consistent way about different kinds of plots, and make intelligent assumptions about mappings and geometries.</p>
<!-- ```{r example-cars message=FALSE, warning=FALSE} -->
<!-- # load the data and attack the ggplot2 package -->
<!-- library( ggplot2 ) -->
<!-- # look at the data - it is tidy -->
<!-- head( cars ) -->
<!-- # make a simple plot of the data -->
<!-- ggplot(cars) +  -->
<!--   aes(x=speed, y=dist) + -->
<!--   geom_point() -->
<!-- ``` -->
<!-- Ideas in the grammar of graphics are expressed in layers. The most basic layer is the data itself, and there is an aesthetic layer that describes how data maps onto dimensions like color, x/y coordinates, and size. This layer is distinct from the geometry layer, which describes the way that data should be drawn (e.g., dots, lines, or bars). There are other kinds of layers, but many plots can be specified as the combination of data, aesthetic mapping, and geometry. Let's see one. -->
<!-- ### Example: Distance to Stop A Car -->
<!-- One of the datasets built into R is an experiment from the 1920s that measured how far (in feet) cars took to stop from speeds of 4-25 miles per hour. Don't worry about what the code is doing yet, this example is just meant to show what a ggplot looks like. We will dive into the details in a moment.-->
</div>
</div>
<div id="layers" class="section level2 hasAnchor" number="5.3">
<h2><span class="header-section-number">5.3</span> Layers<a href="data-visualization-in-r.html#layers" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Layers are the building blocks of the grammar of graphics. The typical pattern is that you express the idea of a plot in the grammar of graphics by adding layers with the addition symbol (<code>+</code>). There aren’t even that many of layers to know! Here is the list, and the name of the function(s) you’ll use to control the layer. Some of the names include asterisks because there are a lot of similar options - for instance, geometry layers include <code>geom_point()</code>, <code>geom_line()</code>, <code>geom_boxplot()</code>, and many more. See the comprehensive listing on <a href="https://ggplot2.tidyverse.org/reference/">the official <code>ggplot2</code> website</a>.</p>
<ul>
<li>Data (<code>ggplot2()</code>) - provides the data for the visualization.</li>
<li>Aesthetic mapping (<code>aes()</code>) - a mapping that indicates which variables in the data control which channel in the plot (recall from the <a href="https://ucdavisdatalab.github.io/workshop_data_viz_principles/graphical-elements-of-a-plot.html">Principle of Data Visualization</a> that a “channel” is used in an abstract way to include things like shape, color, and line width.)</li>
<li>Geometry (<code>geom_*()</code>) - how the marks will be drawn in the figure.</li>
<li>Statistical transform (<code>stat_*()</code>) - alters the data before drawing - for instance binning or removing duplicates.</li>
<li>Scale (<code>scale_*()</code>) - used to control the way that values in the data are mapped to the channels. For instance, you can control how numbers or categories in the data map to colors.</li>
<li>Coordinates (<code>coord_*()</code>) - used to control how the data are mapped to plot axes.</li>
<li>Facets (<code>facet_*()</code>) - used to separate the data into subplots called “facets”.</li>
<li>Theme (<code>theme()</code>) - modifies plot details like titles, labels, and legends.</li>
</ul>
</div>
<div id="guidelines-for-graphics" class="section level2 hasAnchor" number="5.4">
<h2><span class="header-section-number">5.4</span> Guidelines for Graphics<a href="data-visualization-in-r.html#guidelines-for-graphics" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>I’ve attached the <a href="img/graphics_checklist.pdf">PDF checklist for creating good data
visualizations</a>, created by Nick Ulle of UC
Davis Datalab. Download it and keep a copy around - it’s an excellent
guide. I’m going to go over how the checklist translates into the
grammar of graphics.</p>
<div id="data" class="section level3 hasAnchor" number="5.4.1">
<h3><span class="header-section-number">5.4.1</span> Data<a href="data-visualization-in-r.html#data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>You can’t have a data visualization without data! <code>ggplot2</code> expects that your data is <strong>tidy</strong>, which means that each row is a complete observation and each column is a unique feature. In fact, <code>ggplot2</code> is part of an actively developing collection of packages <a href="https://tidyverse.org">called the <code>tidyverse</code></a> that provides ways to create and work with tidy data. You dont have to adopt the entire tidyverse to use <code>ggplot2</code>, though.</p>
</div>
<div id="feature-types" class="section level3 hasAnchor" number="5.4.2">
<h3><span class="header-section-number">5.4.2</span> Feature Types<a href="data-visualization-in-r.html#feature-types" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The first item on the list is a table of options for geometries that are commonly relevant for a given kind of data - for instance, a histogram is a geometry that can be used with a single numeric feature, and a box plot can be used with one numeric and one categorical feature.
- Should it be a dot plot? Pie plots are hard
to read and bar plots don’t use space efficiently (Cleveland and McGill
1990; Heer and Bostock 2010). Generally a dot plot is a better choice.</p>
</div>
<div id="theme-guidelines" class="section level3 hasAnchor" number="5.4.3">
<h3><span class="header-section-number">5.4.3</span> Theme Guidelines<a href="data-visualization-in-r.html#theme-guidelines" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Does the graphic convey important information? Don’t include graphics that are uninformative or redundant.</li>
<li>Title? Make sure the title explains what the graphic shows.</li>
<li>Axis labels? Label the axes in plain language (no variable names!).</li>
<li>Axis units? Label the axes with units (inches, dollars, etc).</li>
<li>Legend? Any graphic that shows two or more categories coded by style or color must include a legend.</li>
</ul>
</div>
<div id="scale-guidelines" class="section level3 hasAnchor" number="5.4.4">
<h3><span class="header-section-number">5.4.4</span> Scale Guidelines<a href="data-visualization-in-r.html#scale-guidelines" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><p>Appropriate scales and limits? Make sure the scales and limits of the axes do not lead people to incorrect conclusions. For side-by-side graphics or graphics that viewers will compare, use identical scales and limits.</p></li>
<li><p>Print safe? Design graphics to be legible in black &amp; white. Color is great, but use point and line styles to distinguish groups in addition to color. Also try to choose colors that are accessible to colorblind people. The RColorBrewer and viridis packages can help with choosing colors.</p></li>
</ul>
</div>
<div id="facet-guidelines" class="section level3 hasAnchor" number="5.4.5">
<h3><span class="header-section-number">5.4.5</span> Facet Guidelines<a href="data-visualization-in-r.html#facet-guidelines" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>No more than 5 lines? Line plots with more than 5 lines risk becoming hard-to-read “spaghetti” plots. Generally a line plot with more than 5 lines should be split into multiple plots with fewer lines. If the x-axis is discrete, consider using a heat map instead.</li>
<li>No overplotting? Scatter plots where many plot points overlap hide the actual patterns in the data. Consider splitting the data into facets, making the points smaller, or using a two-dimensional density plot (a smooth scatter plot) instead.</li>
</ul>
</div>
</div>
<div id="case-studies" class="section level2 hasAnchor" number="5.5">
<h2><span class="header-section-number">5.5</span> Case Studies<a href="data-visualization-in-r.html#case-studies" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We have covered enough of the grammar of graphics that you should begin to see the patterns in how it is used to express graphical ideas for <code>ggplot2</code>. Now we will work through some examples.</p>
<div id="counting-penguins" class="section level3 hasAnchor" number="5.5.1">
<h3><span class="header-section-number">5.5.1</span> Counting Penguins<a href="data-visualization-in-r.html#counting-penguins" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>First, let’s revisit the <code>penguins</code> data. There are tree categorical features in the data: <code>species</code>, <code>island</code>, and <code>sex</code>. Let’s use <code>geom_bar()</code> to count how many penguins of each species and/or sex were observed on each island. The x-axis of the plot should be the island, but note that there are multiple values of <code>species</code> and <code>sex</code> that have the same position on that x-axis. In this case, you can use the <code>position_dodge()</code> or <code>position_stack()</code> arguments to tell <code>ggplot2</code> how to handle the second grouping channel.</p>
<div class="sourceCode" id="cb467"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb467-1"><a href="data-visualization-in-r.html#cb467-1" tabindex="-1"></a><span class="co"># count the penguins on each island</span></span>
<span id="cb467-2"><a href="data-visualization-in-r.html#cb467-2" tabindex="-1"></a><span class="fu">ggplot</span>(penguins) <span class="sc">+</span></span>
<span id="cb467-3"><a href="data-visualization-in-r.html#cb467-3" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>island) <span class="sc">+</span></span>
<span id="cb467-4"><a href="data-visualization-in-r.html#cb467-4" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb467-5"><a href="data-visualization-in-r.html#cb467-5" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Island&quot;</span>) <span class="sc">+</span></span>
<span id="cb467-6"><a href="data-visualization-in-r.html#cb467-6" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Count&quot;</span>) <span class="sc">+</span></span>
<span id="cb467-7"><a href="data-visualization-in-r.html#cb467-7" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Count of penguins on each island&quot;</span>)</span></code></pre></div>
<p><img src="05_visualization_files/figure-html/counting-penguins-1.png" width="672" /></p>
<div class="sourceCode" id="cb468"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb468-1"><a href="data-visualization-in-r.html#cb468-1" tabindex="-1"></a><span class="co">#count the penguins of each sex on each island</span></span>
<span id="cb468-2"><a href="data-visualization-in-r.html#cb468-2" tabindex="-1"></a><span class="fu">ggplot</span>(penguins) <span class="sc">+</span></span>
<span id="cb468-3"><a href="data-visualization-in-r.html#cb468-3" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>island, <span class="at">fill=</span>sex) <span class="sc">+</span></span>
<span id="cb468-4"><a href="data-visualization-in-r.html#cb468-4" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position=</span><span class="fu">position_dodge</span>()) <span class="sc">+</span></span>
<span id="cb468-5"><a href="data-visualization-in-r.html#cb468-5" tabindex="-1"></a>  <span class="fu">scale_fill_grey</span>() <span class="sc">+</span> </span>
<span id="cb468-6"><a href="data-visualization-in-r.html#cb468-6" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb468-7"><a href="data-visualization-in-r.html#cb468-7" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Island&quot;</span>) <span class="sc">+</span></span>
<span id="cb468-8"><a href="data-visualization-in-r.html#cb468-8" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Count&quot;</span>) <span class="sc">+</span></span>
<span id="cb468-9"><a href="data-visualization-in-r.html#cb468-9" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Count of penguins on each island by sex&quot;</span>)</span></code></pre></div>
<p><img src="05_visualization_files/figure-html/counting-penguins-2.png" width="672" /></p>
<p>Alternatively, you can use facets to separate the data into multiple plots based on a data feature. Let’s see how that works to facet the plots by species.</p>
<p>One way to show more information more clearly in a plot is to break the plot into pieces that each show part of the information. In <code>ggplot2</code>, this is called <em>faceting</em> the plot. There are two main facet functions, <code>facet_grid()</code> (which puts plots in a grid), and <code>facet_wrap()</code>, which puts plots side-by-side until it runs out of room, then wraps to a new line. We’ll use <code>facet_wrap()</code> here, with the first argument being <code>~species</code>. This tells <code>ggplot2</code> to break the plot into pieces by plotting the data for each <code>species</code> separately.</p>
<div class="sourceCode" id="cb469"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb469-1"><a href="data-visualization-in-r.html#cb469-1" tabindex="-1"></a><span class="co">#count the penguins of each species on each island</span></span>
<span id="cb469-2"><a href="data-visualization-in-r.html#cb469-2" tabindex="-1"></a><span class="fu">ggplot</span>(penguins) <span class="sc">+</span></span>
<span id="cb469-3"><a href="data-visualization-in-r.html#cb469-3" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>island) <span class="sc">+</span></span>
<span id="cb469-4"><a href="data-visualization-in-r.html#cb469-4" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb469-5"><a href="data-visualization-in-r.html#cb469-5" tabindex="-1"></a>  <span class="fu">scale_fill_grey</span>() <span class="sc">+</span> </span>
<span id="cb469-6"><a href="data-visualization-in-r.html#cb469-6" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb469-7"><a href="data-visualization-in-r.html#cb469-7" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Island&quot;</span>) <span class="sc">+</span></span>
<span id="cb469-8"><a href="data-visualization-in-r.html#cb469-8" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Count&quot;</span>) <span class="sc">+</span></span>
<span id="cb469-9"><a href="data-visualization-in-r.html#cb469-9" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Count of penguins on each island by species&quot;</span>) <span class="sc">+</span></span>
<span id="cb469-10"><a href="data-visualization-in-r.html#cb469-10" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>species, <span class="at">ncol=</span><span class="dv">3</span>)</span></code></pre></div>
<p><img src="05_visualization_files/figure-html/penguin-facet-species-1.png" width="672" /></p>
</div>
<div id="experimental-data-with-error-bars" class="section level3 hasAnchor" number="5.5.2">
<h3><span class="header-section-number">5.5.2</span> Experimental Data with Error Bars<a href="data-visualization-in-r.html#experimental-data-with-error-bars" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Here’s an example that recently came up in my office hours. You’ve done an experiment to see how mice with two different genotypes respond to two different treatments. Now you want to plot the mean response of each group as a column, with error bars indicating the standard deviation of the mean. You also want to show the raw data. I’ve simulated some data for us to use - download it <a href="https://ucdavis.box.com/s/lxgplwqn23ncbeb5gc6ktpfknr56xws6">here</a>.</p>
<p>This one is kind of complicated because you have to tell <code>ggplot2</code> how to calculate the height of the columns and of the error bars. This involves cr</p>
<div class="sourceCode" id="cb470"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb470-1"><a href="data-visualization-in-r.html#cb470-1" tabindex="-1"></a>mice_geno <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/genotype-response.csv&quot;</span>)</span>
<span id="cb470-2"><a href="data-visualization-in-r.html#cb470-2" tabindex="-1"></a></span>
<span id="cb470-3"><a href="data-visualization-in-r.html#cb470-3" tabindex="-1"></a><span class="co"># show the treatment response for different genotypes</span></span>
<span id="cb470-4"><a href="data-visualization-in-r.html#cb470-4" tabindex="-1"></a><span class="fu">ggplot</span>(mice_geno) <span class="sc">+</span> </span>
<span id="cb470-5"><a href="data-visualization-in-r.html#cb470-5" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>trt, </span>
<span id="cb470-6"><a href="data-visualization-in-r.html#cb470-6" tabindex="-1"></a>      <span class="at">y=</span>resp, </span>
<span id="cb470-7"><a href="data-visualization-in-r.html#cb470-7" tabindex="-1"></a>      <span class="at">fill=</span>genotype) <span class="sc">+</span></span>
<span id="cb470-8"><a href="data-visualization-in-r.html#cb470-8" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette=</span><span class="st">&quot;Dark2&quot;</span>) <span class="sc">+</span></span>
<span id="cb470-9"><a href="data-visualization-in-r.html#cb470-9" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position=</span><span class="fu">position_dodge</span>(),</span>
<span id="cb470-10"><a href="data-visualization-in-r.html#cb470-10" tabindex="-1"></a>           <span class="at">stat=</span><span class="st">&#39;summary&#39;</span>,</span>
<span id="cb470-11"><a href="data-visualization-in-r.html#cb470-11" tabindex="-1"></a>           <span class="at">fun=</span><span class="st">&#39;mean&#39;</span>) <span class="sc">+</span></span>
<span id="cb470-12"><a href="data-visualization-in-r.html#cb470-12" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="at">fun.min=</span><span class="cf">function</span>(x) {<span class="fu">mean</span>(x) <span class="sc">-</span> <span class="fu">sd</span>(x) <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="fu">length</span>(x))},</span>
<span id="cb470-13"><a href="data-visualization-in-r.html#cb470-13" tabindex="-1"></a>               <span class="at">fun.max=</span><span class="cf">function</span>(x) {<span class="fu">mean</span>(x) <span class="sc">+</span> <span class="fu">sd</span>(x) <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="fu">length</span>(x))},</span>
<span id="cb470-14"><a href="data-visualization-in-r.html#cb470-14" tabindex="-1"></a>               <span class="at">stat=</span><span class="st">&#39;summary&#39;</span>,</span>
<span id="cb470-15"><a href="data-visualization-in-r.html#cb470-15" tabindex="-1"></a>               <span class="at">position=</span><span class="fu">position_dodge</span>(<span class="fl">0.9</span>),</span>
<span id="cb470-16"><a href="data-visualization-in-r.html#cb470-16" tabindex="-1"></a>               <span class="at">width=</span><span class="fl">0.2</span>) <span class="sc">+</span> </span>
<span id="cb470-17"><a href="data-visualization-in-r.html#cb470-17" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">position=</span></span>
<span id="cb470-18"><a href="data-visualization-in-r.html#cb470-18" tabindex="-1"></a>               <span class="fu">position_jitterdodge</span>(</span>
<span id="cb470-19"><a href="data-visualization-in-r.html#cb470-19" tabindex="-1"></a>                 <span class="at">dodge.width=</span><span class="fl">0.9</span>,</span>
<span id="cb470-20"><a href="data-visualization-in-r.html#cb470-20" tabindex="-1"></a>                 <span class="at">jitter.width=</span><span class="fl">0.1</span>)) <span class="sc">+</span></span>
<span id="cb470-21"><a href="data-visualization-in-r.html#cb470-21" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Treatment&quot;</span>) <span class="sc">+</span></span>
<span id="cb470-22"><a href="data-visualization-in-r.html#cb470-22" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Response (mm/g)&quot;</span>) <span class="sc">+</span></span>
<span id="cb470-23"><a href="data-visualization-in-r.html#cb470-23" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Mean growth response of mice by genotype and treatment&quot;</span>)</span></code></pre></div>
<p><img src="05_visualization_files/figure-html/example-genotype-1.png" width="672" /></p>
</div>
<div id="bird-flu-mortality" class="section level3 hasAnchor" number="5.5.3">
<h3><span class="header-section-number">5.5.3</span> Bird Flu Mortality<a href="data-visualization-in-r.html#bird-flu-mortality" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>People mail dead birds to the USDA and USGS, where scientists analyze the birds to find out why they died. Right now there is a bird flu epidemic, and the USDA provides public data about the birds in whom the disease has been detected. You can access the data <a href="https://ucdavis.box.com/s/babz1b5ak0kh7q7cktg7k5gzrt2ve9gc">here</a> or see the official USDA webpage <a href="https://www.aphis.usda.gov/aphis/ourfocus/animalhealth/animal-disease-information/avian/avian-influenza/">here</a>. After you download the data, we will load the data and do some visualization.</p>
<div class="sourceCode" id="cb471"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb471-1"><a href="data-visualization-in-r.html#cb471-1" tabindex="-1"></a><span class="co"># load data directly from the USDA website</span></span>
<span id="cb471-2"><a href="data-visualization-in-r.html#cb471-2" tabindex="-1"></a>flu <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/hpai-wild-birds-ver2.csv&quot;</span>)</span>
<span id="cb471-3"><a href="data-visualization-in-r.html#cb471-3" tabindex="-1"></a>flu<span class="sc">$</span>date <span class="ot">&lt;-</span> <span class="fu">mdy</span>(flu<span class="sc">$</span><span class="st">`</span><span class="at">Date Detected</span><span class="st">`</span>)</span>
<span id="cb471-4"><a href="data-visualization-in-r.html#cb471-4" tabindex="-1"></a></span>
<span id="cb471-5"><a href="data-visualization-in-r.html#cb471-5" tabindex="-1"></a><span class="co"># plot a histogram of when bird flu was detected</span></span>
<span id="cb471-6"><a href="data-visualization-in-r.html#cb471-6" tabindex="-1"></a><span class="fu">ggplot</span>(flu) <span class="sc">+</span></span>
<span id="cb471-7"><a href="data-visualization-in-r.html#cb471-7" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> date) <span class="sc">+</span></span>
<span id="cb471-8"><a href="data-visualization-in-r.html#cb471-8" tabindex="-1"></a>  <span class="fu">geom_histogram</span>() <span class="sc">+</span></span>
<span id="cb471-9"><a href="data-visualization-in-r.html#cb471-9" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Bird flu detections in wild birds&quot;</span>) <span class="sc">+</span></span>
<span id="cb471-10"><a href="data-visualization-in-r.html#cb471-10" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Date&quot;</span>) <span class="sc">+</span></span>
<span id="cb471-11"><a href="data-visualization-in-r.html#cb471-11" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Count&quot;</span>)</span></code></pre></div>
<p><img src="05_visualization_files/figure-html/example-bird-flu-1.png" width="672" /></p>
<div class="sourceCode" id="cb472"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb472-1"><a href="data-visualization-in-r.html#cb472-1" tabindex="-1"></a><span class="co"># plot a histogram of when bird flu was detected</span></span>
<span id="cb472-2"><a href="data-visualization-in-r.html#cb472-2" tabindex="-1"></a><span class="fu">ggplot</span>(flu) <span class="sc">+</span></span>
<span id="cb472-3"><a href="data-visualization-in-r.html#cb472-3" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">fill =</span> <span class="st">`</span><span class="at">Sampling Method</span><span class="st">`</span>) <span class="sc">+</span></span>
<span id="cb472-4"><a href="data-visualization-in-r.html#cb472-4" tabindex="-1"></a>  <span class="fu">geom_histogram</span>() <span class="sc">+</span></span>
<span id="cb472-5"><a href="data-visualization-in-r.html#cb472-5" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Bird flu detections in wild birds&quot;</span>) <span class="sc">+</span></span>
<span id="cb472-6"><a href="data-visualization-in-r.html#cb472-6" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Date&quot;</span>) <span class="sc">+</span></span>
<span id="cb472-7"><a href="data-visualization-in-r.html#cb472-7" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Count&quot;</span>)</span></code></pre></div>
<p><img src="05_visualization_files/figure-html/example-bird-flu-2.png" width="672" /></p>
<div class="sourceCode" id="cb473"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb473-1"><a href="data-visualization-in-r.html#cb473-1" tabindex="-1"></a><span class="co"># bar chart shows how the bird flu reports compare between west coast states</span></span>
<span id="cb473-2"><a href="data-visualization-in-r.html#cb473-2" tabindex="-1"></a><span class="fu">subset</span>(flu, State <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;California&quot;</span>, <span class="st">&quot;Oregon&quot;</span>, <span class="st">&quot;Washington&quot;</span>)) <span class="sc">|&gt;</span></span>
<span id="cb473-3"><a href="data-visualization-in-r.html#cb473-3" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb473-4"><a href="data-visualization-in-r.html#cb473-4" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> State, <span class="at">fill =</span> <span class="st">`</span><span class="at">Sampling Method</span><span class="st">`</span>) <span class="sc">+</span></span>
<span id="cb473-5"><a href="data-visualization-in-r.html#cb473-5" tabindex="-1"></a>  <span class="fu">stat_count</span>() <span class="sc">+</span></span>
<span id="cb473-6"><a href="data-visualization-in-r.html#cb473-6" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb473-7"><a href="data-visualization-in-r.html#cb473-7" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Bird flu detections in wild birds (West coast states)&quot;</span>) <span class="sc">+</span></span>
<span id="cb473-8"><a href="data-visualization-in-r.html#cb473-8" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Count&quot;</span>)</span></code></pre></div>
<p><img src="05_visualization_files/figure-html/example-bird-flu-3.png" width="672" /></p>
<p>Let’s compare the bird flu season to the human flu season. Download hospitalization data for the 2021-2022 and 2022-2023 flu seasons from the CDC website <a href="https://gis.cdc.gov/GRASP/Fluview/FluHospRates.html">here</a> or see the official Centers for Disease Control website <a href="https://gis.cdc.gov/GRASP/Fluview/FluHospRates.html">here</a>. After you download the data, we will see how adding a second data series works a little differently from the first. That’s because composing data, aesthetic mapping, and geometry with addition only works when there is no ambiguity about which data series is being mapped or drawn.</p>
<p>After downloading the data, there is some work required to adjust the dates and change the hospitalization rate from cases per 100,000 to cases per 10 million, which better matches the scale of the bird flu data.</p>
<div class="sourceCode" id="cb474"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb474-1"><a href="data-visualization-in-r.html#cb474-1" tabindex="-1"></a><span class="co"># processing CDC flu data:</span></span>
<span id="cb474-2"><a href="data-visualization-in-r.html#cb474-2" tabindex="-1"></a>cdc <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/FluSurveillance_Custom_Download_Data.csv&quot;</span>, <span class="at">skip =</span> <span class="dv">2</span>)</span>
<span id="cb474-3"><a href="data-visualization-in-r.html#cb474-3" tabindex="-1"></a>cdc<span class="sc">$</span>date <span class="ot">&lt;-</span> <span class="fu">as_date</span>(<span class="st">&quot;1950-01-01&quot;</span>)</span>
<span id="cb474-4"><a href="data-visualization-in-r.html#cb474-4" tabindex="-1"></a><span class="fu">year</span>(cdc<span class="sc">$</span>date) <span class="ot">&lt;-</span> cdc<span class="sc">$</span><span class="st">`</span><span class="at">MMWR-YEAR</span><span class="st">`</span></span>
<span id="cb474-5"><a href="data-visualization-in-r.html#cb474-5" tabindex="-1"></a><span class="fu">week</span>(cdc<span class="sc">$</span>date) <span class="ot">&lt;-</span> cdc<span class="sc">$</span><span class="st">`</span><span class="at">MMWR-WEEK</span><span class="st">`</span></span>
<span id="cb474-6"><a href="data-visualization-in-r.html#cb474-6" tabindex="-1"></a></span>
<span id="cb474-7"><a href="data-visualization-in-r.html#cb474-7" tabindex="-1"></a></span>
<span id="cb474-8"><a href="data-visualization-in-r.html#cb474-8" tabindex="-1"></a><span class="co"># get flu hospitalization counts that include all race, sex, and age categories</span></span>
<span id="cb474-9"><a href="data-visualization-in-r.html#cb474-9" tabindex="-1"></a>cdc_overall <span class="ot">&lt;-</span> <span class="fu">subset</span>(</span>
<span id="cb474-10"><a href="data-visualization-in-r.html#cb474-10" tabindex="-1"></a>  cdc,</span>
<span id="cb474-11"><a href="data-visualization-in-r.html#cb474-11" tabindex="-1"></a>  <span class="st">`</span><span class="at">AGE CATEGORY</span><span class="st">`</span> <span class="sc">==</span> <span class="st">&quot;Overall&quot;</span> <span class="sc">&amp;</span></span>
<span id="cb474-12"><a href="data-visualization-in-r.html#cb474-12" tabindex="-1"></a>    <span class="st">`</span><span class="at">SEX CATEGORY</span><span class="st">`</span> <span class="sc">==</span> <span class="st">&quot;Overall&quot;</span> <span class="sc">&amp;</span></span>
<span id="cb474-13"><a href="data-visualization-in-r.html#cb474-13" tabindex="-1"></a>    <span class="st">`</span><span class="at">RACE CATEGORY</span><span class="st">`</span> <span class="sc">==</span> <span class="st">&quot;Overall&quot;</span></span>
<span id="cb474-14"><a href="data-visualization-in-r.html#cb474-14" tabindex="-1"></a>)</span>
<span id="cb474-15"><a href="data-visualization-in-r.html#cb474-15" tabindex="-1"></a></span>
<span id="cb474-16"><a href="data-visualization-in-r.html#cb474-16" tabindex="-1"></a><span class="co"># convert the counts to cases per 10 million</span></span>
<span id="cb474-17"><a href="data-visualization-in-r.html#cb474-17" tabindex="-1"></a>cdc_overall<span class="sc">$</span><span class="st">`</span><span class="at">WEEKLY RATE</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(cdc_overall<span class="sc">$</span><span class="st">`</span><span class="at">WEEKLY RATE</span><span class="st">`</span>) <span class="sc">*</span> <span class="dv">100</span></span></code></pre></div>
<div class="sourceCode" id="cb475"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb475-1"><a href="data-visualization-in-r.html#cb475-1" tabindex="-1"></a><span class="co"># remake the plot but add a new geom_line() with its own data</span></span>
<span id="cb475-2"><a href="data-visualization-in-r.html#cb475-2" tabindex="-1"></a><span class="fu">ggplot</span>(flu) <span class="sc">+</span></span>
<span id="cb475-3"><a href="data-visualization-in-r.html#cb475-3" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">fill =</span> <span class="st">`</span><span class="at">Sampling Method</span><span class="st">`</span>) <span class="sc">+</span></span>
<span id="cb475-4"><a href="data-visualization-in-r.html#cb475-4" tabindex="-1"></a>  <span class="fu">geom_histogram</span>() <span class="sc">+</span></span>
<span id="cb475-5"><a href="data-visualization-in-r.html#cb475-5" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> cdc_overall, </span>
<span id="cb475-6"><a href="data-visualization-in-r.html#cb475-6" tabindex="-1"></a>            <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> <span class="st">`</span><span class="at">WEEKLY RATE</span><span class="st">`</span>), </span>
<span id="cb475-7"><a href="data-visualization-in-r.html#cb475-7" tabindex="-1"></a>            <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb475-8"><a href="data-visualization-in-r.html#cb475-8" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Bird flu detections and human flu hospitalizations&quot;</span>) <span class="sc">+</span></span>
<span id="cb475-9"><a href="data-visualization-in-r.html#cb475-9" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Date&quot;</span>) <span class="sc">+</span></span>
<span id="cb475-10"><a href="data-visualization-in-r.html#cb475-10" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Count&quot;</span>) <span class="sc">+</span></span>
<span id="cb475-11"><a href="data-visualization-in-r.html#cb475-11" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="fu">as_date</span>(<span class="st">&quot;2022-01-01&quot;</span>), <span class="fu">as_date</span>(<span class="st">&quot;2023-05-01&quot;</span>))</span></code></pre></div>
<p><img src="05_visualization_files/figure-html/example-flu-plotting-1.png" width="672" /></p>
</div>
<div id="small-business-loans" class="section level3 hasAnchor" number="5.5.4">
<h3><span class="header-section-number">5.5.4</span> Small Business Loans<a href="data-visualization-in-r.html#small-business-loans" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The US Small Business Administration (SBA) maintains data on the loans it offers to businesses. Data about loans made since 2020 can be found at the <a href="https://data.sba.gov/dataset/7-a-504-foia">Small Business Administration website</a>, or you can download it from <a href="https://ucdavis.box.com/s/ctx6grx10c83lh561ekl9tnmi20561ed">here</a>. We’ll load that data and then explore some ways to visualize it. Since the difference between a $100 loan and a $1000 loan is more like the difference between $100,000 and $1M than between $100,000 ad $100,900, we should put the loan values on a logarithmic scale. You can do this in <code>ggplot2</code> with the <code>scale_y_log10()</code> function (when the loan values are on the y axis).</p>
<div class="sourceCode" id="cb476"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb476-1"><a href="data-visualization-in-r.html#cb476-1" tabindex="-1"></a><span class="co"># load the small business loan data</span></span>
<span id="cb476-2"><a href="data-visualization-in-r.html#cb476-2" tabindex="-1"></a>sba <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/small-business-loans.csv&quot;</span>)</span>
<span id="cb476-3"><a href="data-visualization-in-r.html#cb476-3" tabindex="-1"></a></span>
<span id="cb476-4"><a href="data-visualization-in-r.html#cb476-4" tabindex="-1"></a><span class="co"># check the SBA data to see the data types, etc.</span></span>
<span id="cb476-5"><a href="data-visualization-in-r.html#cb476-5" tabindex="-1"></a><span class="fu">head</span>(sba)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 39
##   AsOfDate Program BorrName       BorrStreet BorrCity BorrState BorrZip BankName
##      &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;          &lt;chr&gt;      &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;   &lt;chr&gt;   
## 1 20230331 7A      Mark Dusa      3623 Swal… Sylvania OH        43560   The Hun…
## 2 20230331 7A      Shaddai Harris 614 Valle… Arlingt… TX        76018   PeopleF…
## 3 20230331 7A      Aqualon Inc.   7180 Agen… Tipp Ci… OH        45371   The Hun…
## 4 20230331 7A      Redline Resta… 2450 Cher… Saint C… FL        34772   SouthSt…
## 5 20230331 7A      Meluota Corp   2702 ASTO… ASTORIA  NY        11102   Santand…
## 6 20230331 7A      Sky Lake Vaca… 15 Nestle… Laconia  NH        03246   TD Bank…
## # ℹ 31 more variables: BankFDICNumber &lt;dbl&gt;, BankNCUANumber &lt;dbl&gt;,
## #   BankStreet &lt;chr&gt;, BankCity &lt;chr&gt;, BankState &lt;chr&gt;, BankZip &lt;chr&gt;,
## #   GrossApproval &lt;dbl&gt;, SBAGuaranteedApproval &lt;dbl&gt;, ApprovalDate &lt;chr&gt;,
## #   ApprovalFiscalYear &lt;dbl&gt;, FirstDisbursementDate &lt;chr&gt;,
## #   DeliveryMethod &lt;chr&gt;, subpgmdesc &lt;chr&gt;, InitialInterestRate &lt;dbl&gt;,
## #   TermInMonths &lt;dbl&gt;, NaicsCode &lt;dbl&gt;, NaicsDescription &lt;chr&gt;,
## #   FranchiseCode &lt;chr&gt;, FranchiseName &lt;chr&gt;, ProjectCounty &lt;chr&gt;, …</code></pre>
<div class="sourceCode" id="cb478"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb478-1"><a href="data-visualization-in-r.html#cb478-1" tabindex="-1"></a><span class="co"># boxplot of loan sizes by business type</span></span>
<span id="cb478-2"><a href="data-visualization-in-r.html#cb478-2" tabindex="-1"></a><span class="fu">subset</span>(sba, ProjectState <span class="sc">==</span> <span class="st">&quot;CA&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb478-3"><a href="data-visualization-in-r.html#cb478-3" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb478-4"><a href="data-visualization-in-r.html#cb478-4" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> BusinessType, <span class="at">y =</span> SBAGuaranteedApproval) <span class="sc">+</span></span>
<span id="cb478-5"><a href="data-visualization-in-r.html#cb478-5" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb478-6"><a href="data-visualization-in-r.html#cb478-6" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>() <span class="sc">+</span></span>
<span id="cb478-7"><a href="data-visualization-in-r.html#cb478-7" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Small Business Administraton guaranteed loans in California&quot;</span>) <span class="sc">+</span></span>
<span id="cb478-8"><a href="data-visualization-in-r.html#cb478-8" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Loan guarantee (dollars)&quot;</span>)</span></code></pre></div>
<p><img src="05_visualization_files/figure-html/example-SBA-1.png" width="672" /></p>
<div class="sourceCode" id="cb479"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb479-1"><a href="data-visualization-in-r.html#cb479-1" tabindex="-1"></a><span class="co"># relationship between loan size and interest rate</span></span>
<span id="cb479-2"><a href="data-visualization-in-r.html#cb479-2" tabindex="-1"></a><span class="fu">subset</span>(sba, ProjectState <span class="sc">==</span> <span class="st">&quot;CA&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb479-3"><a href="data-visualization-in-r.html#cb479-3" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb479-4"><a href="data-visualization-in-r.html#cb479-4" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> GrossApproval, <span class="at">y =</span> InitialInterestRate, ) <span class="sc">+</span></span>
<span id="cb479-5"><a href="data-visualization-in-r.html#cb479-5" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb479-6"><a href="data-visualization-in-r.html#cb479-6" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>BusinessType, <span class="at">ncol =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb479-7"><a href="data-visualization-in-r.html#cb479-7" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb479-8"><a href="data-visualization-in-r.html#cb479-8" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Interest rate as a function of loan size&quot;</span>) <span class="sc">+</span></span>
<span id="cb479-9"><a href="data-visualization-in-r.html#cb479-9" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Loan size (dollars)&quot;</span>) <span class="sc">+</span></span>
<span id="cb479-10"><a href="data-visualization-in-r.html#cb479-10" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Interest rate (%)&quot;</span>)</span></code></pre></div>
<p><img src="05_visualization_files/figure-html/example-SBA-2.png" width="672" /></p>
<p>Now let’s color the points by the loan status. Thankfully, <code>ggplot2</code> integrates directly with <a href="https://colorbrewer2.org">Color Brewer (colorbrewer2.org)</a> to get better color palettes. We will use the <code>Accent</code> color palette, which is just one of the many options that can be found on the Color Brewer site.</p>
<p>There are a lot of data points, which tent to largely overlap and hide each other. We use a smoother (<code>geom_smooth()</code>) to help call out differences that would otherwise be lost in the noise of the points.</p>
<div class="sourceCode" id="cb480"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb480-1"><a href="data-visualization-in-r.html#cb480-1" tabindex="-1"></a><span class="co"># color the dots by the loan status.</span></span>
<span id="cb480-2"><a href="data-visualization-in-r.html#cb480-2" tabindex="-1"></a><span class="fu">subset</span>(sba, ProjectState <span class="sc">==</span> <span class="st">&quot;CA&quot;</span> <span class="sc">&amp;</span> LoanStatus <span class="sc">!=</span> <span class="st">&quot;EXEMPT&quot;</span> <span class="sc">&amp;</span> LoanStatus <span class="sc">!=</span> <span class="st">&quot;CHGOFF&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb480-3"><a href="data-visualization-in-r.html#cb480-3" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb480-4"><a href="data-visualization-in-r.html#cb480-4" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> GrossApproval, <span class="at">y =</span> InitialInterestRate, <span class="at">color =</span> LoanStatus) <span class="sc">+</span></span>
<span id="cb480-5"><a href="data-visualization-in-r.html#cb480-5" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb480-6"><a href="data-visualization-in-r.html#cb480-6" tabindex="-1"></a>  <span class="fu">geom_smooth</span>() <span class="sc">+</span></span>
<span id="cb480-7"><a href="data-visualization-in-r.html#cb480-7" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>BusinessType, <span class="at">ncol =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb480-8"><a href="data-visualization-in-r.html#cb480-8" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb480-9"><a href="data-visualization-in-r.html#cb480-9" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Interest rate as a function of loan size by loan status&quot;</span>) <span class="sc">+</span></span>
<span id="cb480-10"><a href="data-visualization-in-r.html#cb480-10" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Loan size (dollars)&quot;</span>) <span class="sc">+</span></span>
<span id="cb480-11"><a href="data-visualization-in-r.html#cb480-11" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Interest rate (%)&quot;</span>) <span class="sc">+</span></span>
<span id="cb480-12"><a href="data-visualization-in-r.html#cb480-12" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">&quot;Loan status&quot;</span>) <span class="sc">+</span></span>
<span id="cb480-13"><a href="data-visualization-in-r.html#cb480-13" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">type =</span> <span class="st">&quot;qual&quot;</span>, <span class="at">palette =</span> <span class="st">&quot;Accent&quot;</span>)</span></code></pre></div>
<p><img src="05_visualization_files/figure-html/example-SBA-facet-1.png" width="672" /></p>

</div>
</div>
</div>



            </section>

          </div>
        </div>
      </div>
<a href="squashing-bugs-with-rs-debugging-tools.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="language-fundamentals.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/ucdavisdatalab/workshop_intermediate_r/edit/master/05_visualization.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/ucdavisdatalab/workshop_intermediate_r/blob/master/05_visualization.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
