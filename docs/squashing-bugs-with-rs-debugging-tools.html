<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>7 Squashing Bugs with R’s Debugging Tools | Intermediate R</title>
  <meta name="description" content="7 Squashing Bugs with R’s Debugging Tools | Intermediate R" />
  <meta name="generator" content="bookdown 0.38 and GitBook 2.6.7" />

  <meta property="og:title" content="7 Squashing Bugs with R’s Debugging Tools | Intermediate R" />
  <meta property="og:type" content="book" />
  
  
  <meta name="github-repo" content="ucdavisdatalab/workshop_intermediate_r" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="7 Squashing Bugs with R’s Debugging Tools | Intermediate R" />
  
  
  

<meta name="author" content="Nick Ulle and Wesley Brooks" />


<meta name="date" content="2024-03-06" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="best-practices-for-writing-r-scripts.html"/>
<link rel="next" href="data-visualization-in-r.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="https://datalab.ucdavis.edu/">
  <img src="https://datalab.ucdavis.edu/wp-content/uploads/2019/07/datalab-logo-full-color-rgb-1.png" style="height: 100%; width: 100%; object-fit: contain" />
</a></li>
<li><a href="./" style="font-size: 18px">Intermediate R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Overview</a></li>
<li class="part"><span><b>I Cleaning &amp; Reshaping Data</b></span></li>
<li class="chapter" data-level="3" data-path="string-date-processing.html"><a href="string-date-processing.html"><i class="fa fa-check"></i><b>3</b> String &amp; Date Processing</a>
<ul>
<li class="chapter" data-level="3.1" data-path="string-date-processing.html"><a href="string-date-processing.html#the-tidyverse"><i class="fa fa-check"></i><b>3.1</b> The Tidyverse</a></li>
<li class="chapter" data-level="3.2" data-path="string-date-processing.html"><a href="string-date-processing.html#parsing-dates-times"><i class="fa fa-check"></i><b>3.2</b> Parsing Dates &amp; Times</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="string-date-processing.html"><a href="string-date-processing.html#the-lubridate-package"><i class="fa fa-check"></i><b>3.2.1</b> The lubridate Package</a></li>
<li class="chapter" data-level="3.2.2" data-path="string-date-processing.html"><a href="string-date-processing.html#case-study-ocean-temperatures"><i class="fa fa-check"></i><b>3.2.2</b> Case Study: Ocean Temperatures</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="string-date-processing.html"><a href="string-date-processing.html#string-fundamentals"><i class="fa fa-check"></i><b>3.3</b> String Fundamentals</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="string-date-processing.html"><a href="string-date-processing.html#printing"><i class="fa fa-check"></i><b>3.3.1</b> Printing</a></li>
<li class="chapter" data-level="3.3.2" data-path="string-date-processing.html"><a href="string-date-processing.html#escape-sequences"><i class="fa fa-check"></i><b>3.3.2</b> Escape Sequences</a></li>
<li class="chapter" data-level="3.3.3" data-path="string-date-processing.html"><a href="string-date-processing.html#raw-strings"><i class="fa fa-check"></i><b>3.3.3</b> Raw Strings</a></li>
<li class="chapter" data-level="3.3.4" data-path="string-date-processing.html"><a href="string-date-processing.html#character-encodings"><i class="fa fa-check"></i><b>3.3.4</b> Character Encodings</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="string-date-processing.html"><a href="string-date-processing.html#processing-strings"><i class="fa fa-check"></i><b>3.4</b> Processing Strings</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="string-date-processing.html"><a href="string-date-processing.html#the-stringr-package"><i class="fa fa-check"></i><b>3.4.1</b> The stringr Package</a></li>
<li class="chapter" data-level="3.4.2" data-path="string-date-processing.html"><a href="string-date-processing.html#regular-expressions"><i class="fa fa-check"></i><b>3.4.2</b> Regular Expressions</a></li>
<li class="chapter" data-level="3.4.3" data-path="string-date-processing.html"><a href="string-date-processing.html#replacing-parts-of-strings"><i class="fa fa-check"></i><b>3.4.3</b> Replacing Parts of Strings</a></li>
<li class="chapter" data-level="3.4.4" data-path="string-date-processing.html"><a href="string-date-processing.html#splitting-strings"><i class="fa fa-check"></i><b>3.4.4</b> Splitting Strings</a></li>
<li class="chapter" data-level="3.4.5" data-path="string-date-processing.html"><a href="string-date-processing.html#extracting-matches"><i class="fa fa-check"></i><b>3.4.5</b> Extracting Matches</a></li>
<li class="chapter" data-level="3.4.6" data-path="string-date-processing.html"><a href="string-date-processing.html#case-study-u.s.-warehouse-stocks"><i class="fa fa-check"></i><b>3.4.6</b> Case Study: U.S. Warehouse Stocks</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="string-date-processing.html"><a href="string-date-processing.html#regular-expression-examples"><i class="fa fa-check"></i><b>3.5</b> Regular Expression Examples</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="string-date-processing.html"><a href="string-date-processing.html#the-wildcard"><i class="fa fa-check"></i><b>3.5.1</b> The Wildcard</a></li>
<li class="chapter" data-level="3.5.2" data-path="string-date-processing.html"><a href="string-date-processing.html#escape-sequences-1"><i class="fa fa-check"></i><b>3.5.2</b> Escape Sequences</a></li>
<li class="chapter" data-level="3.5.3" data-path="string-date-processing.html"><a href="string-date-processing.html#anchors"><i class="fa fa-check"></i><b>3.5.3</b> Anchors</a></li>
<li class="chapter" data-level="3.5.4" data-path="string-date-processing.html"><a href="string-date-processing.html#character-classes"><i class="fa fa-check"></i><b>3.5.4</b> Character Classes</a></li>
<li class="chapter" data-level="3.5.5" data-path="string-date-processing.html"><a href="string-date-processing.html#quantifiers"><i class="fa fa-check"></i><b>3.5.5</b> Quantifiers</a></li>
<li class="chapter" data-level="3.5.6" data-path="string-date-processing.html"><a href="string-date-processing.html#groups"><i class="fa fa-check"></i><b>3.5.6</b> Groups</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="tidy-relational-data.html"><a href="tidy-relational-data.html"><i class="fa fa-check"></i><b>4</b> Tidy &amp; Relational Data</a>
<ul>
<li class="chapter" data-level="4.1" data-path="tidy-relational-data.html"><a href="tidy-relational-data.html#tidy-datasets"><i class="fa fa-check"></i><b>4.1</b> Tidy Datasets</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="tidy-relational-data.html"><a href="tidy-relational-data.html#the-tidyr-package"><i class="fa fa-check"></i><b>4.1.1</b> The tidyr Package</a></li>
<li class="chapter" data-level="4.1.2" data-path="tidy-relational-data.html"><a href="tidy-relational-data.html#rows-into-columns"><i class="fa fa-check"></i><b>4.1.2</b> Rows into Columns</a></li>
<li class="chapter" data-level="4.1.3" data-path="tidy-relational-data.html"><a href="tidy-relational-data.html#columns-into-rows"><i class="fa fa-check"></i><b>4.1.3</b> Columns into Rows</a></li>
<li class="chapter" data-level="4.1.4" data-path="tidy-relational-data.html"><a href="tidy-relational-data.html#separating-values"><i class="fa fa-check"></i><b>4.1.4</b> Separating Values</a></li>
<li class="chapter" data-level="4.1.5" data-path="tidy-relational-data.html"><a href="tidy-relational-data.html#case-study-smart-ridership"><i class="fa fa-check"></i><b>4.1.5</b> Case Study: SMART Ridership</a></li>
<li class="chapter" data-level="4.1.6" data-path="tidy-relational-data.html"><a href="tidy-relational-data.html#without-tidyr"><i class="fa fa-check"></i><b>4.1.6</b> Without <code>tidyr</code></a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="tidy-relational-data.html"><a href="tidy-relational-data.html#relational-datasets"><i class="fa fa-check"></i><b>4.2</b> Relational Datasets</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="tidy-relational-data.html"><a href="tidy-relational-data.html#the-dplyr-package"><i class="fa fa-check"></i><b>4.2.1</b> The dplyr Package</a></li>
<li class="chapter" data-level="4.2.2" data-path="tidy-relational-data.html"><a href="tidy-relational-data.html#gradebook-dataset"><i class="fa fa-check"></i><b>4.2.2</b> Gradebook Dataset</a></li>
<li class="chapter" data-level="4.2.3" data-path="tidy-relational-data.html"><a href="tidy-relational-data.html#left-joins"><i class="fa fa-check"></i><b>4.2.3</b> Left Joins</a></li>
<li class="chapter" data-level="4.2.4" data-path="tidy-relational-data.html"><a href="tidy-relational-data.html#other-joins"><i class="fa fa-check"></i><b>4.2.4</b> Other Joins</a></li>
<li class="chapter" data-level="4.2.5" data-path="tidy-relational-data.html"><a href="tidy-relational-data.html#getting-clever-with-join_by"><i class="fa fa-check"></i><b>4.2.5</b> Getting Clever with <code>join_by</code></a></li>
<li class="chapter" data-level="4.2.6" data-path="tidy-relational-data.html"><a href="tidy-relational-data.html#examples"><i class="fa fa-check"></i><b>4.2.6</b> Examples</a></li>
<li class="chapter" data-level="4.2.7" data-path="tidy-relational-data.html"><a href="tidy-relational-data.html#be-explicit"><i class="fa fa-check"></i><b>4.2.7</b> Be Explicit</a></li>
<li class="chapter" data-level="4.2.8" data-path="tidy-relational-data.html"><a href="tidy-relational-data.html#conclusion"><i class="fa fa-check"></i><b>4.2.8</b> Conclusion</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Writing &amp; Debugging R Code</b></span></li>
<li class="chapter" data-level="6" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html"><i class="fa fa-check"></i><b>6</b> Best Practices for Writing R Scripts</a>
<ul>
<li class="chapter" data-level="6.1" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#introduction"><i class="fa fa-check"></i><b>6.1</b> Introduction</a></li>
<li class="chapter" data-level="6.2" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#case-study-us-fruit-prices"><i class="fa fa-check"></i><b>6.2</b> Case Study: U.S. Fruit Prices</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#setting-up-the-project"><i class="fa fa-check"></i><b>6.2.1</b> Setting Up the Project</a></li>
<li class="chapter" data-level="6.2.2" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#setting-up-the-script"><i class="fa fa-check"></i><b>6.2.2</b> Setting Up the Script</a></li>
<li class="chapter" data-level="6.2.3" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#reading-the-pear-data"><i class="fa fa-check"></i><b>6.2.3</b> Reading the Pear Data</a></li>
<li class="chapter" data-level="6.2.4" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#getting-the-fruit-name"><i class="fa fa-check"></i><b>6.2.4</b> Getting the Fruit Name</a></li>
<li class="chapter" data-level="6.2.5" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#getting-the-column-names"><i class="fa fa-check"></i><b>6.2.5</b> Getting the Column Names</a></li>
<li class="chapter" data-level="6.2.6" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#getting-the-price-data"><i class="fa fa-check"></i><b>6.2.6</b> Getting the Price Data</a></li>
<li class="chapter" data-level="6.2.7" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#testing-the-script"><i class="fa fa-check"></i><b>6.2.7</b> Testing the Script</a></li>
<li class="chapter" data-level="6.2.8" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#iterating-over-all-fruit"><i class="fa fa-check"></i><b>6.2.8</b> Iterating Over All Fruit</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#managing-environments"><i class="fa fa-check"></i><b>6.3</b> Managing Environments</a></li>
<li class="chapter" data-level="6.4" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#iteration-strategies"><i class="fa fa-check"></i><b>6.4</b> Iteration Strategies</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#for-loops"><i class="fa fa-check"></i><b>6.4.1</b> For-loops</a></li>
<li class="chapter" data-level="6.4.2" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#while-loops"><i class="fa fa-check"></i><b>6.4.2</b> While-loops</a></li>
<li class="chapter" data-level="6.4.3" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#saving-multiple-results"><i class="fa fa-check"></i><b>6.4.3</b> Saving Multiple Results</a></li>
<li class="chapter" data-level="6.4.4" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#break-next"><i class="fa fa-check"></i><b>6.4.4</b> Break &amp; Next</a></li>
<li class="chapter" data-level="6.4.5" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#planning-for-iteration"><i class="fa fa-check"></i><b>6.4.5</b> Planning for Iteration</a></li>
<li class="chapter" data-level="6.4.6" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#case-study-the-collatz-conjecture"><i class="fa fa-check"></i><b>6.4.6</b> Case Study: The Collatz Conjecture</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#printing-output"><i class="fa fa-check"></i><b>6.5</b> Printing Output</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#the-print-function"><i class="fa fa-check"></i><b>6.5.1</b> The <code>print</code> Function</a></li>
<li class="chapter" data-level="6.5.2" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#the-message-function"><i class="fa fa-check"></i><b>6.5.2</b> The <code>message</code> Function</a></li>
<li class="chapter" data-level="6.5.3" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#the-cat-function"><i class="fa fa-check"></i><b>6.5.3</b> The <code>cat</code> Function</a></li>
<li class="chapter" data-level="6.5.4" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#formatting-output"><i class="fa fa-check"></i><b>6.5.4</b> Formatting Output</a></li>
<li class="chapter" data-level="6.5.5" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#logging-output"><i class="fa fa-check"></i><b>6.5.5</b> Logging Output</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#reading-input"><i class="fa fa-check"></i><b>6.6</b> Reading Input</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#command-line-arguments"><i class="fa fa-check"></i><b>6.6.1</b> Command Line Arguments</a></li>
<li class="chapter" data-level="6.6.2" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#configuration-files"><i class="fa fa-check"></i><b>6.6.2</b> Configuration Files</a></li>
<li class="chapter" data-level="6.6.3" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#prompts"><i class="fa fa-check"></i><b>6.6.3</b> Prompts</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="squashing-bugs-with-rs-debugging-tools.html"><a href="squashing-bugs-with-rs-debugging-tools.html"><i class="fa fa-check"></i><b>7</b> Squashing Bugs with R’s Debugging Tools</a>
<ul>
<li class="chapter" data-level="7.1" data-path="squashing-bugs-with-rs-debugging-tools.html"><a href="squashing-bugs-with-rs-debugging-tools.html#printing-1"><i class="fa fa-check"></i><b>7.1</b> Printing</a></li>
<li class="chapter" data-level="7.2" data-path="squashing-bugs-with-rs-debugging-tools.html"><a href="squashing-bugs-with-rs-debugging-tools.html#the-conditions-system"><i class="fa fa-check"></i><b>7.2</b> The Conditions System</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="squashing-bugs-with-rs-debugging-tools.html"><a href="squashing-bugs-with-rs-debugging-tools.html#raising-conditions"><i class="fa fa-check"></i><b>7.2.1</b> Raising Conditions</a></li>
<li class="chapter" data-level="7.2.2" data-path="squashing-bugs-with-rs-debugging-tools.html"><a href="squashing-bugs-with-rs-debugging-tools.html#handling-conditions"><i class="fa fa-check"></i><b>7.2.2</b> Handling Conditions</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="squashing-bugs-with-rs-debugging-tools.html"><a href="squashing-bugs-with-rs-debugging-tools.html#global-options"><i class="fa fa-check"></i><b>7.3</b> Global Options</a></li>
<li class="chapter" data-level="7.4" data-path="squashing-bugs-with-rs-debugging-tools.html"><a href="squashing-bugs-with-rs-debugging-tools.html#debugging"><i class="fa fa-check"></i><b>7.4</b> Debugging</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="squashing-bugs-with-rs-debugging-tools.html"><a href="squashing-bugs-with-rs-debugging-tools.html#read-your-errors-and-warnings"><i class="fa fa-check"></i><b>7.4.1</b> Read Your Errors and Warnings</a></li>
<li class="chapter" data-level="7.4.2" data-path="squashing-bugs-with-rs-debugging-tools.html"><a href="squashing-bugs-with-rs-debugging-tools.html#workflow-debugging"><i class="fa fa-check"></i><b>7.4.2</b> Workflow Debugging</a></li>
<li class="chapter" data-level="7.4.3" data-path="squashing-bugs-with-rs-debugging-tools.html"><a href="squashing-bugs-with-rs-debugging-tools.html#isolate-the-problem"><i class="fa fa-check"></i><b>7.4.3</b> Isolate the Problem</a></li>
<li class="chapter" data-level="7.4.4" data-path="squashing-bugs-with-rs-debugging-tools.html"><a href="squashing-bugs-with-rs-debugging-tools.html#functions-for-debugging"><i class="fa fa-check"></i><b>7.4.4</b> Functions for debugging</a></li>
<li class="chapter" data-level="7.4.5" data-path="squashing-bugs-with-rs-debugging-tools.html"><a href="squashing-bugs-with-rs-debugging-tools.html#other-functions"><i class="fa fa-check"></i><b>7.4.5</b> Other Functions</a></li>
<li class="chapter" data-level="7.4.6" data-path="squashing-bugs-with-rs-debugging-tools.html"><a href="squashing-bugs-with-rs-debugging-tools.html#debugging-case-study-bootstrapping-average-penguin-mass"><i class="fa fa-check"></i><b>7.4.6</b> Debugging Case Study: Bootstrapping Average Penguin Mass</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="squashing-bugs-with-rs-debugging-tools.html"><a href="squashing-bugs-with-rs-debugging-tools.html#measuring-performance"><i class="fa fa-check"></i><b>7.5</b> Measuring Performance</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="squashing-bugs-with-rs-debugging-tools.html"><a href="squashing-bugs-with-rs-debugging-tools.html#estimating-memory-usage"><i class="fa fa-check"></i><b>7.5.1</b> Estimating Memory Usage</a></li>
<li class="chapter" data-level="7.5.2" data-path="squashing-bugs-with-rs-debugging-tools.html"><a href="squashing-bugs-with-rs-debugging-tools.html#benchmarking"><i class="fa fa-check"></i><b>7.5.2</b> Benchmarking</a></li>
<li class="chapter" data-level="7.5.3" data-path="squashing-bugs-with-rs-debugging-tools.html"><a href="squashing-bugs-with-rs-debugging-tools.html#profiling"><i class="fa fa-check"></i><b>7.5.3</b> Profiling</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III Data Visualization &amp; Analysis in R</b></span></li>
<li class="chapter" data-level="9" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html"><i class="fa fa-check"></i><b>9</b> Data Visualization in R</a>
<ul>
<li class="chapter" data-level="9.1" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#our-friend-ggplot2"><i class="fa fa-check"></i><b>9.1</b> Our Friend <code>ggplot2</code></a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#the-grammar-of-graphics"><i class="fa fa-check"></i><b>9.1.1</b> The Grammar of Graphics</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#example-palmer-penguins"><i class="fa fa-check"></i><b>9.2</b> Example: Palmer Penguins</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#examining-the-plot"><i class="fa fa-check"></i><b>9.2.1</b> Examining the Plot</a></li>
<li class="chapter" data-level="9.2.2" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#duplicating-the-palmer-penguins-plot"><i class="fa fa-check"></i><b>9.2.2</b> Duplicating the Palmer Penguins Plot</a></li>
<li class="chapter" data-level="9.2.3" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#analysis"><i class="fa fa-check"></i><b>9.2.3</b> Analysis</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#layers"><i class="fa fa-check"></i><b>9.3</b> Layers</a></li>
<li class="chapter" data-level="9.4" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#guidelines-for-graphics"><i class="fa fa-check"></i><b>9.4</b> Guidelines for Graphics</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#data"><i class="fa fa-check"></i><b>9.4.1</b> Data</a></li>
<li class="chapter" data-level="9.4.2" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#feature-types"><i class="fa fa-check"></i><b>9.4.2</b> Feature Types</a></li>
<li class="chapter" data-level="9.4.3" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#theme-guidelines"><i class="fa fa-check"></i><b>9.4.3</b> Theme Guidelines</a></li>
<li class="chapter" data-level="9.4.4" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#scale-guidelines"><i class="fa fa-check"></i><b>9.4.4</b> Scale Guidelines</a></li>
<li class="chapter" data-level="9.4.5" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#facet-guidelines"><i class="fa fa-check"></i><b>9.4.5</b> Facet Guidelines</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#case-studies"><i class="fa fa-check"></i><b>9.5</b> Case Studies</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#counting-penguins"><i class="fa fa-check"></i><b>9.5.1</b> Counting Penguins</a></li>
<li class="chapter" data-level="9.5.2" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#experimental-data-with-error-bars"><i class="fa fa-check"></i><b>9.5.2</b> Experimental Data with Error Bars</a></li>
<li class="chapter" data-level="9.5.3" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#bird-flu-mortality"><i class="fa fa-check"></i><b>9.5.3</b> Bird Flu Mortality</a></li>
<li class="chapter" data-level="9.5.4" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#small-business-loans"><i class="fa fa-check"></i><b>9.5.4</b> Small Business Loans</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV Thinking in R</b></span></li>
<li class="chapter" data-level="11" data-path="language-fundamentals.html"><a href="language-fundamentals.html"><i class="fa fa-check"></i><b>11</b> Language Fundamentals</a>
<ul>
<li class="chapter" data-level="11.1" data-path="language-fundamentals.html"><a href="language-fundamentals.html#variables-environments"><i class="fa fa-check"></i><b>11.1</b> Variables &amp; Environments</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="language-fundamentals.html"><a href="language-fundamentals.html#whats-an-environment"><i class="fa fa-check"></i><b>11.1.1</b> What’s an Environment?</a></li>
<li class="chapter" data-level="11.1.2" data-path="language-fundamentals.html"><a href="language-fundamentals.html#reference-objects"><i class="fa fa-check"></i><b>11.1.2</b> Reference Objects</a></li>
<li class="chapter" data-level="11.1.3" data-path="language-fundamentals.html"><a href="language-fundamentals.html#the-local-environment"><i class="fa fa-check"></i><b>11.1.3</b> The Local Environment</a></li>
<li class="chapter" data-level="11.1.4" data-path="language-fundamentals.html"><a href="language-fundamentals.html#call-environments"><i class="fa fa-check"></i><b>11.1.4</b> Call Environments</a></li>
<li class="chapter" data-level="11.1.5" data-path="language-fundamentals.html"><a href="language-fundamentals.html#lexical-scoping"><i class="fa fa-check"></i><b>11.1.5</b> Lexical Scoping</a></li>
<li class="chapter" data-level="11.1.6" data-path="language-fundamentals.html"><a href="language-fundamentals.html#variable-lookup"><i class="fa fa-check"></i><b>11.1.6</b> Variable Lookup</a></li>
<li class="chapter" data-level="11.1.7" data-path="language-fundamentals.html"><a href="language-fundamentals.html#the-search-path"><i class="fa fa-check"></i><b>11.1.7</b> The Search Path</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="language-fundamentals.html"><a href="language-fundamentals.html#closures"><i class="fa fa-check"></i><b>11.2</b> Closures</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="language-fundamentals.html"><a href="language-fundamentals.html#tidy-closures"><i class="fa fa-check"></i><b>11.2.1</b> Tidy Closures</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="language-fundamentals.html"><a href="language-fundamentals.html#attributes"><i class="fa fa-check"></i><b>11.3</b> Attributes</a></li>
<li class="chapter" data-level="11.4" data-path="language-fundamentals.html"><a href="language-fundamentals.html#s3"><i class="fa fa-check"></i><b>11.4</b> S3</a>
<ul>
<li class="chapter" data-level="11.4.1" data-path="language-fundamentals.html"><a href="language-fundamentals.html#method-dispatch"><i class="fa fa-check"></i><b>11.4.1</b> Method Dispatch</a></li>
<li class="chapter" data-level="11.4.2" data-path="language-fundamentals.html"><a href="language-fundamentals.html#creating-objects"><i class="fa fa-check"></i><b>11.4.2</b> Creating Objects</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="language-fundamentals.html"><a href="language-fundamentals.html#other-object-systems"><i class="fa fa-check"></i><b>11.5</b> Other Object Systems</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="part-2.html"><a href="part-2.html"><i class="fa fa-check"></i><b>12</b> Part 2</a></li>
<li class="part"><span><b>V Backmatter</b></span></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="chapter" data-level="" data-path="assessment.html"><a href="assessment.html"><i class="fa fa-check"></i>Assessment</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Intermediate R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="squashing-bugs-with-rs-debugging-tools" class="section level1 hasAnchor" number="7">
<h1><span class="header-section-number">7</span> Squashing Bugs with R’s Debugging Tools<a href="squashing-bugs-with-rs-debugging-tools.html#squashing-bugs-with-rs-debugging-tools" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>The major topics of this chapter are how to print output, how R’s conditions
system for warnings and errors works, how to use the R debugger, and how to
estimate the performance of R code.</p>
<div id="learning-objectives-3" class="section level4 unnumbered hasAnchor">
<h4>Learning Objectives<a href="squashing-bugs-with-rs-debugging-tools.html#learning-objectives-3" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>After completing this session, learners should be able to:</p>
<ul>
<li>Use R’s conditions system to raise and catch messages, warnings, and errors</li>
<li>Use R’s debugging functions to diagnose bugs in code</li>
<li>Estimate the amount of memory a data set will require</li>
<li>Use the lobstr package to get memory usage for an R object</li>
<li>Describe what a profiler is and why you would use one</li>
<li>Describe what kinds of profiling tools R provides</li>
</ul>
</div>
<div id="printing-1" class="section level2 hasAnchor" number="7.1">
<h2><span class="header-section-number">7.1</span> Printing<a href="squashing-bugs-with-rs-debugging-tools.html#printing-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Perhaps the simplest thing you can do to get a better understanding of some
code is make it print out lots of information about what’s happening as it
runs. You can use the <code>print</code> function to print values in a way that exposes
details important to programmers.</p>
<p>For example, when printing a vector, the function prints the position of the
first element on each line in square brackets <code>[ ]</code>:</p>
<div class="sourceCode" id="cb393"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb393-1"><a href="squashing-bugs-with-rs-debugging-tools.html#cb393-1" tabindex="-1"></a><span class="fu">print</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>)</span></code></pre></div>
<pre><code>##   [1]   1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  18
##  [19]  19  20  21  22  23  24  25  26  27  28  29  30  31  32  33  34  35  36
##  [37]  37  38  39  40  41  42  43  44  45  46  47  48  49  50  51  52  53  54
##  [55]  55  56  57  58  59  60  61  62  63  64  65  66  67  68  69  70  71  72
##  [73]  73  74  75  76  77  78  79  80  81  82  83  84  85  86  87  88  89  90
##  [91]  91  92  93  94  95  96  97  98  99 100</code></pre>
<p>The <code>print</code> function also prints quotes around strings:</p>
<div class="sourceCode" id="cb395"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb395-1"><a href="squashing-bugs-with-rs-debugging-tools.html#cb395-1" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&quot;Hi&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Hi&quot;</code></pre>
<p>These features make the <code>print</code> function ideal for printing information when
you’re trying to understand some code or diagnose a bug.</p>
</div>
<div id="the-conditions-system" class="section level2 hasAnchor" number="7.2">
<h2><span class="header-section-number">7.2</span> The Conditions System<a href="squashing-bugs-with-rs-debugging-tools.html#the-conditions-system" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>R’s conditions system provides a way to signal and handle unusual conditions
that arise while code runs. With the conditions system, you can make R print
status, warning, and error messages that make it easier for users to understand
what your code is doing and whether they’re using it as intended. The condition
system also makes it possible to safely run code that might cause an error, and
respond appropriately in the event that it does. In short, understanding the
conditions system will enable you write code that’s easier to use and more
robust.</p>
<div id="raising-conditions" class="section level3 hasAnchor" number="7.2.1">
<h3><span class="header-section-number">7.2.1</span> Raising Conditions<a href="squashing-bugs-with-rs-debugging-tools.html#raising-conditions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>message</code>, <code>warning</code>, and <code>stop</code> functions are the primary ways to
<strong>raise</strong>, or signal, conditions.</p>
<p>The <code>message</code> function is the primary way to print output (see Section
<a href="best-practices-for-writing-r-scripts.html#printing-output">6.5</a> for alternatives). A message provides status information
about running code, but does not necessarily indicate that something has gone
wrong. You can use messages to print out any information you think might be
relevant to users.</p>
<p>The <code>warning</code> function raises a <strong>warning</strong>. Warnings indicate that something
unexpected happened, but that it didn’t stop the code from running. By default,
R doesn’t print warnings to the console until code finishes running, which can
make it difficult to understand their cause; Section <a href="squashing-bugs-with-rs-debugging-tools.html#global-options">7.3</a>
explains how to change this setting.</p>
<p>Unnamed arguments to the <code>warning</code> function are concatenated with no separator
between them, in the same way as arguments to the <code>message</code> function. For
example:</p>
<div class="sourceCode" id="cb397"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb397-1"><a href="squashing-bugs-with-rs-debugging-tools.html#cb397-1" tabindex="-1"></a><span class="fu">warning</span>(<span class="st">&quot;Objects in mirror&quot;</span>, <span class="st">&quot; may be closer than they appear.&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: Objects in mirror may be closer than they appear.</code></pre>
<p>Warnings are always printed with <code>Warning:</code> before the message. By default,
calling <code>warning</code> from the body of a function also prints the name of the
function:</p>
<div class="sourceCode" id="cb399"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb399-1"><a href="squashing-bugs-with-rs-debugging-tools.html#cb399-1" tabindex="-1"></a>f <span class="ot">=</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb399-2"><a href="squashing-bugs-with-rs-debugging-tools.html#cb399-2" tabindex="-1"></a>  <span class="fu">warning</span>(<span class="st">&quot;This is a warning!&quot;</span>)</span>
<span id="cb399-3"><a href="squashing-bugs-with-rs-debugging-tools.html#cb399-3" tabindex="-1"></a>  x <span class="sc">+</span> y</span>
<span id="cb399-4"><a href="squashing-bugs-with-rs-debugging-tools.html#cb399-4" tabindex="-1"></a>}</span>
<span id="cb399-5"><a href="squashing-bugs-with-rs-debugging-tools.html#cb399-5" tabindex="-1"></a><span class="fu">f</span>(<span class="dv">3</span>, <span class="dv">4</span>)</span></code></pre></div>
<pre><code>## Warning in f(3, 4): This is a warning!</code></pre>
<pre><code>## [1] 7</code></pre>
<p>The name of the function that raised the warning is generally useful
information for users that want to correct whatever caused the warning.
Occasionally, you might want to disable this behavior, which you can do by
setting <code>call. = FALSE</code>:</p>
<div class="sourceCode" id="cb402"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb402-1"><a href="squashing-bugs-with-rs-debugging-tools.html#cb402-1" tabindex="-1"></a>f <span class="ot">=</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb402-2"><a href="squashing-bugs-with-rs-debugging-tools.html#cb402-2" tabindex="-1"></a>  <span class="fu">warning</span>(<span class="st">&quot;This is a warning!&quot;</span>, <span class="at">call. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb402-3"><a href="squashing-bugs-with-rs-debugging-tools.html#cb402-3" tabindex="-1"></a>  x <span class="sc">+</span> y</span>
<span id="cb402-4"><a href="squashing-bugs-with-rs-debugging-tools.html#cb402-4" tabindex="-1"></a>}</span>
<span id="cb402-5"><a href="squashing-bugs-with-rs-debugging-tools.html#cb402-5" tabindex="-1"></a></span>
<span id="cb402-6"><a href="squashing-bugs-with-rs-debugging-tools.html#cb402-6" tabindex="-1"></a><span class="fu">f</span>(<span class="dv">3</span>, <span class="dv">4</span>)</span></code></pre></div>
<pre><code>## Warning: This is a warning!</code></pre>
<pre><code>## [1] 7</code></pre>
<p>The <code>warning</code> function also has several other parameters that control when and
how warnings are displayed.</p>
<p>The <code>stop</code> function raises an <strong>error</strong>, which indicates that something
unexpected happened that prevents the code from running, and immediately stops
the evaluation of code. As a result, R prints errors as soon as they’re raised.
For instance, in this function, the line <code>x + y</code> never runs:</p>
<div class="sourceCode" id="cb405"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb405-1"><a href="squashing-bugs-with-rs-debugging-tools.html#cb405-1" tabindex="-1"></a>f <span class="ot">=</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb405-2"><a href="squashing-bugs-with-rs-debugging-tools.html#cb405-2" tabindex="-1"></a>  <span class="fu">stop</span>()</span>
<span id="cb405-3"><a href="squashing-bugs-with-rs-debugging-tools.html#cb405-3" tabindex="-1"></a>  x <span class="sc">+</span> y</span>
<span id="cb405-4"><a href="squashing-bugs-with-rs-debugging-tools.html#cb405-4" tabindex="-1"></a>}</span>
<span id="cb405-5"><a href="squashing-bugs-with-rs-debugging-tools.html#cb405-5" tabindex="-1"></a></span>
<span id="cb405-6"><a href="squashing-bugs-with-rs-debugging-tools.html#cb405-6" tabindex="-1"></a><span class="fu">f</span>(<span class="dv">3</span>, <span class="dv">4</span>)</span></code></pre></div>
<pre><code>## Error in f(3, 4):</code></pre>
<p>Like <code>message</code> and <code>warning</code>, the <code>stop</code> function concatenates its unnamed
arguments into a message to print:</p>
<div class="sourceCode" id="cb407"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb407-1"><a href="squashing-bugs-with-rs-debugging-tools.html#cb407-1" tabindex="-1"></a><span class="fu">stop</span>(<span class="st">&quot;I&#39;m afraid something has gone terribly wrong.&quot;</span>)</span></code></pre></div>
<pre><code>## Error in eval(expr, envir, enclos): I&#39;m afraid something has gone terribly wrong.</code></pre>
<p>Errors are always printed with <code>Error:</code> before the error message. You can use
the <code>call.</code> parameter to control whether the error message also includes the
name of the function from which <code>stop</code> was called.</p>
<p>When writing code—especially functions, executable scripts, and
packages—it’s a good habit to include tests for unexpected conditions such as
invalid arguments and impossible results. If the tests detect a problem, use
the <code>warning</code> or <code>stop</code> function (depending on severity) to signal what the
problem is. Try to provide a concise but descriptive warning or error message
so that users can easily understand what went wrong.</p>
</div>
<div id="handling-conditions" class="section level3 hasAnchor" number="7.2.2">
<h3><span class="header-section-number">7.2.2</span> Handling Conditions<a href="squashing-bugs-with-rs-debugging-tools.html#handling-conditions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In some cases, you can anticipate the problems likely to occur when code runs
and can even devise ways to work around them. As an example, suppose your code
is supposed to load parameters from a configuration file, but the path to the
file provided by the user is invalid. It might still be possible for your code
to run by falling back on a set of default parameters. R’s conditions system
provides a way to handle or “catch” messages, warnings, and errors, and to run
alternative code in response.</p>
<p>You can use the <code>try</code> function to safely run code that might produce an error.
If no error occurs, the <code>try</code> function returns whatever the result of the code
was. If an error does occur, the <code>try</code> function prints the error message and
returns an object of class <code>try-error</code>, but evaluation does not stop. For
example:</p>
<div class="sourceCode" id="cb409"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb409-1"><a href="squashing-bugs-with-rs-debugging-tools.html#cb409-1" tabindex="-1"></a>bad_add <span class="ot">=</span> <span class="cf">function</span>(x) {</span>
<span id="cb409-2"><a href="squashing-bugs-with-rs-debugging-tools.html#cb409-2" tabindex="-1"></a>  <span class="co"># No error</span></span>
<span id="cb409-3"><a href="squashing-bugs-with-rs-debugging-tools.html#cb409-3" tabindex="-1"></a>  x1 <span class="ot">=</span> <span class="fu">try</span>(<span class="dv">5</span> <span class="sc">+</span> x)</span>
<span id="cb409-4"><a href="squashing-bugs-with-rs-debugging-tools.html#cb409-4" tabindex="-1"></a>  <span class="co"># Error</span></span>
<span id="cb409-5"><a href="squashing-bugs-with-rs-debugging-tools.html#cb409-5" tabindex="-1"></a>  x2 <span class="ot">=</span> <span class="fu">try</span>(<span class="st">&quot;yay&quot;</span> <span class="sc">+</span> x)</span>
<span id="cb409-6"><a href="squashing-bugs-with-rs-debugging-tools.html#cb409-6" tabindex="-1"></a></span>
<span id="cb409-7"><a href="squashing-bugs-with-rs-debugging-tools.html#cb409-7" tabindex="-1"></a>  <span class="fu">list</span>(x1, x2)</span>
<span id="cb409-8"><a href="squashing-bugs-with-rs-debugging-tools.html#cb409-8" tabindex="-1"></a>}</span>
<span id="cb409-9"><a href="squashing-bugs-with-rs-debugging-tools.html#cb409-9" tabindex="-1"></a></span>
<span id="cb409-10"><a href="squashing-bugs-with-rs-debugging-tools.html#cb409-10" tabindex="-1"></a><span class="fu">bad_add</span>(<span class="dv">10</span>)</span></code></pre></div>
<pre><code>## Error in &quot;yay&quot; + x : non-numeric argument to binary operator</code></pre>
<pre><code>## [[1]]
## [1] 15
## 
## [[2]]
## [1] &quot;Error in \&quot;yay\&quot; + x : non-numeric argument to binary operator\n&quot;
## attr(,&quot;class&quot;)
## [1] &quot;try-error&quot;
## attr(,&quot;condition&quot;)
## &lt;simpleError in &quot;yay&quot; + x: non-numeric argument to binary operator&gt;</code></pre>
<p>The simplest thing you can do in response to an error is ignore it. This is
usually not a good idea, but if you understand exactly what went wrong, can’t
fix it easily, and know it won’t affect the rest of your code, doing so might
be the best option.</p>
<p>A more robust approach is to inspect the result from a call to <code>try</code> to see if
an error occurred, and then take some appropriate action if one did. You can
use the <code>inherits</code> function to check whether an object has a specific class, so
here’s a template for how to run code that might cause an error, check for the
error, and respond to it:</p>
<div class="sourceCode" id="cb412"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb412-1"><a href="squashing-bugs-with-rs-debugging-tools.html#cb412-1" tabindex="-1"></a>result <span class="ot">=</span> <span class="fu">try</span>({</span>
<span id="cb412-2"><a href="squashing-bugs-with-rs-debugging-tools.html#cb412-2" tabindex="-1"></a>  <span class="co"># Code that might cause an error.</span></span>
<span id="cb412-3"><a href="squashing-bugs-with-rs-debugging-tools.html#cb412-3" tabindex="-1"></a>})</span>
<span id="cb412-4"><a href="squashing-bugs-with-rs-debugging-tools.html#cb412-4" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">inherits</span>(result, <span class="st">&quot;try-error&quot;</span>)) {</span>
<span id="cb412-5"><a href="squashing-bugs-with-rs-debugging-tools.html#cb412-5" tabindex="-1"></a>  <span class="co"># Code to respond to the error.</span></span>
<span id="cb412-6"><a href="squashing-bugs-with-rs-debugging-tools.html#cb412-6" tabindex="-1"></a>}</span></code></pre></div>
<p>You can prevent the <code>try</code> function from printing error messages by setting
<code>silent = TRUE</code>. This is useful when your code is designed to detect and handle
the error, so you don’t users to think an error occurred.</p>
<p>The <code>tryCatch</code> function provides another way to handle conditions raised by a
piece of code. It requires that you provide a <strong>handler function</strong> for each
kind of condition you want to handle. The kinds of conditions are:</p>
<ul>
<li><code>message</code></li>
<li><code>warning</code></li>
<li><code>error</code></li>
<li><code>interrupt</code> – when the user interrupts the code (for example, by
pressing Ctrl-C)</li>
</ul>
<p>Each handler function must accept exactly one argument.</p>
<p>When you call <code>tryCatch</code>, if the suspect code raises a condition, then it calls
the associated handler function and returns whatever the handler returns.
Otherwise, <code>tryCatch</code> returns the result of the code.</p>
<p>Here’s an example of using <code>tryCatch</code> to catch an error:</p>
<div class="sourceCode" id="cb413"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb413-1"><a href="squashing-bugs-with-rs-debugging-tools.html#cb413-1" tabindex="-1"></a>bad_fn <span class="ot">=</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb413-2"><a href="squashing-bugs-with-rs-debugging-tools.html#cb413-2" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">&quot;Hi&quot;</span>)</span>
<span id="cb413-3"><a href="squashing-bugs-with-rs-debugging-tools.html#cb413-3" tabindex="-1"></a>  x <span class="sc">+</span> y</span>
<span id="cb413-4"><a href="squashing-bugs-with-rs-debugging-tools.html#cb413-4" tabindex="-1"></a>}</span>
<span id="cb413-5"><a href="squashing-bugs-with-rs-debugging-tools.html#cb413-5" tabindex="-1"></a></span>
<span id="cb413-6"><a href="squashing-bugs-with-rs-debugging-tools.html#cb413-6" tabindex="-1"></a>err <span class="ot">=</span> <span class="fu">tryCatch</span>(<span class="fu">bad_fn</span>(<span class="dv">3</span>, <span class="dv">4</span>), <span class="at">error =</span> <span class="cf">function</span>(e) e)</span></code></pre></div>
<p>And here’s an example of using <code>tryCatch</code> to catch a message:</p>
<div class="sourceCode" id="cb414"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb414-1"><a href="squashing-bugs-with-rs-debugging-tools.html#cb414-1" tabindex="-1"></a>msg_fn <span class="ot">=</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb414-2"><a href="squashing-bugs-with-rs-debugging-tools.html#cb414-2" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">&quot;Hi&quot;</span>)</span>
<span id="cb414-3"><a href="squashing-bugs-with-rs-debugging-tools.html#cb414-3" tabindex="-1"></a>  x <span class="sc">+</span> y</span>
<span id="cb414-4"><a href="squashing-bugs-with-rs-debugging-tools.html#cb414-4" tabindex="-1"></a>}</span>
<span id="cb414-5"><a href="squashing-bugs-with-rs-debugging-tools.html#cb414-5" tabindex="-1"></a></span>
<span id="cb414-6"><a href="squashing-bugs-with-rs-debugging-tools.html#cb414-6" tabindex="-1"></a>msg <span class="ot">=</span> <span class="fu">tryCatch</span>(<span class="fu">msg_fn</span>(<span class="dv">3</span>, <span class="dv">4</span>), <span class="at">message =</span> <span class="cf">function</span>(e) e)</span></code></pre></div>
<p>The <code>tryCatch</code> function always silences conditions. Details about raised
conditions are provided in the object passed to the handler function, which has
class <code>condition</code> (and a more specific class that indicates what kind of
condition it is).</p>
<p>If you want to learn more about R’s conditions system, start by reading
<code>?conditions</code>.</p>
</div>
</div>
<div id="global-options" class="section level2 hasAnchor" number="7.3">
<h2><span class="header-section-number">7.3</span> Global Options<a href="squashing-bugs-with-rs-debugging-tools.html#global-options" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>R’s <strong>global options</strong> to control many different aspects of how R works.
They’re relevant to the theme of this chapter because some of them control when
and how R displays warnings and errors.</p>
<p>You can use the <code>options</code> function to get or set global options. If you call
the function with no arguments, it returns the current settings:</p>
<div class="sourceCode" id="cb415"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb415-1"><a href="squashing-bugs-with-rs-debugging-tools.html#cb415-1" tabindex="-1"></a>opts <span class="ot">=</span> <span class="fu">options</span>()</span>
<span id="cb415-2"><a href="squashing-bugs-with-rs-debugging-tools.html#cb415-2" tabindex="-1"></a><span class="co"># Display the first 6 options.</span></span>
<span id="cb415-3"><a href="squashing-bugs-with-rs-debugging-tools.html#cb415-3" tabindex="-1"></a><span class="fu">head</span>(opts)</span></code></pre></div>
<pre><code>## $add.smooth
## [1] TRUE
## 
## $bitmapType
## [1] &quot;quartz&quot;
## 
## $browser
## [1] &quot;/usr/bin/open&quot;
## 
## $browserNLdisabled
## [1] FALSE
## 
## $callr.condition_handler_cli_message
## function (msg) 
## {
##     custom_handler &lt;- getOption(&quot;cli.default_handler&quot;)
##     if (is.function(custom_handler)) {
##         custom_handler(msg)
##     }
##     else {
##         cli_server_default(msg)
##     }
## }
## &lt;bytecode: 0x7fee3c9b1988&gt;
## &lt;environment: namespace:cli&gt;
## 
## $CBoundsCheck
## [1] FALSE</code></pre>
<p>This section only explains a few of the options, but you can read about all of
them in <code>?options</code>.</p>
<p>The <code>warn</code> option controls how R handles warnings. It can be set to three
different values:</p>
<ul>
<li><p><code>0</code> – (the default) warnings are only displayed after code finishes
running.</p></li>
<li><p><code>1</code> – warnings are displayed immediately.</p></li>
<li><p><code>2</code> – warnings stop code from running, like errors.</p></li>
</ul>
<p>Setting <code>warn = 2</code> is useful for pinpointing expressions that raise warnings.
Setting <code>warn = 1</code> makes it easier to determine which expressions raise
warnings, without the inconvenience of stopping code from running. That makes
it a good default (better than the actual default). You can use the <code>option</code>
function to change the value of the <code>warn</code> option:</p>
<div class="sourceCode" id="cb417"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb417-1"><a href="squashing-bugs-with-rs-debugging-tools.html#cb417-1" tabindex="-1"></a><span class="fu">options</span>(<span class="at">warn =</span> <span class="dv">1</span>)</span></code></pre></div>
<p>When you set an option this way, the change only lasts until you quit R. Next
time you start R, the option will go back to its default value. Fortunately,
there is a way override the default options every time R starts.</p>
<p>When R starts, it searches for a <code>.Rprofile</code> file. The file is usually in your
system’s home directory (see <a href="https://ucdavisdatalab.github.io/workshop_r_basics/getting-started.html#absolute-relative-paths">this section</a> of the R Basics Reader for
how to locate your home directory). Customizing your <code>.Rprofile</code> file is one of
the marks of an experienced R user. If you define a <code>.First</code> function in your
<code>.Rprofile</code>, R will call it automatically during startup. Here’s an example
<code>.First</code> function:</p>
<div class="sourceCode" id="cb418"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb418-1"><a href="squashing-bugs-with-rs-debugging-tools.html#cb418-1" tabindex="-1"></a>.First <span class="ot">=</span> <span class="cf">function</span>() {</span>
<span id="cb418-2"><a href="squashing-bugs-with-rs-debugging-tools.html#cb418-2" tabindex="-1"></a>  <span class="co"># Only change options if R is running interactively.</span></span>
<span id="cb418-3"><a href="squashing-bugs-with-rs-debugging-tools.html#cb418-3" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">interactive</span>())</span>
<span id="cb418-4"><a href="squashing-bugs-with-rs-debugging-tools.html#cb418-4" tabindex="-1"></a>    <span class="fu">return</span>()</span>
<span id="cb418-5"><a href="squashing-bugs-with-rs-debugging-tools.html#cb418-5" tabindex="-1"></a></span>
<span id="cb418-6"><a href="squashing-bugs-with-rs-debugging-tools.html#cb418-6" tabindex="-1"></a>  <span class="fu">options</span>(</span>
<span id="cb418-7"><a href="squashing-bugs-with-rs-debugging-tools.html#cb418-7" tabindex="-1"></a>    <span class="co"># Don&#39;t print more than 1000 elements of anything.</span></span>
<span id="cb418-8"><a href="squashing-bugs-with-rs-debugging-tools.html#cb418-8" tabindex="-1"></a>    <span class="at">max.print =</span> <span class="dv">1000</span>,</span>
<span id="cb418-9"><a href="squashing-bugs-with-rs-debugging-tools.html#cb418-9" tabindex="-1"></a>    <span class="co"># Warn on partial matches.</span></span>
<span id="cb418-10"><a href="squashing-bugs-with-rs-debugging-tools.html#cb418-10" tabindex="-1"></a>    <span class="at">warnPartialMatchAttr =</span> <span class="cn">TRUE</span>,</span>
<span id="cb418-11"><a href="squashing-bugs-with-rs-debugging-tools.html#cb418-11" tabindex="-1"></a>    <span class="at">warnPartialMatchDollar =</span> <span class="cn">TRUE</span>,</span>
<span id="cb418-12"><a href="squashing-bugs-with-rs-debugging-tools.html#cb418-12" tabindex="-1"></a>    <span class="at">warnPartialMatchArgs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb418-13"><a href="squashing-bugs-with-rs-debugging-tools.html#cb418-13" tabindex="-1"></a>    <span class="co"># Print warnings immediately (2 = warnings are errors).</span></span>
<span id="cb418-14"><a href="squashing-bugs-with-rs-debugging-tools.html#cb418-14" tabindex="-1"></a>    <span class="at">warn =</span> <span class="dv">1</span></span>
<span id="cb418-15"><a href="squashing-bugs-with-rs-debugging-tools.html#cb418-15" tabindex="-1"></a>  )</span>
<span id="cb418-16"><a href="squashing-bugs-with-rs-debugging-tools.html#cb418-16" tabindex="-1"></a>}</span></code></pre></div>
<p>You can learn more about the <code>.Rprofile</code> file and R’s startup process at
<code>?Startup</code>.</p>
</div>
<div id="debugging" class="section level2 hasAnchor" number="7.4">
<h2><span class="header-section-number">7.4</span> Debugging<a href="squashing-bugs-with-rs-debugging-tools.html#debugging" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>It can be very frustrating when your computer doesn’t do what you expect! <strong>Debugging</strong> code is the process of addressing why your computer is doing something unexpected. Almost anything you do in R will be a process made up of many steps, executed line-by-line in sequential order. In general, you should proceed by breaking your workflow into small parts and confirming, step-by-step, that the result is what you expected.</p>
<div id="read-your-errors-and-warnings" class="section level3 hasAnchor" number="7.4.1">
<h3><span class="header-section-number">7.4.1</span> Read Your Errors and Warnings<a href="squashing-bugs-with-rs-debugging-tools.html#read-your-errors-and-warnings" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Your computer is dumb and it will do exactly what you tell it to do. There are two ways this can cause problems: if you ask the impossible or if your instructions take you to the wrong place. If you tell R to do something impossible, it will generate an error or a warning, which will include a message that tries to tell you what went wrong. Read the messages! Often, it will describe the problem and suggest a solution.</p>
<div class="sourceCode" id="cb419"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb419-1"><a href="squashing-bugs-with-rs-debugging-tools.html#cb419-1" tabindex="-1"></a><span class="st">&quot;seven&quot;</span> <span class="sc">+</span> <span class="dv">5</span></span></code></pre></div>
<pre><code>## Error in &quot;seven&quot; + 5: non-numeric argument to binary operator</code></pre>
<p>We can’t add the word seven to the number five. To make this code work, we have to change <code>"seven"</code> to <code>7</code>.</p>
<div class="sourceCode" id="cb421"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb421-1"><a href="squashing-bugs-with-rs-debugging-tools.html#cb421-1" tabindex="-1"></a><span class="fu">read.csv</span>(<span class="st">&quot;nope&quot;</span>)</span></code></pre></div>
<pre><code>## Warning in file(file, &quot;rt&quot;): cannot open file &#39;nope&#39;: No such file or directory</code></pre>
<pre><code>## Error in file(file, &quot;rt&quot;): cannot open the connection</code></pre>
<p>The <code>read.csv()</code> function is used to import a data file that was saved in comma-separated format. In this case, we have asked <code>read.csv()</code> to read a file that doesn’t exist. The error message doesn’t tell you this exactly, but it does say that R was unable to open a connection to the file. Since the functions built into R are all pretty well tested, it makes sense to doubt the user input before doubting R. In this case, the only input was the file name, so a good first step is to check that the file actually exists.</p>
</div>
<div id="workflow-debugging" class="section level3 hasAnchor" number="7.4.2">
<h3><span class="header-section-number">7.4.2</span> Workflow Debugging<a href="squashing-bugs-with-rs-debugging-tools.html#workflow-debugging" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Notice that I talked about the <strong>workflow</strong>, which is a broader concept than the code because it includes code, data, and how the code is used. Often you’ll hit an error simply because you’ve changed your data since you first loaded it into R. In that case, restarting R and running your code in a clean environment might resolve the error without making any changes. Today we will focus on methods and tools for debugging, which will help you identify the reason that something unexpected happens. These lessons are relevant even if the error is not due to your code.</p>
</div>
<div id="isolate-the-problem" class="section level3 hasAnchor" number="7.4.3">
<h3><span class="header-section-number">7.4.3</span> Isolate the Problem<a href="squashing-bugs-with-rs-debugging-tools.html#isolate-the-problem" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The most important step when debugging an error is to locate it. There are two main strategies for doing this:</p>
<ul>
<li>Work forward through the code from the beginning.</li>
<li>Work backward from the source of an error.</li>
</ul>
<p>Both strategies are valid and powerful. Working backward is probably faster for experienced R users because errors and messages have patterns that you learn to recognize over time. If you recognize the meaning of an error, you may be able to immediately identify its cause. The <code>traceback()</code> function is quite helpful for the “work backward” strategy, because it identifies the function where the error actually happened (which may be nested deeply within a function called by a line of code within another function.)</p>
<p>To work forward from the beginning may take longer than working backward, but it does have advantages. Often the source of an error comes before the line of code where the error occurs. Here’s an example that builds upon an error we just saw a moment ago:</p>
<div class="sourceCode" id="cb424"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb424-1"><a href="squashing-bugs-with-rs-debugging-tools.html#cb424-1" tabindex="-1"></a>num1 <span class="ot">=</span> <span class="st">&quot;seven&quot;</span></span>
<span id="cb424-2"><a href="squashing-bugs-with-rs-debugging-tools.html#cb424-2" tabindex="-1"></a>num2 <span class="ot">=</span> <span class="dv">5</span></span>
<span id="cb424-3"><a href="squashing-bugs-with-rs-debugging-tools.html#cb424-3" tabindex="-1"></a><span class="fu">sum</span>(num1, num2)</span></code></pre></div>
<pre><code>## Error in sum(num1, num2): invalid &#39;type&#39; (character) of argument</code></pre>
<p>Even though the error occurs when we try to add <code>num1</code> and <code>num2</code>, the actual source of the error is that <code>num1 = "seven"</code> should be <code>num1 = 7</code>. When you debug by walking forward, you can stop after each line of code to confirm what has changed.</p>
</div>
<div id="functions-for-debugging" class="section level3 hasAnchor" number="7.4.4">
<h3><span class="header-section-number">7.4.4</span> Functions for debugging<a href="squashing-bugs-with-rs-debugging-tools.html#functions-for-debugging" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>R has several built-in functions to help with debugging. Here are a few of the most important.</p>
<ul>
<li><code>traceback()</code> shows the <strong>call stack</strong>, which is the series of nested function calls that walk from the interactive prompt to the location of the error.</li>
<li><code>stopifnot()</code> raises an error condition if your assumption about some object is wrong.</li>
<li><code>browser()</code> pauses the running code and starts R’s debugging system.</li>
<li><code>debug()</code> inserts a call to <code>browser()</code> at the beginning of a function, so you can go step-by-step through its operation.</li>
</ul>
<p>Here’s an example where we create a pair of functions and use <code>browser()</code> to start the debugger inside a loop:</p>
<div class="sourceCode" id="cb426"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb426-1"><a href="squashing-bugs-with-rs-debugging-tools.html#cb426-1" tabindex="-1"></a><span class="co"># Run this in an R console.</span></span>
<span id="cb426-2"><a href="squashing-bugs-with-rs-debugging-tools.html#cb426-2" tabindex="-1"></a>g <span class="ot">=</span> <span class="cf">function</span>(x, y) (<span class="dv">1</span> <span class="sc">+</span> x) <span class="sc">*</span> y</span>
<span id="cb426-3"><a href="squashing-bugs-with-rs-debugging-tools.html#cb426-3" tabindex="-1"></a></span>
<span id="cb426-4"><a href="squashing-bugs-with-rs-debugging-tools.html#cb426-4" tabindex="-1"></a>f <span class="ot">=</span> <span class="cf">function</span>(n) {</span>
<span id="cb426-5"><a href="squashing-bugs-with-rs-debugging-tools.html#cb426-5" tabindex="-1"></a>  total <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb426-6"><a href="squashing-bugs-with-rs-debugging-tools.html#cb426-6" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb426-7"><a href="squashing-bugs-with-rs-debugging-tools.html#cb426-7" tabindex="-1"></a>    <span class="fu">browser</span>()</span>
<span id="cb426-8"><a href="squashing-bugs-with-rs-debugging-tools.html#cb426-8" tabindex="-1"></a>    total <span class="ot">=</span> total <span class="sc">+</span> <span class="fu">g</span>(i, i)</span>
<span id="cb426-9"><a href="squashing-bugs-with-rs-debugging-tools.html#cb426-9" tabindex="-1"></a>  }</span>
<span id="cb426-10"><a href="squashing-bugs-with-rs-debugging-tools.html#cb426-10" tabindex="-1"></a></span>
<span id="cb426-11"><a href="squashing-bugs-with-rs-debugging-tools.html#cb426-11" tabindex="-1"></a>  total</span>
<span id="cb426-12"><a href="squashing-bugs-with-rs-debugging-tools.html#cb426-12" tabindex="-1"></a>}</span>
<span id="cb426-13"><a href="squashing-bugs-with-rs-debugging-tools.html#cb426-13" tabindex="-1"></a></span>
<span id="cb426-14"><a href="squashing-bugs-with-rs-debugging-tools.html#cb426-14" tabindex="-1"></a><span class="fu">f</span>(<span class="dv">11</span>)</span></code></pre></div>
<p>The most important debugger commands are:</p>
<ul>
<li><code>n</code> to run the next line</li>
<li><code>s</code> to “step into” a call</li>
<li><code>c</code> to continue running the code</li>
<li><code>Q</code> to quit the debugger</li>
<li><code>where</code> to print call stack</li>
<li><code>help</code> to print debugger help</li>
</ul>
</div>
<div id="other-functions" class="section level3 hasAnchor" number="7.4.5">
<h3><span class="header-section-number">7.4.5</span> Other Functions<a href="squashing-bugs-with-rs-debugging-tools.html#other-functions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>debug()</code> function places a call to <code>browser()</code> at the beginning
of a function. Use <code>debug()</code> to debug functions that you can’t or don’t want to
edit. For example:</p>
<div class="sourceCode" id="cb427"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb427-1"><a href="squashing-bugs-with-rs-debugging-tools.html#cb427-1" tabindex="-1"></a><span class="co"># Run this in an R console.</span></span>
<span id="cb427-2"><a href="squashing-bugs-with-rs-debugging-tools.html#cb427-2" tabindex="-1"></a>f <span class="ot">=</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb427-3"><a href="squashing-bugs-with-rs-debugging-tools.html#cb427-3" tabindex="-1"></a>  x <span class="sc">+</span> y</span>
<span id="cb427-4"><a href="squashing-bugs-with-rs-debugging-tools.html#cb427-4" tabindex="-1"></a>}</span>
<span id="cb427-5"><a href="squashing-bugs-with-rs-debugging-tools.html#cb427-5" tabindex="-1"></a></span>
<span id="cb427-6"><a href="squashing-bugs-with-rs-debugging-tools.html#cb427-6" tabindex="-1"></a><span class="fu">debug</span>(f)</span>
<span id="cb427-7"><a href="squashing-bugs-with-rs-debugging-tools.html#cb427-7" tabindex="-1"></a><span class="fu">f</span>(<span class="dv">5</span>, <span class="dv">5</span>)</span></code></pre></div>
<p>You can use <code>undebug()</code> to reverse the effect of <code>debug()</code>:</p>
<div class="sourceCode" id="cb428"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb428-1"><a href="squashing-bugs-with-rs-debugging-tools.html#cb428-1" tabindex="-1"></a><span class="co"># Run this in an R console.</span></span>
<span id="cb428-2"><a href="squashing-bugs-with-rs-debugging-tools.html#cb428-2" tabindex="-1"></a><span class="fu">undebug</span>(f)</span>
<span id="cb428-3"><a href="squashing-bugs-with-rs-debugging-tools.html#cb428-3" tabindex="-1"></a><span class="fu">f</span>(<span class="dv">10</span>, <span class="dv">20</span>)</span></code></pre></div>
<p>The <code>debugonce()</code> function places a call to <code>browser()</code> at the beginning of a
function for the next call only. The idea is that you then don’t have to call
<code>undebug()</code>. For instance:</p>
<div class="sourceCode" id="cb429"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb429-1"><a href="squashing-bugs-with-rs-debugging-tools.html#cb429-1" tabindex="-1"></a><span class="co"># Run this in an R console.</span></span>
<span id="cb429-2"><a href="squashing-bugs-with-rs-debugging-tools.html#cb429-2" tabindex="-1"></a><span class="fu">debugonce</span>(f)</span>
<span id="cb429-3"><a href="squashing-bugs-with-rs-debugging-tools.html#cb429-3" tabindex="-1"></a><span class="fu">f</span>(<span class="dv">10</span>, <span class="dv">20</span>)</span>
<span id="cb429-4"><a href="squashing-bugs-with-rs-debugging-tools.html#cb429-4" tabindex="-1"></a><span class="fu">f</span>(<span class="dv">3</span>, <span class="dv">4</span>)</span></code></pre></div>
<p>Finally, the global option <code>error</code> can be used to make R enter the debugger any
time an error occurs. Set the option to <code>error = recover</code>:</p>
<div class="sourceCode" id="cb430"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb430-1"><a href="squashing-bugs-with-rs-debugging-tools.html#cb430-1" tabindex="-1"></a><span class="fu">options</span>(<span class="at">error =</span> recover)</span></code></pre></div>
<p>Then try this example:</p>
<div class="sourceCode" id="cb431"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb431-1"><a href="squashing-bugs-with-rs-debugging-tools.html#cb431-1" tabindex="-1"></a><span class="co"># Run this in an R console.</span></span>
<span id="cb431-2"><a href="squashing-bugs-with-rs-debugging-tools.html#cb431-2" tabindex="-1"></a>bad_fn <span class="ot">=</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb431-3"><a href="squashing-bugs-with-rs-debugging-tools.html#cb431-3" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">&quot;Hi&quot;</span>)</span>
<span id="cb431-4"><a href="squashing-bugs-with-rs-debugging-tools.html#cb431-4" tabindex="-1"></a>  x <span class="sc">+</span> y</span>
<span id="cb431-5"><a href="squashing-bugs-with-rs-debugging-tools.html#cb431-5" tabindex="-1"></a>}</span>
<span id="cb431-6"><a href="squashing-bugs-with-rs-debugging-tools.html#cb431-6" tabindex="-1"></a></span>
<span id="cb431-7"><a href="squashing-bugs-with-rs-debugging-tools.html#cb431-7" tabindex="-1"></a><span class="fu">bad_fn</span>(<span class="dv">3</span>, <span class="dv">4</span>)</span></code></pre></div>
</div>
<div id="debugging-case-study-bootstrapping-average-penguin-mass" class="section level3 hasAnchor" number="7.4.6">
<h3><span class="header-section-number">7.4.6</span> Debugging Case Study: Bootstrapping Average Penguin Mass<a href="squashing-bugs-with-rs-debugging-tools.html#debugging-case-study-bootstrapping-average-penguin-mass" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Here is a more realistic example to demonstrate how debugging works in a practical code project. In this example, you take the role of a biologist studying penguins in Antarctica. You’ve captured and measured 344 penguins on three islands near the Palmer Station Long Term Ecological Research site and are doing some analysis with the data. The measurements include flipper length, bill width, sex, and body mass of the penguins. The data are available as the data object <code>penguins</code> in <a href="https://allisonhorst.github.io/palmerpenguins/">Alison Horst’s <code>palmerpenguins</code> package</a> so let’s download and load that package now.</p>
<div class="sourceCode" id="cb432"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb432-1"><a href="squashing-bugs-with-rs-debugging-tools.html#cb432-1" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;palmerpenguins&quot;</span>)</span>
<span id="cb432-2"><a href="squashing-bugs-with-rs-debugging-tools.html#cb432-2" tabindex="-1"></a><span class="fu">library</span>(palmerpenguins)</span>
<span id="cb432-3"><a href="squashing-bugs-with-rs-debugging-tools.html#cb432-3" tabindex="-1"></a><span class="fu">data</span>(penguins)</span>
<span id="cb432-4"><a href="squashing-bugs-with-rs-debugging-tools.html#cb432-4" tabindex="-1"></a></span>
<span id="cb432-5"><a href="squashing-bugs-with-rs-debugging-tools.html#cb432-5" tabindex="-1"></a><span class="fu">head</span>(penguins)</span></code></pre></div>
<table>
<colgroup>
<col width="8%" />
<col width="11%" />
<col width="16%" />
<col width="15%" />
<col width="20%" />
<col width="13%" />
<col width="7%" />
<col width="5%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">species</th>
<th align="left">island</th>
<th align="right">bill_length_mm</th>
<th align="right">bill_depth_mm</th>
<th align="right">flipper_length_mm</th>
<th align="right">body_mass_g</th>
<th align="left">sex</th>
<th align="right">year</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Adelie</td>
<td align="left">Torgersen</td>
<td align="right">39.1</td>
<td align="right">18.7</td>
<td align="right">181</td>
<td align="right">3750</td>
<td align="left">male</td>
<td align="right">2007</td>
</tr>
<tr class="even">
<td align="left">Adelie</td>
<td align="left">Torgersen</td>
<td align="right">39.5</td>
<td align="right">17.4</td>
<td align="right">186</td>
<td align="right">3800</td>
<td align="left">female</td>
<td align="right">2007</td>
</tr>
<tr class="odd">
<td align="left">Adelie</td>
<td align="left">Torgersen</td>
<td align="right">40.3</td>
<td align="right">18.0</td>
<td align="right">195</td>
<td align="right">3250</td>
<td align="left">female</td>
<td align="right">2007</td>
</tr>
<tr class="even">
<td align="left">Adelie</td>
<td align="left">Torgersen</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">2007</td>
</tr>
<tr class="odd">
<td align="left">Adelie</td>
<td align="left">Torgersen</td>
<td align="right">36.7</td>
<td align="right">19.3</td>
<td align="right">193</td>
<td align="right">3450</td>
<td align="left">female</td>
<td align="right">2007</td>
</tr>
<tr class="even">
<td align="left">Adelie</td>
<td align="left">Torgersen</td>
<td align="right">39.3</td>
<td align="right">20.6</td>
<td align="right">190</td>
<td align="right">3650</td>
<td align="left">male</td>
<td align="right">2007</td>
</tr>
</tbody>
</table>
<p>Now imagine that you are trying to use a script that was written by a previous member of your lab. Let’s copy it from its home on the web, <a href="https://raw.githubusercontent.com/ucdavisdatalab/workshop_intermediate_r/main/code/debug_case_study.R">here</a> to a new blank script on our computer(s). The script provides a function that splits the penguins into groups according to some grouping factors like species and sex, then plots the uncertainty in the average penguin mass per group. The plot is shown below for mass by species.</p>
<div class="sourceCode" id="cb433"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb433-1"><a href="squashing-bugs-with-rs-debugging-tools.html#cb433-1" tabindex="-1"></a><span class="fu">make_bootstrap_plots</span>(penguins, <span class="st">&quot;species&quot;</span>)</span></code></pre></div>
<p><img src="04_debugging_files/figure-html/first-case-study-plot-1.png" width="672" /></p>
<p>In the plot, the red dots are measured penguins within each group and the black boxplots show the variability in 1000 estimates of the group means. The estimates come from a process called the <strong>bootstrap</strong>. It works by taking samples from the data we already have (this is called <strong>resampling</strong>), in order to measure how different the samples are from each other. Statisticians do this because we often want to know how different our conclusions would be with completely new data, but we can’t go back and collect the new data.</p>
<p>The functions work for multiple grouping factors. See how we can estimate the means of penguins grouped by species and sex, which helps us identify species where one sex is larger than the other:</p>
<div class="sourceCode" id="cb434"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb434-1"><a href="squashing-bugs-with-rs-debugging-tools.html#cb434-1" tabindex="-1"></a><span class="fu">make_bootstrap_plots</span>(penguins, <span class="st">&quot;species&quot;</span>, <span class="st">&quot;sex&quot;</span>)</span></code></pre></div>
<p><img src="04_debugging_files/figure-html/sex-and-species-1.png" width="672" /></p>
<p>But when you group the penguins by species and island, the code generates an error. This is our bug:</p>
<div class="sourceCode" id="cb435"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb435-1"><a href="squashing-bugs-with-rs-debugging-tools.html#cb435-1" tabindex="-1"></a><span class="fu">make_bootstrap_plots</span>(penguins, <span class="st">&quot;species&quot;</span>, <span class="st">&quot;island&quot;</span>)</span></code></pre></div>
<pre><code>## Error in indx[[i]] &lt;- sample(1:N, size = 1): attempt to select less than one element in integerOneIndex</code></pre>
<div id="fixing-the-bug" class="section level4 hasAnchor" number="7.4.6.1">
<h4><span class="header-section-number">7.4.6.1</span> Fixing The Bug<a href="squashing-bugs-with-rs-debugging-tools.html#fixing-the-bug" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>As usual, our process is to isolate the bug, then identify its cause, and then to fix it. There are a lot of ways to do this, but they al begin with carefully reading the error message! In this case, we see that is <code>Error in indx[[i]] &lt;- sample(1:N, size = 1): attempt to select less than one element in integerOneIndex</code>. The message gives us an explanation of the error and tells us what code generated the error. In this case there was an attempt to select less than one element from something while taking a random sample from the numbers from 1 to N.</p>
<p>There are many ways to isolate the location of the error. The <code>traceback()</code> function will work, or you could pepper the code with <code>print()</code> statements, or use the debugger to walk through the code until you hit the error. I’m going to include the <code>traceback()</code> function here, but we will also use the other methods in our exercise.</p>
<div class="sourceCode" id="cb437"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb437-1"><a href="squashing-bugs-with-rs-debugging-tools.html#cb437-1" tabindex="-1"></a><span class="fu">traceback</span>()</span></code></pre></div>
<pre><code>## 4: resample(group$body_mass_g, B = B) at debug_case_study.R#50 
## 3: bootstrap(data, B = B, ...) at debug_case_study.R#60
## 2: stack(bootstrap(data, B = B, ...)) at debug_case_study.R#60
## 1: make_bootstrap_plots(penguins, &quot;species&quot;, &quot;island&quot;)</code></pre>
<p>The error is generated in the <code>resample()</code> function, which is one of the functions in the script you downloaded. You can identify which line of that code matches the code reported in the error message, which tells us that the error is generated on line 13 of <code>debug_case_study.R</code>.</p>
<p>Remember that the location of an error and the cause of the error are not always the same thing. To try and understand the cause of the error, let’s start the debugger by putting a <code>browser()</code> call just before line 13, like this:</p>
<div class="sourceCode" id="cb439"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb439-1"><a href="squashing-bugs-with-rs-debugging-tools.html#cb439-1" tabindex="-1"></a>resample <span class="ot">=</span> <span class="cf">function</span>(data, B) {</span>
<span id="cb439-2"><a href="squashing-bugs-with-rs-debugging-tools.html#cb439-2" tabindex="-1"></a>  N <span class="ot">=</span> <span class="fu">length</span>(data)</span>
<span id="cb439-3"><a href="squashing-bugs-with-rs-debugging-tools.html#cb439-3" tabindex="-1"></a>  result <span class="ot">=</span> <span class="fu">numeric</span>(B)</span>
<span id="cb439-4"><a href="squashing-bugs-with-rs-debugging-tools.html#cb439-4" tabindex="-1"></a>  </span>
<span id="cb439-5"><a href="squashing-bugs-with-rs-debugging-tools.html#cb439-5" tabindex="-1"></a>  <span class="co"># repeat this whole process B times</span></span>
<span id="cb439-6"><a href="squashing-bugs-with-rs-debugging-tools.html#cb439-6" tabindex="-1"></a>  <span class="cf">for</span> (b <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>B) {</span>
<span id="cb439-7"><a href="squashing-bugs-with-rs-debugging-tools.html#cb439-7" tabindex="-1"></a>    </span>
<span id="cb439-8"><a href="squashing-bugs-with-rs-debugging-tools.html#cb439-8" tabindex="-1"></a>    <span class="co"># make an object to hold the resampled indices</span></span>
<span id="cb439-9"><a href="squashing-bugs-with-rs-debugging-tools.html#cb439-9" tabindex="-1"></a>    indx <span class="ot">=</span> <span class="fu">integer</span>(N)</span>
<span id="cb439-10"><a href="squashing-bugs-with-rs-debugging-tools.html#cb439-10" tabindex="-1"></a>    </span>
<span id="cb439-11"><a href="squashing-bugs-with-rs-debugging-tools.html#cb439-11" tabindex="-1"></a>    <span class="co"># resample one data point at a time</span></span>
<span id="cb439-12"><a href="squashing-bugs-with-rs-debugging-tools.html#cb439-12" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N) {</span>
<span id="cb439-13"><a href="squashing-bugs-with-rs-debugging-tools.html#cb439-13" tabindex="-1"></a>      <span class="fu">browser</span>()</span>
<span id="cb439-14"><a href="squashing-bugs-with-rs-debugging-tools.html#cb439-14" tabindex="-1"></a>      indx[[i]] <span class="ot">=</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span>N, <span class="at">size=</span><span class="dv">1</span>)</span>
<span id="cb439-15"><a href="squashing-bugs-with-rs-debugging-tools.html#cb439-15" tabindex="-1"></a>    }</span>
<span id="cb439-16"><a href="squashing-bugs-with-rs-debugging-tools.html#cb439-16" tabindex="-1"></a>    </span>
<span id="cb439-17"><a href="squashing-bugs-with-rs-debugging-tools.html#cb439-17" tabindex="-1"></a>    <span class="co"># calculate the mean of this resampled data</span></span>
<span id="cb439-18"><a href="squashing-bugs-with-rs-debugging-tools.html#cb439-18" tabindex="-1"></a>    result[[b]] <span class="ot">=</span> <span class="fu">mean</span>(data[indx])</span>
<span id="cb439-19"><a href="squashing-bugs-with-rs-debugging-tools.html#cb439-19" tabindex="-1"></a>  }</span>
<span id="cb439-20"><a href="squashing-bugs-with-rs-debugging-tools.html#cb439-20" tabindex="-1"></a>  </span>
<span id="cb439-21"><a href="squashing-bugs-with-rs-debugging-tools.html#cb439-21" tabindex="-1"></a>  <span class="co"># return all of the mean resamples</span></span>
<span id="cb439-22"><a href="squashing-bugs-with-rs-debugging-tools.html#cb439-22" tabindex="-1"></a>  result</span>
<span id="cb439-23"><a href="squashing-bugs-with-rs-debugging-tools.html#cb439-23" tabindex="-1"></a>}</span></code></pre></div>
<p>Now when you run <code>make_bootstrap_plots(penguins, "species", "island")</code>, the debugger will start at the location where the error happens. Use RStudio’s Environment pane to examine the values of variables, and then use the debugger controls to step forward and see how things update. Why aren’t we seeing an error right away? It is probably because there are loops that run the same lines of code over and over again. Apparently the error only happens on certain passes through the loops.</p>
<p>Now we know that the bug has to be isolated not only on its line, but also in its time through the loop. Let’s replace the call to <code>browser()</code> with a <code>message()</code> to identify what pass through the loops causes the error:</p>
<div class="sourceCode" id="cb440"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb440-1"><a href="squashing-bugs-with-rs-debugging-tools.html#cb440-1" tabindex="-1"></a>resample <span class="ot">=</span> <span class="cf">function</span>(data, B) {</span>
<span id="cb440-2"><a href="squashing-bugs-with-rs-debugging-tools.html#cb440-2" tabindex="-1"></a>  N <span class="ot">=</span> <span class="fu">length</span>(data)</span>
<span id="cb440-3"><a href="squashing-bugs-with-rs-debugging-tools.html#cb440-3" tabindex="-1"></a>  result <span class="ot">=</span> <span class="fu">numeric</span>(B)</span>
<span id="cb440-4"><a href="squashing-bugs-with-rs-debugging-tools.html#cb440-4" tabindex="-1"></a>  </span>
<span id="cb440-5"><a href="squashing-bugs-with-rs-debugging-tools.html#cb440-5" tabindex="-1"></a>  <span class="co"># repeat this whole process B times</span></span>
<span id="cb440-6"><a href="squashing-bugs-with-rs-debugging-tools.html#cb440-6" tabindex="-1"></a>  <span class="cf">for</span> (b <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>B) {</span>
<span id="cb440-7"><a href="squashing-bugs-with-rs-debugging-tools.html#cb440-7" tabindex="-1"></a>    </span>
<span id="cb440-8"><a href="squashing-bugs-with-rs-debugging-tools.html#cb440-8" tabindex="-1"></a>    <span class="co"># make an object to hold the resampled indices</span></span>
<span id="cb440-9"><a href="squashing-bugs-with-rs-debugging-tools.html#cb440-9" tabindex="-1"></a>    indx <span class="ot">=</span> <span class="fu">integer</span>(N)</span>
<span id="cb440-10"><a href="squashing-bugs-with-rs-debugging-tools.html#cb440-10" tabindex="-1"></a>    </span>
<span id="cb440-11"><a href="squashing-bugs-with-rs-debugging-tools.html#cb440-11" tabindex="-1"></a>    <span class="co"># resample one data point at a time</span></span>
<span id="cb440-12"><a href="squashing-bugs-with-rs-debugging-tools.html#cb440-12" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N) {</span>
<span id="cb440-13"><a href="squashing-bugs-with-rs-debugging-tools.html#cb440-13" tabindex="-1"></a>      <span class="fu">message</span>(<span class="st">&quot;i=&quot;</span>, i, <span class="st">&quot; b=&quot;</span>, b)</span>
<span id="cb440-14"><a href="squashing-bugs-with-rs-debugging-tools.html#cb440-14" tabindex="-1"></a>      indx[[i]] <span class="ot">=</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span>N, <span class="at">size=</span><span class="dv">1</span>)</span>
<span id="cb440-15"><a href="squashing-bugs-with-rs-debugging-tools.html#cb440-15" tabindex="-1"></a>    }</span>
<span id="cb440-16"><a href="squashing-bugs-with-rs-debugging-tools.html#cb440-16" tabindex="-1"></a>    </span>
<span id="cb440-17"><a href="squashing-bugs-with-rs-debugging-tools.html#cb440-17" tabindex="-1"></a>    <span class="co"># calculate the mean of this resampled data</span></span>
<span id="cb440-18"><a href="squashing-bugs-with-rs-debugging-tools.html#cb440-18" tabindex="-1"></a>    result[[b]] <span class="ot">=</span> <span class="fu">mean</span>(data[indx])</span>
<span id="cb440-19"><a href="squashing-bugs-with-rs-debugging-tools.html#cb440-19" tabindex="-1"></a>  }</span>
<span id="cb440-20"><a href="squashing-bugs-with-rs-debugging-tools.html#cb440-20" tabindex="-1"></a>  </span>
<span id="cb440-21"><a href="squashing-bugs-with-rs-debugging-tools.html#cb440-21" tabindex="-1"></a>  <span class="co"># return all of the mean resamples</span></span>
<span id="cb440-22"><a href="squashing-bugs-with-rs-debugging-tools.html#cb440-22" tabindex="-1"></a>  result</span>
<span id="cb440-23"><a href="squashing-bugs-with-rs-debugging-tools.html#cb440-23" tabindex="-1"></a>}</span></code></pre></div>
<p>Weirdly, it looks like the first pass through the outer loop (<code>b=1</code>) but not the first time we’ve done the first pass (there were a lot of messages before the error happened). And the error is in the zeroth iteration of the inner loop (<code>i=0</code>), which shouldn’t be possible with <code>1:N</code>. To confirm your suspicion, create a reproducible example that generates the correct error:</p>
<div class="sourceCode" id="cb441"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb441-1"><a href="squashing-bugs-with-rs-debugging-tools.html#cb441-1" tabindex="-1"></a>LETTERS[[<span class="dv">0</span><span class="dt">L</span>]]</span></code></pre></div>
<pre><code>## Error in LETTERS[[0L]]: attempt to select less than one element in integerOneIndex</code></pre>
<p>Yep, that’s the error: we are trying to set the zeroth item in a vector. But why?</p>
<p>Something is funny here, so let’s start by understanding how we can have <code>b=1</code> after the loop has printed many times. Remember what <code>traceback()</code> told us: <code>resample()</code> is called from the <code>bootstrap()</code> function. Looking where that happens (line 50), we can see that this line is also inside a loop. So we have a new call to <code>resample()</code> every time this loop runs, which is how we can be on the first iteration of <code>resample()</code> even after a lot of iterations have run. Let’s add a new <code>message()</code> statement to <code>bootstrap()</code> just before line 50 to tell us what iteration we are on:</p>
<div class="sourceCode" id="cb443"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb443-1"><a href="squashing-bugs-with-rs-debugging-tools.html#cb443-1" tabindex="-1"></a>bootstrap <span class="ot">=</span> <span class="cf">function</span>(data, ..., <span class="at">B=</span><span class="dv">1000</span>) {</span>
<span id="cb443-2"><a href="squashing-bugs-with-rs-debugging-tools.html#cb443-2" tabindex="-1"></a>  <span class="co"># get the names of grouping factors</span></span>
<span id="cb443-3"><a href="squashing-bugs-with-rs-debugging-tools.html#cb443-3" tabindex="-1"></a>  grouping_factors <span class="ot">=</span> <span class="fu">sapply</span>(<span class="fu">list</span>(...), unlist)</span>
<span id="cb443-4"><a href="squashing-bugs-with-rs-debugging-tools.html#cb443-4" tabindex="-1"></a>  </span>
<span id="cb443-5"><a href="squashing-bugs-with-rs-debugging-tools.html#cb443-5" tabindex="-1"></a>  <span class="co"># identify all possible combinations of grouping factors</span></span>
<span id="cb443-6"><a href="squashing-bugs-with-rs-debugging-tools.html#cb443-6" tabindex="-1"></a>  grouping_levels <span class="ot">=</span></span>
<span id="cb443-7"><a href="squashing-bugs-with-rs-debugging-tools.html#cb443-7" tabindex="-1"></a>    <span class="fu">sapply</span>(grouping_factors,</span>
<span id="cb443-8"><a href="squashing-bugs-with-rs-debugging-tools.html#cb443-8" tabindex="-1"></a>           <span class="cf">function</span>(grp) <span class="fu">unique</span>(data[[grp]]) <span class="sc">|&gt;</span> <span class="fu">as.character</span>(),</span>
<span id="cb443-9"><a href="squashing-bugs-with-rs-debugging-tools.html#cb443-9" tabindex="-1"></a>           <span class="at">simplify =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb443-10"><a href="squashing-bugs-with-rs-debugging-tools.html#cb443-10" tabindex="-1"></a>    <span class="fu">setNames</span>(grouping_factors)</span>
<span id="cb443-11"><a href="squashing-bugs-with-rs-debugging-tools.html#cb443-11" tabindex="-1"></a>  </span>
<span id="cb443-12"><a href="squashing-bugs-with-rs-debugging-tools.html#cb443-12" tabindex="-1"></a>  <span class="co"># cross the grouping levels to get all combinations</span></span>
<span id="cb443-13"><a href="squashing-bugs-with-rs-debugging-tools.html#cb443-13" tabindex="-1"></a>  groups <span class="ot">=</span> <span class="fu">split</span>(data, data[,grouping_factors])</span>
<span id="cb443-14"><a href="squashing-bugs-with-rs-debugging-tools.html#cb443-14" tabindex="-1"></a>  </span>
<span id="cb443-15"><a href="squashing-bugs-with-rs-debugging-tools.html#cb443-15" tabindex="-1"></a>  <span class="co"># create an empty data.frame to hold the results</span></span>
<span id="cb443-16"><a href="squashing-bugs-with-rs-debugging-tools.html#cb443-16" tabindex="-1"></a>  col_names <span class="ot">=</span> <span class="fu">names</span>(groups)</span>
<span id="cb443-17"><a href="squashing-bugs-with-rs-debugging-tools.html#cb443-17" tabindex="-1"></a>  result <span class="ot">=</span> <span class="fu">replicate</span>(<span class="fu">length</span>(groups), <span class="fu">numeric</span>(B), <span class="at">simplify=</span><span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb443-18"><a href="squashing-bugs-with-rs-debugging-tools.html#cb443-18" tabindex="-1"></a>    <span class="fu">as.data.frame</span>(<span class="at">col.names =</span> col_names)</span>
<span id="cb443-19"><a href="squashing-bugs-with-rs-debugging-tools.html#cb443-19" tabindex="-1"></a>  </span>
<span id="cb443-20"><a href="squashing-bugs-with-rs-debugging-tools.html#cb443-20" tabindex="-1"></a>  <span class="co"># bootstrap the mean of mass for each group</span></span>
<span id="cb443-21"><a href="squashing-bugs-with-rs-debugging-tools.html#cb443-21" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(groups)) {</span>
<span id="cb443-22"><a href="squashing-bugs-with-rs-debugging-tools.html#cb443-22" tabindex="-1"></a>    </span>
<span id="cb443-23"><a href="squashing-bugs-with-rs-debugging-tools.html#cb443-23" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">&quot;group=&quot;</span>, i)</span>
<span id="cb443-24"><a href="squashing-bugs-with-rs-debugging-tools.html#cb443-24" tabindex="-1"></a>    </span>
<span id="cb443-25"><a href="squashing-bugs-with-rs-debugging-tools.html#cb443-25" tabindex="-1"></a>    <span class="co"># get the subset of data that is relevant to this group</span></span>
<span id="cb443-26"><a href="squashing-bugs-with-rs-debugging-tools.html#cb443-26" tabindex="-1"></a>    group <span class="ot">=</span> groups[[i]]</span>
<span id="cb443-27"><a href="squashing-bugs-with-rs-debugging-tools.html#cb443-27" tabindex="-1"></a>    </span>
<span id="cb443-28"><a href="squashing-bugs-with-rs-debugging-tools.html#cb443-28" tabindex="-1"></a>    <span class="co"># calculate the mean of a bunch of bootstrap resamples</span></span>
<span id="cb443-29"><a href="squashing-bugs-with-rs-debugging-tools.html#cb443-29" tabindex="-1"></a>    result[[i]] <span class="ot">=</span> <span class="fu">resample</span>(group<span class="sc">$</span>body_mass_g, <span class="at">B=</span>B)</span>
<span id="cb443-30"><a href="squashing-bugs-with-rs-debugging-tools.html#cb443-30" tabindex="-1"></a>  }</span>
<span id="cb443-31"><a href="squashing-bugs-with-rs-debugging-tools.html#cb443-31" tabindex="-1"></a></span>
<span id="cb443-32"><a href="squashing-bugs-with-rs-debugging-tools.html#cb443-32" tabindex="-1"></a>  <span class="co"># return the result</span></span>
<span id="cb443-33"><a href="squashing-bugs-with-rs-debugging-tools.html#cb443-33" tabindex="-1"></a>  result</span>
<span id="cb443-34"><a href="squashing-bugs-with-rs-debugging-tools.html#cb443-34" tabindex="-1"></a>}</span></code></pre></div>
<p>It looks like the error happens with the second group. Let’s change that <code>message()</code> into a call to <code>browser()</code> so we can look at the second group.</p>
<pre><code>## Browse[1]&gt; groups[[2]]
## # A tibble: 0 × 8
## # ℹ 8 variables: species &lt;fct&gt;, island &lt;fct&gt;, bill_length_mm &lt;dbl&gt;, bill_depth_mm &lt;dbl&gt;,
## #   flipper_length_mm &lt;int&gt;, body_mass_g &lt;int&gt;, sex &lt;fct&gt;, year &lt;int&gt;</code></pre>
<p>Ahhh, the second group is empty: it has no rows! There were simply no penguns in the data for some combinations of species and island! That’s why <code>1:N</code> gives us zero and we end up trying to assign the zeroth entry of <code>indx</code>.</p>
<p>Now we’ve isolated the problem and identified its cause. How would you solve it? (Hint: there are <em>many</em> solutions to this bug.) My solution would be to not try to resample the penguin masses of an empty group. Trying to loop over something like <code>1:N</code> happens a lot, and this is far from the first time that I’ve hit an error because <code>N=0</code>. A better way to define the limits of an interation counter is by <code>seq_len(N)</code>. Let’s swap that in for <code>1:N</code> on line 12 of <code>debug_case_study.R</code> and then re-run the problmatic line of code.</p>
<div class="sourceCode" id="cb445"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb445-1"><a href="squashing-bugs-with-rs-debugging-tools.html#cb445-1" tabindex="-1"></a>resample <span class="ot">=</span> <span class="cf">function</span>(data, B) {</span>
<span id="cb445-2"><a href="squashing-bugs-with-rs-debugging-tools.html#cb445-2" tabindex="-1"></a>  N <span class="ot">=</span> <span class="fu">length</span>(data)</span>
<span id="cb445-3"><a href="squashing-bugs-with-rs-debugging-tools.html#cb445-3" tabindex="-1"></a>  result <span class="ot">=</span> <span class="fu">numeric</span>(B)</span>
<span id="cb445-4"><a href="squashing-bugs-with-rs-debugging-tools.html#cb445-4" tabindex="-1"></a>  </span>
<span id="cb445-5"><a href="squashing-bugs-with-rs-debugging-tools.html#cb445-5" tabindex="-1"></a>  <span class="co"># repeat this whole process B times</span></span>
<span id="cb445-6"><a href="squashing-bugs-with-rs-debugging-tools.html#cb445-6" tabindex="-1"></a>  <span class="cf">for</span> (b <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>B) {</span>
<span id="cb445-7"><a href="squashing-bugs-with-rs-debugging-tools.html#cb445-7" tabindex="-1"></a>    </span>
<span id="cb445-8"><a href="squashing-bugs-with-rs-debugging-tools.html#cb445-8" tabindex="-1"></a>    <span class="co"># make an object to hold the resampled indices</span></span>
<span id="cb445-9"><a href="squashing-bugs-with-rs-debugging-tools.html#cb445-9" tabindex="-1"></a>    indx <span class="ot">=</span> <span class="fu">integer</span>(N)</span>
<span id="cb445-10"><a href="squashing-bugs-with-rs-debugging-tools.html#cb445-10" tabindex="-1"></a>    </span>
<span id="cb445-11"><a href="squashing-bugs-with-rs-debugging-tools.html#cb445-11" tabindex="-1"></a>    <span class="co"># resample one data point at a time</span></span>
<span id="cb445-12"><a href="squashing-bugs-with-rs-debugging-tools.html#cb445-12" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(N)) {</span>
<span id="cb445-13"><a href="squashing-bugs-with-rs-debugging-tools.html#cb445-13" tabindex="-1"></a>      indx[[i]] <span class="ot">=</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span>N, <span class="at">size=</span><span class="dv">1</span>)</span>
<span id="cb445-14"><a href="squashing-bugs-with-rs-debugging-tools.html#cb445-14" tabindex="-1"></a>    }</span>
<span id="cb445-15"><a href="squashing-bugs-with-rs-debugging-tools.html#cb445-15" tabindex="-1"></a>    </span>
<span id="cb445-16"><a href="squashing-bugs-with-rs-debugging-tools.html#cb445-16" tabindex="-1"></a>    <span class="co"># calculate the mean of this resampled data</span></span>
<span id="cb445-17"><a href="squashing-bugs-with-rs-debugging-tools.html#cb445-17" tabindex="-1"></a>    result[[b]] <span class="ot">=</span> <span class="fu">mean</span>(data[indx])</span>
<span id="cb445-18"><a href="squashing-bugs-with-rs-debugging-tools.html#cb445-18" tabindex="-1"></a>  }</span>
<span id="cb445-19"><a href="squashing-bugs-with-rs-debugging-tools.html#cb445-19" tabindex="-1"></a>  </span>
<span id="cb445-20"><a href="squashing-bugs-with-rs-debugging-tools.html#cb445-20" tabindex="-1"></a>  <span class="co"># return all of the mean resamples</span></span>
<span id="cb445-21"><a href="squashing-bugs-with-rs-debugging-tools.html#cb445-21" tabindex="-1"></a>  result</span>
<span id="cb445-22"><a href="squashing-bugs-with-rs-debugging-tools.html#cb445-22" tabindex="-1"></a>}</span>
<span id="cb445-23"><a href="squashing-bugs-with-rs-debugging-tools.html#cb445-23" tabindex="-1"></a></span>
<span id="cb445-24"><a href="squashing-bugs-with-rs-debugging-tools.html#cb445-24" tabindex="-1"></a><span class="fu">make_bootstrap_plots</span>(penguins, <span class="st">&quot;species&quot;</span>, <span class="st">&quot;island&quot;</span>)</span></code></pre></div>
<p><img src="04_debugging_files/figure-html/fixed-resample-1.png" width="672" /></p>
<p>Here you can see that the unobserved species/island combinations have been simply left empty and we no longer have an error. Yay!</p>
</div>
</div>
</div>
<div id="measuring-performance" class="section level2 hasAnchor" number="7.5">
<h2><span class="header-section-number">7.5</span> Measuring Performance<a href="squashing-bugs-with-rs-debugging-tools.html#measuring-performance" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>How quickly code runs and how much memory it uses can be just as much of an
obstacle to research computing tasks as errors and bugs. This section describes
some of the strategies you can use to estimate or measure the performance
characteristics of code, so that you can identify potential problems and fix
them.</p>
<div id="estimating-memory-usage" class="section level3 hasAnchor" number="7.5.1">
<h3><span class="header-section-number">7.5.1</span> Estimating Memory Usage<a href="squashing-bugs-with-rs-debugging-tools.html#estimating-memory-usage" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Running out of memory can be extremely frustrating, because it can slow down
your code or prevent it from running at all.</p>
<p>It’s useful to know how to estimate how much memory a given data structure will
use so that you can determine whether a programming strategy is feasible before
you even start writing code. The <a href="https://en.wikipedia.org/wiki/Central_processing_unit">central processing units</a> (CPUs) in most
modern computers are designed to work most efficiently with <a href="https://en.wikipedia.org/wiki/64-bit_computing">64 bits</a>
of data at a time. Consequently, R and other programming languages typically
use 64 bits to store each number (regardless of type). While the data
structures R uses create some additional overhead, you can use this fact to do
<a href="https://en.wikipedia.org/wiki/Back-of-the-envelope_calculation">back-of-the-envelope</a> calculations about how much memory a vector or
matrix of numbers will require.</p>
<p>Start by determining how many elements the data structure will contain. Then
multiply by 64 bits and divide by 8 to convert bits to bytes. You can then
repeatedly divide by 1024 to convert to kilobytes, megabytes, gigabytes, or
terabytes. For instance, an vector of 2 million numbers will require
approximately this many megabytes:</p>
<div class="sourceCode" id="cb446"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb446-1"><a href="squashing-bugs-with-rs-debugging-tools.html#cb446-1" tabindex="-1"></a>n <span class="ot">=</span> <span class="dv">2000000</span></span>
<span id="cb446-2"><a href="squashing-bugs-with-rs-debugging-tools.html#cb446-2" tabindex="-1"></a>n <span class="sc">*</span> (<span class="dv">64</span> <span class="sc">/</span> <span class="dv">8</span>) <span class="sc">/</span> <span class="dv">1024</span><span class="sc">^</span><span class="dv">2</span></span></code></pre></div>
<pre><code>## [1] 15.25879</code></pre>
<p>You can even write an R function to do these calculations for you! If you’re
not sure whether a particular programming strategy is realistic, do the memory
calculations <em>before</em> you start writing code. This is a simple way to avoid
strategies that are inefficient.</p>
<p>If you’ve already written some code and it runs out of memory, the first step
to fixing the problem is identifying the cause. The <a href="https://lobstr.r-lib.org/">lobstr</a> package provides
functions to explore how R is using memory.</p>
<p>You can use the <code>mem_used</code> function to get the amount of memory R is currently
using:</p>
<div class="sourceCode" id="cb448"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb448-1"><a href="squashing-bugs-with-rs-debugging-tools.html#cb448-1" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;lobstr&quot;</span>)</span>
<span id="cb448-2"><a href="squashing-bugs-with-rs-debugging-tools.html#cb448-2" tabindex="-1"></a><span class="fu">mem_used</span>()</span></code></pre></div>
<pre><code>## 72.48 MB</code></pre>
<p>Sometimes the culprit isn’t your code, but other applications on your computer.
Modern web browsers are especially memory-intensive, and closing yours while
you run code can make a big difference.</p>
<p>If you’ve determined that your code is the reason R runs out of memory, you can
use the <code>obj_size</code> function to get how much memory objects in your code
actually use:</p>
<div class="sourceCode" id="cb450"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb450-1"><a href="squashing-bugs-with-rs-debugging-tools.html#cb450-1" tabindex="-1"></a><span class="fu">obj_size</span>(<span class="dv">1</span>)</span></code></pre></div>
<pre><code>## 56 B</code></pre>
<div class="sourceCode" id="cb452"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb452-1"><a href="squashing-bugs-with-rs-debugging-tools.html#cb452-1" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">runif</span>(n)</span>
<span id="cb452-2"><a href="squashing-bugs-with-rs-debugging-tools.html#cb452-2" tabindex="-1"></a><span class="fu">obj_size</span>(x)</span></code></pre></div>
<pre><code>## 16.00 MB</code></pre>
<div class="sourceCode" id="cb454"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb454-1"><a href="squashing-bugs-with-rs-debugging-tools.html#cb454-1" tabindex="-1"></a><span class="fu">obj_size</span>(mtcars)</span></code></pre></div>
<pre><code>## 7.21 kB</code></pre>
<p>If a specific object created by your code uses a lot of memory, think about
ways you might change the code to avoid creating the object or avoid creating
the entire object at once. For instance, consider whether it’s possible to
create part of the object, save that to disk, remove it from memory, and then
create the another part.</p>
</div>
<div id="benchmarking" class="section level3 hasAnchor" number="7.5.2">
<h3><span class="header-section-number">7.5.2</span> Benchmarking<a href="squashing-bugs-with-rs-debugging-tools.html#benchmarking" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>Benchmarking</strong> means timing how long code takes to run. Benchmarking is
useful for evaluating different strategies to solve a computational problem and
for understanding how quickly (or slowly) your code runs. When you benchmark
code, it’s important to collect and aggregate multiple data points so that your
estimates reflect how the code performs on average.</p>
<p>R has built-in functions for timing code, but several packages provide
functions that are more convenient for benchmarking, because they automatically
run the code multiple times and return summary statistics. The two most mature
packages for benchmarking are:</p>
<ul>
<li><a href="https://cran.r-project.org/web/packages/microbenchmark/index.html">microbenchmark</a></li>
<li><a href="https://bench.r-lib.org/">bench</a></li>
</ul>
<p>The microbenchmark package is simpler to use. It provides a single function,
<code>microbenchmark</code>, for carrying out benchmarks. The function accepts any number
of expressions to benchmark as arguments. For example, to compare the speed of
<code>runif</code> and <code>rnorm</code> (as <code>A</code> and <code>B</code> respectively):</p>
<div class="sourceCode" id="cb456"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb456-1"><a href="squashing-bugs-with-rs-debugging-tools.html#cb456-1" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;microbenchmark&quot;</span>)</span>
<span id="cb456-2"><a href="squashing-bugs-with-rs-debugging-tools.html#cb456-2" tabindex="-1"></a><span class="fu">microbenchmark</span>(<span class="at">A =</span> <span class="fu">runif</span>(<span class="fl">1e5</span>), <span class="at">B =</span> <span class="fu">rnorm</span>(<span class="fl">1e5</span>))</span></code></pre></div>
<pre><code>## Unit: milliseconds
##  expr      min       lq     mean   median       uq      max neval cld
##     A 1.207291 1.508023 1.737142 1.559535 1.829925 5.192329   100  a 
##     B 3.977333 4.374098 4.808153 4.822005 5.283366 6.106592   100   b</code></pre>
<p>The <code>microbenchmark</code> has parameters to control the number of times each
expression runs, the units for the timings, and more. You can find the details
in <code>?microbenchmark</code>.</p>
</div>
<div id="profiling" class="section level3 hasAnchor" number="7.5.3">
<h3><span class="header-section-number">7.5.3</span> Profiling<a href="squashing-bugs-with-rs-debugging-tools.html#profiling" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>Profiling</strong> code means collecting data about the code as it runs, and a
<strong>profiler</strong> is a program that profiles code. A typical profiler estimates how
much time is spent on each expression (as actual time or as a percentage of
total runtime) and how much memory the code uses over time. Profiling is a good
way to determine which parts of your code are performance bottlenecks, so that
you can target them when you try to optimize your code.</p>
<p>R has a built-in profiler. You can use the <code>Rprof</code> function to enable or
disable the profiler. Essential parameters for the function are:</p>
<ul>
<li><code>filename</code> – a path to a file for storing results. Defaults to <code>Rprof.out</code>.</li>
<li><code>interval</code> – the time between samples, in seconds.</li>
<li><code>memory.profiling</code> – whether to track memory in addition to time.</li>
</ul>
<p>Set these parameters in the first call you make to <code>Rprof</code>, which will enable
the profiler. Then run the code you want to profile. At the end of the code,
call <code>Rprof(NULL)</code> to disable the profiler.</p>
<p>The profiler saves the collected data to a file. You can use the <code>summaryRprof</code>
function to read the profile data and get a summary. Essential parameters for
this function are:</p>
<ul>
<li><code>filename</code> – the path to the results file. Defaults to <code>Rprof.out</code>.</li>
<li><code>memory</code> – how to display memory information. Use <code>"both"</code> to see total
changes.</li>
</ul>
<p>The summary lists times in seconds and memory in bytes.</p>
<p>The <a href="https://rstudio.github.io/profvis/">profvis</a> package provides an interactive graphical interface for
exploring profile data collected with <code>Rprof</code>. Examining profile data
graphically makes it easier to interpret the results and to identify patterns.</p>

</div>
</div>
</div>



            </section>

          </div>
        </div>
      </div>
<a href="best-practices-for-writing-r-scripts.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="data-visualization-in-r.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/ucdavisdatalab/workshop_intermediate_r/edit/master/04_debugging.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/ucdavisdatalab/workshop_intermediate_r/blob/master/04_debugging.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
