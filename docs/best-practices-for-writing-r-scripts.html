<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 Best Practices for Writing R Scripts | Intermediate R</title>
  <meta name="description" content="3 Best Practices for Writing R Scripts | Intermediate R" />
  <meta name="generator" content="bookdown 0.37 and GitBook 2.6.7" />

  <meta property="og:title" content="3 Best Practices for Writing R Scripts | Intermediate R" />
  <meta property="og:type" content="book" />
  
  
  <meta name="github-repo" content="ucdavisdatalab/workshop_intermediate_r" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 Best Practices for Writing R Scripts | Intermediate R" />
  
  
  

<meta name="author" content="Nick Ulle and Wesley Brooks" />


<meta name="date" content="2024-01-14" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="tidy-relational-data.html"/>
<link rel="next" href="squashing-bugs-with-rs-debugging-tools.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="https://datalab.ucdavis.edu/">
  <img src="https://datalab.ucdavis.edu/wp-content/uploads/2019/07/datalab-logo-full-color-rgb-1.png" style="height: 100%; width: 100%; object-fit: contain" />
</a></li>
<li><a href="./" style="font-size: 18px">Intermediate R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Overview</a></li>
<li class="part"><span><b>I Cleaning &amp; Reshaping Data</b></span></li>
<li class="chapter" data-level="1" data-path="string-date-processing.html"><a href="string-date-processing.html"><i class="fa fa-check"></i><b>1</b> String &amp; Date Processing</a>
<ul>
<li class="chapter" data-level="1.1" data-path="string-date-processing.html"><a href="string-date-processing.html#the-tidyverse"><i class="fa fa-check"></i><b>1.1</b> The Tidyverse</a></li>
<li class="chapter" data-level="1.2" data-path="string-date-processing.html"><a href="string-date-processing.html#parsing-dates-times"><i class="fa fa-check"></i><b>1.2</b> Parsing Dates &amp; Times</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="string-date-processing.html"><a href="string-date-processing.html#the-lubridate-package"><i class="fa fa-check"></i><b>1.2.1</b> The lubridate Package</a></li>
<li class="chapter" data-level="1.2.2" data-path="string-date-processing.html"><a href="string-date-processing.html#case-study-ocean-temperatures"><i class="fa fa-check"></i><b>1.2.2</b> Case Study: Ocean Temperatures</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="string-date-processing.html"><a href="string-date-processing.html#string-fundamentals"><i class="fa fa-check"></i><b>1.3</b> String Fundamentals</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="string-date-processing.html"><a href="string-date-processing.html#printing"><i class="fa fa-check"></i><b>1.3.1</b> Printing</a></li>
<li class="chapter" data-level="1.3.2" data-path="string-date-processing.html"><a href="string-date-processing.html#escape-sequences"><i class="fa fa-check"></i><b>1.3.2</b> Escape Sequences</a></li>
<li class="chapter" data-level="1.3.3" data-path="string-date-processing.html"><a href="string-date-processing.html#raw-strings"><i class="fa fa-check"></i><b>1.3.3</b> Raw Strings</a></li>
<li class="chapter" data-level="1.3.4" data-path="string-date-processing.html"><a href="string-date-processing.html#character-encodings"><i class="fa fa-check"></i><b>1.3.4</b> Character Encodings</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="string-date-processing.html"><a href="string-date-processing.html#processing-strings"><i class="fa fa-check"></i><b>1.4</b> Processing Strings</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="string-date-processing.html"><a href="string-date-processing.html#the-stringr-package"><i class="fa fa-check"></i><b>1.4.1</b> The stringr Package</a></li>
<li class="chapter" data-level="1.4.2" data-path="string-date-processing.html"><a href="string-date-processing.html#regular-expressions"><i class="fa fa-check"></i><b>1.4.2</b> Regular Expressions</a></li>
<li class="chapter" data-level="1.4.3" data-path="string-date-processing.html"><a href="string-date-processing.html#replacing-parts-of-strings"><i class="fa fa-check"></i><b>1.4.3</b> Replacing Parts of Strings</a></li>
<li class="chapter" data-level="1.4.4" data-path="string-date-processing.html"><a href="string-date-processing.html#splitting-strings"><i class="fa fa-check"></i><b>1.4.4</b> Splitting Strings</a></li>
<li class="chapter" data-level="1.4.5" data-path="string-date-processing.html"><a href="string-date-processing.html#extracting-matches"><i class="fa fa-check"></i><b>1.4.5</b> Extracting Matches</a></li>
<li class="chapter" data-level="1.4.6" data-path="string-date-processing.html"><a href="string-date-processing.html#case-study-u.s.-warehouse-stocks"><i class="fa fa-check"></i><b>1.4.6</b> Case Study: U.S. Warehouse Stocks</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="string-date-processing.html"><a href="string-date-processing.html#regular-expression-examples"><i class="fa fa-check"></i><b>1.5</b> Regular Expression Examples</a>
<ul>
<li class="chapter" data-level="1.5.1" data-path="string-date-processing.html"><a href="string-date-processing.html#the-wildcard"><i class="fa fa-check"></i><b>1.5.1</b> The Wildcard</a></li>
<li class="chapter" data-level="1.5.2" data-path="string-date-processing.html"><a href="string-date-processing.html#escape-sequences-1"><i class="fa fa-check"></i><b>1.5.2</b> Escape Sequences</a></li>
<li class="chapter" data-level="1.5.3" data-path="string-date-processing.html"><a href="string-date-processing.html#anchors"><i class="fa fa-check"></i><b>1.5.3</b> Anchors</a></li>
<li class="chapter" data-level="1.5.4" data-path="string-date-processing.html"><a href="string-date-processing.html#character-classes"><i class="fa fa-check"></i><b>1.5.4</b> Character Classes</a></li>
<li class="chapter" data-level="1.5.5" data-path="string-date-processing.html"><a href="string-date-processing.html#quantifiers"><i class="fa fa-check"></i><b>1.5.5</b> Quantifiers</a></li>
<li class="chapter" data-level="1.5.6" data-path="string-date-processing.html"><a href="string-date-processing.html#groups"><i class="fa fa-check"></i><b>1.5.6</b> Groups</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="tidy-relational-data.html"><a href="tidy-relational-data.html"><i class="fa fa-check"></i><b>2</b> Tidy &amp; Relational Data</a>
<ul>
<li class="chapter" data-level="2.1" data-path="tidy-relational-data.html"><a href="tidy-relational-data.html#tidy-datasets"><i class="fa fa-check"></i><b>2.1</b> Tidy Datasets</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="tidy-relational-data.html"><a href="tidy-relational-data.html#the-tidyr-package"><i class="fa fa-check"></i><b>2.1.1</b> The tidyr Package</a></li>
<li class="chapter" data-level="2.1.2" data-path="tidy-relational-data.html"><a href="tidy-relational-data.html#rows-into-columns"><i class="fa fa-check"></i><b>2.1.2</b> Rows into Columns</a></li>
<li class="chapter" data-level="2.1.3" data-path="tidy-relational-data.html"><a href="tidy-relational-data.html#columns-into-rows"><i class="fa fa-check"></i><b>2.1.3</b> Columns into Rows</a></li>
<li class="chapter" data-level="2.1.4" data-path="tidy-relational-data.html"><a href="tidy-relational-data.html#separating-values"><i class="fa fa-check"></i><b>2.1.4</b> Separating Values</a></li>
<li class="chapter" data-level="2.1.5" data-path="tidy-relational-data.html"><a href="tidy-relational-data.html#case-study-smart-ridership"><i class="fa fa-check"></i><b>2.1.5</b> Case Study: SMART Ridership</a></li>
<li class="chapter" data-level="2.1.6" data-path="tidy-relational-data.html"><a href="tidy-relational-data.html#without-tidyr"><i class="fa fa-check"></i><b>2.1.6</b> Without tidyr</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="tidy-relational-data.html"><a href="tidy-relational-data.html#relational-datasets"><i class="fa fa-check"></i><b>2.2</b> Relational Datasets</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="tidy-relational-data.html"><a href="tidy-relational-data.html#the-dplyr-package"><i class="fa fa-check"></i><b>2.2.1</b> The dplyr Package</a></li>
<li class="chapter" data-level="2.2.2" data-path="tidy-relational-data.html"><a href="tidy-relational-data.html#gradebook-dataset"><i class="fa fa-check"></i><b>2.2.2</b> Gradebook Dataset</a></li>
<li class="chapter" data-level="2.2.3" data-path="tidy-relational-data.html"><a href="tidy-relational-data.html#left-joins"><i class="fa fa-check"></i><b>2.2.3</b> Left Joins</a></li>
<li class="chapter" data-level="2.2.4" data-path="tidy-relational-data.html"><a href="tidy-relational-data.html#other-joins"><i class="fa fa-check"></i><b>2.2.4</b> Other Joins</a></li>
<li class="chapter" data-level="2.2.5" data-path="tidy-relational-data.html"><a href="tidy-relational-data.html#getting-clever-with-join_by"><i class="fa fa-check"></i><b>2.2.5</b> Getting Clever with <code>join_by</code></a></li>
<li class="chapter" data-level="2.2.6" data-path="tidy-relational-data.html"><a href="tidy-relational-data.html#examples"><i class="fa fa-check"></i><b>2.2.6</b> Examples</a></li>
<li class="chapter" data-level="2.2.7" data-path="tidy-relational-data.html"><a href="tidy-relational-data.html#be-explicit"><i class="fa fa-check"></i><b>2.2.7</b> Be Explicit</a></li>
<li class="chapter" data-level="2.2.8" data-path="tidy-relational-data.html"><a href="tidy-relational-data.html#conclusion"><i class="fa fa-check"></i><b>2.2.8</b> Conclusion</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Writing &amp; Debugging R Code</b></span></li>
<li class="chapter" data-level="3" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html"><i class="fa fa-check"></i><b>3</b> Best Practices for Writing R Scripts</a>
<ul>
<li class="chapter" data-level="3.1" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#scripting-your-code"><i class="fa fa-check"></i><b>3.1</b> Scripting Your Code</a></li>
<li class="chapter" data-level="3.2" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#printing-output"><i class="fa fa-check"></i><b>3.2</b> Printing Output</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#the-print-function"><i class="fa fa-check"></i><b>3.2.1</b> The <code>print</code> Function</a></li>
<li class="chapter" data-level="3.2.2" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#the-message-function"><i class="fa fa-check"></i><b>3.2.2</b> The <code>message</code> Function</a></li>
<li class="chapter" data-level="3.2.3" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#the-cat-function"><i class="fa fa-check"></i><b>3.2.3</b> The <code>cat</code> Function</a></li>
<li class="chapter" data-level="3.2.4" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#formatting-output"><i class="fa fa-check"></i><b>3.2.4</b> Formatting Output</a></li>
<li class="chapter" data-level="3.2.5" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#logging-output"><i class="fa fa-check"></i><b>3.2.5</b> Logging Output</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#reading-input"><i class="fa fa-check"></i><b>3.3</b> Reading Input</a></li>
<li class="chapter" data-level="3.4" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#managing-packages"><i class="fa fa-check"></i><b>3.4</b> Managing Packages</a></li>
<li class="chapter" data-level="3.5" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#iteration-strategies"><i class="fa fa-check"></i><b>3.5</b> Iteration Strategies</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#for-loops"><i class="fa fa-check"></i><b>3.5.1</b> For-loops</a></li>
<li class="chapter" data-level="3.5.2" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#while-loops"><i class="fa fa-check"></i><b>3.5.2</b> While-loops</a></li>
<li class="chapter" data-level="3.5.3" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#saving-multiple-results"><i class="fa fa-check"></i><b>3.5.3</b> Saving Multiple Results</a></li>
<li class="chapter" data-level="3.5.4" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#break-next"><i class="fa fa-check"></i><b>3.5.4</b> Break &amp; Next</a></li>
<li class="chapter" data-level="3.5.5" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#planning-for-iteration"><i class="fa fa-check"></i><b>3.5.5</b> Planning for Iteration</a></li>
<li class="chapter" data-level="3.5.6" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#case-study-the-collatz-conjecture"><i class="fa fa-check"></i><b>3.5.6</b> Case Study: The Collatz Conjecture</a></li>
<li class="chapter" data-level="3.5.7" data-path="best-practices-for-writing-r-scripts.html"><a href="best-practices-for-writing-r-scripts.html#case-study-u.s.-fruit-prices"><i class="fa fa-check"></i><b>3.5.7</b> Case Study: U.S. Fruit Prices</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="squashing-bugs-with-rs-debugging-tools.html"><a href="squashing-bugs-with-rs-debugging-tools.html"><i class="fa fa-check"></i><b>4</b> Squashing Bugs with R’s Debugging Tools</a>
<ul>
<li class="chapter" data-level="4.1" data-path="squashing-bugs-with-rs-debugging-tools.html"><a href="squashing-bugs-with-rs-debugging-tools.html#printing-1"><i class="fa fa-check"></i><b>4.1</b> Printing</a></li>
<li class="chapter" data-level="4.2" data-path="squashing-bugs-with-rs-debugging-tools.html"><a href="squashing-bugs-with-rs-debugging-tools.html#the-conditions-system"><i class="fa fa-check"></i><b>4.2</b> The Conditions System</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="squashing-bugs-with-rs-debugging-tools.html"><a href="squashing-bugs-with-rs-debugging-tools.html#raising-conditions"><i class="fa fa-check"></i><b>4.2.1</b> Raising Conditions</a></li>
<li class="chapter" data-level="4.2.2" data-path="squashing-bugs-with-rs-debugging-tools.html"><a href="squashing-bugs-with-rs-debugging-tools.html#handling-conditions"><i class="fa fa-check"></i><b>4.2.2</b> Handling Conditions</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="squashing-bugs-with-rs-debugging-tools.html"><a href="squashing-bugs-with-rs-debugging-tools.html#global-options"><i class="fa fa-check"></i><b>4.3</b> Global Options</a></li>
<li class="chapter" data-level="4.4" data-path="squashing-bugs-with-rs-debugging-tools.html"><a href="squashing-bugs-with-rs-debugging-tools.html#debugging"><i class="fa fa-check"></i><b>4.4</b> Debugging</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="squashing-bugs-with-rs-debugging-tools.html"><a href="squashing-bugs-with-rs-debugging-tools.html#other-functions"><i class="fa fa-check"></i><b>4.4.1</b> Other Functions</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="squashing-bugs-with-rs-debugging-tools.html"><a href="squashing-bugs-with-rs-debugging-tools.html#measuring-performance"><i class="fa fa-check"></i><b>4.5</b> Measuring Performance</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="squashing-bugs-with-rs-debugging-tools.html"><a href="squashing-bugs-with-rs-debugging-tools.html#estimating-memory-usage"><i class="fa fa-check"></i><b>4.5.1</b> Estimating Memory Usage</a></li>
<li class="chapter" data-level="4.5.2" data-path="squashing-bugs-with-rs-debugging-tools.html"><a href="squashing-bugs-with-rs-debugging-tools.html#benchmarking"><i class="fa fa-check"></i><b>4.5.2</b> Benchmarking</a></li>
<li class="chapter" data-level="4.5.3" data-path="squashing-bugs-with-rs-debugging-tools.html"><a href="squashing-bugs-with-rs-debugging-tools.html#profiling"><i class="fa fa-check"></i><b>4.5.3</b> Profiling</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III Data Visualization &amp; Analysis in R</b></span></li>
<li class="chapter" data-level="5" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html"><i class="fa fa-check"></i><b>5</b> Data Visualization in R</a>
<ul>
<li class="chapter" data-level="5.1" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#our-friend-ggplot2"><i class="fa fa-check"></i><b>5.1</b> Our Friend <code>ggplot2</code></a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#the-grammar-of-graphics"><i class="fa fa-check"></i><b>5.1.1</b> The Grammar of Graphics</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#example-palmer-penguins"><i class="fa fa-check"></i><b>5.2</b> Example: Palmer Penguins</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#examining-the-plot"><i class="fa fa-check"></i><b>5.2.1</b> Examining the Plot</a></li>
<li class="chapter" data-level="5.2.2" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#duplicating-the-palmer-penguins-plot"><i class="fa fa-check"></i><b>5.2.2</b> Duplicating the Palmer Penguins Plot</a></li>
<li class="chapter" data-level="5.2.3" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#analysis"><i class="fa fa-check"></i><b>5.2.3</b> Analysis</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#layers"><i class="fa fa-check"></i><b>5.3</b> Layers</a></li>
<li class="chapter" data-level="5.4" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#guidelines-for-graphics"><i class="fa fa-check"></i><b>5.4</b> Guidelines for Graphics</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#data"><i class="fa fa-check"></i><b>5.4.1</b> Data</a></li>
<li class="chapter" data-level="5.4.2" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#feature-types"><i class="fa fa-check"></i><b>5.4.2</b> Feature Types</a></li>
<li class="chapter" data-level="5.4.3" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#theme-guidelines"><i class="fa fa-check"></i><b>5.4.3</b> Theme Guidelines</a></li>
<li class="chapter" data-level="5.4.4" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#scale-guidelines"><i class="fa fa-check"></i><b>5.4.4</b> Scale Guidelines</a></li>
<li class="chapter" data-level="5.4.5" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#facet-guidelines"><i class="fa fa-check"></i><b>5.4.5</b> Facet Guidelines</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#case-studies"><i class="fa fa-check"></i><b>5.5</b> Case Studies</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#counting-penguins"><i class="fa fa-check"></i><b>5.5.1</b> Counting Penguins</a></li>
<li class="chapter" data-level="5.5.2" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#experimental-data-with-error-bars"><i class="fa fa-check"></i><b>5.5.2</b> Experimental Data with Error Bars</a></li>
<li class="chapter" data-level="5.5.3" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#bird-flu-mortality"><i class="fa fa-check"></i><b>5.5.3</b> Bird Flu Mortality</a></li>
<li class="chapter" data-level="5.5.4" data-path="data-visualization-in-r.html"><a href="data-visualization-in-r.html#small-business-loans"><i class="fa fa-check"></i><b>5.5.4</b> Small Business Loans</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV Thinking in R</b></span></li>
<li class="chapter" data-level="6" data-path="language-fundamentals.html"><a href="language-fundamentals.html"><i class="fa fa-check"></i><b>6</b> Language Fundamentals</a>
<ul>
<li class="chapter" data-level="6.1" data-path="language-fundamentals.html"><a href="language-fundamentals.html#variables-environments"><i class="fa fa-check"></i><b>6.1</b> Variables &amp; Environments</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="language-fundamentals.html"><a href="language-fundamentals.html#whats-an-environment"><i class="fa fa-check"></i><b>6.1.1</b> What’s an Environment?</a></li>
<li class="chapter" data-level="6.1.2" data-path="language-fundamentals.html"><a href="language-fundamentals.html#reference-objects"><i class="fa fa-check"></i><b>6.1.2</b> Reference Objects</a></li>
<li class="chapter" data-level="6.1.3" data-path="language-fundamentals.html"><a href="language-fundamentals.html#the-local-environment"><i class="fa fa-check"></i><b>6.1.3</b> The Local Environment</a></li>
<li class="chapter" data-level="6.1.4" data-path="language-fundamentals.html"><a href="language-fundamentals.html#call-environments"><i class="fa fa-check"></i><b>6.1.4</b> Call Environments</a></li>
<li class="chapter" data-level="6.1.5" data-path="language-fundamentals.html"><a href="language-fundamentals.html#lexical-scoping"><i class="fa fa-check"></i><b>6.1.5</b> Lexical Scoping</a></li>
<li class="chapter" data-level="6.1.6" data-path="language-fundamentals.html"><a href="language-fundamentals.html#variable-lookup"><i class="fa fa-check"></i><b>6.1.6</b> Variable Lookup</a></li>
<li class="chapter" data-level="6.1.7" data-path="language-fundamentals.html"><a href="language-fundamentals.html#the-search-path"><i class="fa fa-check"></i><b>6.1.7</b> The Search Path</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="language-fundamentals.html"><a href="language-fundamentals.html#closures"><i class="fa fa-check"></i><b>6.2</b> Closures</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="language-fundamentals.html"><a href="language-fundamentals.html#tidy-closures"><i class="fa fa-check"></i><b>6.2.1</b> Tidy Closures</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="language-fundamentals.html"><a href="language-fundamentals.html#attributes"><i class="fa fa-check"></i><b>6.3</b> Attributes</a></li>
<li class="chapter" data-level="6.4" data-path="language-fundamentals.html"><a href="language-fundamentals.html#s3"><i class="fa fa-check"></i><b>6.4</b> S3</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="language-fundamentals.html"><a href="language-fundamentals.html#method-dispatch"><i class="fa fa-check"></i><b>6.4.1</b> Method Dispatch</a></li>
<li class="chapter" data-level="6.4.2" data-path="language-fundamentals.html"><a href="language-fundamentals.html#creating-objects"><i class="fa fa-check"></i><b>6.4.2</b> Creating Objects</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="language-fundamentals.html"><a href="language-fundamentals.html#other-object-systems"><i class="fa fa-check"></i><b>6.5</b> Other Object Systems</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="part-2.html"><a href="part-2.html"><i class="fa fa-check"></i><b>7</b> Part 2</a></li>
<li class="part"><span><b>V Backmatter</b></span></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="chapter" data-level="" data-path="assessment.html"><a href="assessment.html"><i class="fa fa-check"></i>Assessment</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Intermediate R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="best-practices-for-writing-r-scripts" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">3</span> Best Practices for Writing R Scripts<a href="best-practices-for-writing-r-scripts.html#best-practices-for-writing-r-scripts" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="learning-objectives-2" class="section level4 unnumbered hasAnchor">
<h4>Learning Objectives<a href="best-practices-for-writing-r-scripts.html#learning-objectives-2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>Identify and explain the difference between R’s various printing functions</li>
<li>Describe and use R’s for, while, and repeat loops</li>
<li>Identify the most appropriate iteration strategy for a given problem</li>
<li>Explain strategies to organize iterative code</li>
</ul>
</div>
<div id="scripting-your-code" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> Scripting Your Code<a href="best-practices-for-writing-r-scripts.html#scripting-your-code" class="anchor-section" aria-label="Anchor link to header"></a></h2>
</div>
<div id="printing-output" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> Printing Output<a href="best-practices-for-writing-r-scripts.html#printing-output" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This section introduces several different functions for printing output
and making that output easier to read.</p>
<div id="the-print-function" class="section level3 hasAnchor" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> The <code>print</code> Function<a href="best-practices-for-writing-r-scripts.html#the-print-function" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>print</code> function prints a <strong>string representation</strong> of an object to the
console. The string representation is usually formatted in a way that exposes
details important to programmers rather than users.</p>
<p>For example, when printing a vector, the function prints the position of the
first element on each line in square brackets <code>[ ]</code>:</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="best-practices-for-writing-r-scripts.html#cb226-1" tabindex="-1"></a><span class="fu">print</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>)</span></code></pre></div>
<pre><code>##   [1]   1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  18
##  [19]  19  20  21  22  23  24  25  26  27  28  29  30  31  32  33  34  35  36
##  [37]  37  38  39  40  41  42  43  44  45  46  47  48  49  50  51  52  53  54
##  [55]  55  56  57  58  59  60  61  62  63  64  65  66  67  68  69  70  71  72
##  [73]  73  74  75  76  77  78  79  80  81  82  83  84  85  86  87  88  89  90
##  [91]  91  92  93  94  95  96  97  98  99 100</code></pre>
<p>The <code>print</code> function also prints quotes around strings:</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="best-practices-for-writing-r-scripts.html#cb228-1" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&quot;Hi&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Hi&quot;</code></pre>
<p>These features make the <code>print</code> function ideal for printing information when
you’re trying to understand some code or diagnose a bug. On the other hand,
these features also make <code>print</code> a bad choice for printing output or status
messages for users (including you).</p>
<p>R calls the <code>print</code> function automatically anytime a result is returned at the
prompt. Thus it’s not necessary to call <code>print</code> to print something when you’re
working directly in the console—only from within loops, functions, scripts,
and other code that runs non-interactively.</p>
<p>The <code>print</code> function is an S3 generic (see Section <a href="language-fundamentals.html#s3">6.4</a>), so you if you
create an S3 class, you can define a custom print method for it. For S4
objects, R uses the S4 generic <code>show</code> instead of <code>print</code>.</p>
</div>
<div id="the-message-function" class="section level3 hasAnchor" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> The <code>message</code> Function<a href="best-practices-for-writing-r-scripts.html#the-message-function" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To print output for users, the <code>message</code> function is the one you should use.
The main reason for this is that the <code>message</code> function is part of R’s
<strong>conditions system</strong> for reporting status information as code runs. This makes
it easier for other code to detect, record, respond to, or suppress the output
(see Section <a href="squashing-bugs-with-rs-debugging-tools.html#the-conditions-system">4.2</a> to learn more about R’s conditions
system).</p>
<p>The <code>message</code> function prints its argument(s) and a newline to the console:</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="best-practices-for-writing-r-scripts.html#cb230-1" tabindex="-1"></a><span class="fu">message</span>(<span class="st">&quot;Hello world!&quot;</span>)</span></code></pre></div>
<pre><code>## Hello world!</code></pre>
<p>If an argument isn’t a string, the function automatically and silently attempts
to coerce it to one:</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="best-practices-for-writing-r-scripts.html#cb232-1" tabindex="-1"></a><span class="fu">message</span>(<span class="dv">4</span>)</span></code></pre></div>
<pre><code>## 4</code></pre>
<p>Some types of objects can’t be coerced to a string:</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="best-practices-for-writing-r-scripts.html#cb234-1" tabindex="-1"></a><span class="fu">message</span>(sqrt)</span></code></pre></div>
<pre><code>## Error in FUN(X[[i]], ...): cannot coerce type &#39;builtin&#39; to vector of type &#39;character&#39;</code></pre>
<p>For objects with multiple elements, the function pastes together the string
representations of the elements with no separators in between:</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="best-practices-for-writing-r-scripts.html#cb236-1" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb236-2"><a href="best-practices-for-writing-r-scripts.html#cb236-2" tabindex="-1"></a><span class="fu">message</span>(x)</span></code></pre></div>
<pre><code>## 123</code></pre>
<p>Similarly, if you pass the <code>message</code> function multiple arguments, it pastes
them together with no separators:</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="best-practices-for-writing-r-scripts.html#cb238-1" tabindex="-1"></a>name <span class="ot">=</span> <span class="st">&quot;R&quot;</span></span>
<span id="cb238-2"><a href="best-practices-for-writing-r-scripts.html#cb238-2" tabindex="-1"></a><span class="fu">message</span>(<span class="st">&quot;Hi, my name is &quot;</span>, name, <span class="st">&quot; and x is &quot;</span>, x)</span></code></pre></div>
<pre><code>## Hi, my name is R and x is 123</code></pre>
<p>This is a convenient way to print names or descriptions alongside values from
your code without having to call a formatting function like <code>paste</code>.</p>
<p>You can make the message function print something without adding a newline at
the end by setting the argument <code>appendLF = FALSE</code>. The difference can be easy
to miss unless you make several calls to <code>message</code>, so the <code>say_hello</code> function
in this example calls <code>message</code> twice:</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="best-practices-for-writing-r-scripts.html#cb240-1" tabindex="-1"></a>say_hello <span class="ot">=</span> <span class="cf">function</span>(appendLF) {</span>
<span id="cb240-2"><a href="best-practices-for-writing-r-scripts.html#cb240-2" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">&quot;Hello&quot;</span>, <span class="at">appendLF =</span> appendLF)</span>
<span id="cb240-3"><a href="best-practices-for-writing-r-scripts.html#cb240-3" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">&quot; world!&quot;</span>)</span>
<span id="cb240-4"><a href="best-practices-for-writing-r-scripts.html#cb240-4" tabindex="-1"></a>}</span>
<span id="cb240-5"><a href="best-practices-for-writing-r-scripts.html#cb240-5" tabindex="-1"></a></span>
<span id="cb240-6"><a href="best-practices-for-writing-r-scripts.html#cb240-6" tabindex="-1"></a><span class="fu">say_hello</span>(<span class="at">appendLF =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## Hello</code></pre>
<pre><code>##  world!</code></pre>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="best-practices-for-writing-r-scripts.html#cb243-1" tabindex="-1"></a><span class="fu">say_hello</span>(<span class="at">appendLF =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## Hello world!</code></pre>
<p>Note that RStudio always adds a newline in front of the prompt, so making an
isolated call to <code>message</code> with <code>appendLF = FALSE</code> appears to produce the same
output as with <code>appendLF = TRUE</code>. This is an example of a situation where
RStudio leads you astray: in an ordinary R console, the two are clearly
different.</p>
</div>
<div id="the-cat-function" class="section level3 hasAnchor" number="3.2.3">
<h3><span class="header-section-number">3.2.3</span> The <code>cat</code> Function<a href="best-practices-for-writing-r-scripts.html#the-cat-function" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>cat</code> function, whose name stands for “concatenate and print,” is a
low-level way to print output to the console or a file. The <code>message</code> function
prints output by calling <code>cat</code>, but <code>cat</code> is not part of R’s conditions system.</p>
<p>The <code>cat</code> function prints its argument(s) to the console. It does not add a
newline at the end:</p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="best-practices-for-writing-r-scripts.html#cb245-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Hello&quot;</span>)</span></code></pre></div>
<pre><code>## Hello</code></pre>
<p>As with <code>message</code>, RStudio hides the fact that there’s no newline if you make
an isolated call to <code>cat</code>.</p>
<p>The <code>cat</code> function coerces its arguments to strings and concatenates them. By
default, a space <code></code> is inserted between arguments and their elements:</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="best-practices-for-writing-r-scripts.html#cb247-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="dv">4</span>)</span></code></pre></div>
<pre><code>## 4</code></pre>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="best-practices-for-writing-r-scripts.html#cb249-1" tabindex="-1"></a><span class="fu">cat</span>(x)</span></code></pre></div>
<pre><code>## 1 2 3</code></pre>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="best-practices-for-writing-r-scripts.html#cb251-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Hello&quot;</span>, <span class="st">&quot;Nick&quot;</span>)</span></code></pre></div>
<pre><code>## Hello Nick</code></pre>
<p>You can set the <code>sep</code> parameter to control the separator <code>cat</code> inserts:</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="best-practices-for-writing-r-scripts.html#cb253-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Hello&quot;</span>, <span class="st">&quot;world&quot;</span>, x, <span class="at">sep =</span> <span class="st">&quot;|&quot;</span>)</span></code></pre></div>
<pre><code>## Hello|world|1|2|3</code></pre>
<p>If you want to write output to a file rather than to the console, you can call
<code>cat</code> with the <code>file</code> parameter set. However, it’s preferable to use functions
tailored to writing specific kinds of data, such as <code>writeLines</code> (for text) or
<code>write.table</code> (for tabular data), since they provide additional options to
control the output.</p>
<p>Many scripts and packages still use <code>cat</code> to print output, but the <code>message</code>
function provides more flexibility and control to people running the code. Thus
it’s generally preferable to use <code>message</code> in new code. Nevertheless, there are
a few specific cases where <code>cat</code> is useful—for example, if you want to pipe
data to a UNIX shell command. See <code>?cat</code> for details.</p>
</div>
<div id="formatting-output" class="section level3 hasAnchor" number="3.2.4">
<h3><span class="header-section-number">3.2.4</span> Formatting Output<a href="best-practices-for-writing-r-scripts.html#formatting-output" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>R provides a variety of ways to format data before you print it. Taking the
time to format output carefully makes it easier to read and understand, as well
as making your scripts seem more professional.</p>
<div id="escape-sequences-2" class="section level4 hasAnchor" number="3.2.4.1">
<h4><span class="header-section-number">3.2.4.1</span> Escape Sequences<a href="best-practices-for-writing-r-scripts.html#escape-sequences-2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>One way to format strings is by adding (or removing) <strong>escape sequences</strong>. An
escape sequence is a sequence of characters that represents some other
character, usually one that’s invisible (such as whitespace) or doesn’t appear
on a standard keyboard.</p>
<p>In R, escape sequences always begin with a backslash. For example, <code>\n</code> is a
newline. The <code>message</code> and <code>cat</code> functions automatically convert escape
sequences to the characters they represent:</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="best-practices-for-writing-r-scripts.html#cb255-1" tabindex="-1"></a>x <span class="ot">=</span> <span class="st">&quot;Hello</span><span class="sc">\n</span><span class="st">world!&quot;</span></span>
<span id="cb255-2"><a href="best-practices-for-writing-r-scripts.html#cb255-2" tabindex="-1"></a><span class="fu">message</span>(x)</span></code></pre></div>
<pre><code>## Hello
## world!</code></pre>
<p>The <code>print</code> function doesn’t convert escape sequences:</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="best-practices-for-writing-r-scripts.html#cb257-1" tabindex="-1"></a><span class="fu">print</span>(x)</span></code></pre></div>
<pre><code>## [1] &quot;Hello\nworld!&quot;</code></pre>
<p>Some escape sequences trigger special behavior in the console. For example,
ending a line with a carriage return <code>\r</code> makes the console print the next line
over the line. Try running this code in a console (it’s not possible to see the
result in a static book):</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="best-practices-for-writing-r-scripts.html#cb259-1" tabindex="-1"></a><span class="co"># Run this in an R console.</span></span>
<span id="cb259-2"><a href="best-practices-for-writing-r-scripts.html#cb259-2" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) {</span>
<span id="cb259-3"><a href="best-practices-for-writing-r-scripts.html#cb259-3" tabindex="-1"></a>  <span class="fu">message</span>(i, <span class="st">&quot;</span><span class="sc">\r</span><span class="st">&quot;</span>, <span class="at">appendLF =</span> <span class="cn">FALSE</span>)</span>
<span id="cb259-4"><a href="best-practices-for-writing-r-scripts.html#cb259-4" tabindex="-1"></a>  <span class="co"># Wait 0.5 seconds.</span></span>
<span id="cb259-5"><a href="best-practices-for-writing-r-scripts.html#cb259-5" tabindex="-1"></a>  <span class="fu">Sys.sleep</span>(<span class="fl">0.5</span>)</span>
<span id="cb259-6"><a href="best-practices-for-writing-r-scripts.html#cb259-6" tabindex="-1"></a>}</span></code></pre></div>
<p>You can find a complete list of escape sequences in <code>?Quotes</code>.</p>
</div>
<div id="formatting-functions" class="section level4 hasAnchor" number="3.2.4.2">
<h4><span class="header-section-number">3.2.4.2</span> Formatting Functions<a href="best-practices-for-writing-r-scripts.html#formatting-functions" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>You can use the <code>sprintf</code> function to apply specific formatting to values and
substitute them into strings. The function uses a mini-language to describe the
formatting and substitutions. The <code>sprintf</code> function (or something like it) is
available in many programming languages, so being familiar with it will serve
you well on your programming journey.</p>
<p>The key idea is that substitutions are marked by a percent sign <code>%</code> and a
character. The character indicates the kind of data to be substituted: <code>s</code> for
strings, <code>i</code> for integers, <code>f</code> for floating point numbers, and so on.</p>
<p>The first argument to <code>sprintf</code> must be a string, and subsequent arguments are
values to substitute into the string (from left to right). For example:</p>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="best-practices-for-writing-r-scripts.html#cb260-1" tabindex="-1"></a><span class="fu">sprintf</span>(<span class="st">&quot;My age is %i, and my name is %s&quot;</span>, <span class="dv">32</span>, <span class="st">&quot;Nick&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;My age is 32, and my name is Nick&quot;</code></pre>
<p>You can use the mini-language to do things like specify how many digits to
print after a decimal point. Format settings for a substituted value go between
the percent sign <code>%</code> and the character. For instance, here’s how to print <code>pi</code>
with 2 digits after the decimal:</p>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="best-practices-for-writing-r-scripts.html#cb262-1" tabindex="-1"></a><span class="fu">sprintf</span>(<span class="st">&quot;%.2f&quot;</span>, pi)</span></code></pre></div>
<pre><code>## [1] &quot;3.14&quot;</code></pre>
<p>You can learn more by reading <code>?sprintf</code>.</p>
<p>Much simpler are the <code>paste</code> and <code>paste0</code> functions, which coerce their
arguments to strings and concatenate (or “paste together”) them. The <code>paste</code>
function inserts a space <code></code> between each argument, while the <code>paste0</code>
function doesn’t:</p>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="best-practices-for-writing-r-scripts.html#cb264-1" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">&quot;Hello&quot;</span>, <span class="st">&quot;world&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Hello world&quot;</code></pre>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="best-practices-for-writing-r-scripts.html#cb266-1" tabindex="-1"></a><span class="fu">paste0</span>(<span class="st">&quot;Hello&quot;</span>,  <span class="st">&quot;world&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Helloworld&quot;</code></pre>
<p>You can control the character inserted between arguments with the <code>sep</code>
parameter.</p>
<p>By setting an argument for the <code>collapse</code> parameter, you can also use the
<code>paste</code> and <code>paste0</code> functions to concatenate the elements of a vector. The
argument to <code>collapse</code> is inserted between the elements. For example, suppose
you want to paste together elements of a vector inserting a comma and space
<code>,</code> in between:</p>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb268-1"><a href="best-practices-for-writing-r-scripts.html#cb268-1" tabindex="-1"></a><span class="fu">paste</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">collapse =</span> <span class="st">&quot;, &quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;1, 2, 3&quot;</code></pre>
<p>Members of the R community have developed many packages to make formatting
strings easier:</p>
<ul>
<li><a href="https://cli.r-lib.org/">cli</a> – helper functions for developing command-line interfaces,
including functions to add color, progress bars, and more.</li>
<li><a href="https://glue.tidyverse.org/">glue</a> – alternatives to <code>sprintf</code> for string iterpolation.</li>
<li><a href="https://stringr.tidyverse.org/">stringr</a> – a collection of general-purpose string manipulation functions.</li>
</ul>
</div>
</div>
<div id="logging-output" class="section level3 hasAnchor" number="3.2.5">
<h3><span class="header-section-number">3.2.5</span> Logging Output<a href="best-practices-for-writing-r-scripts.html#logging-output" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>Logging</strong> means saving the output from some code to a file as the code runs.
The file where the output is saved is called a <strong>log file</strong> or log, but this
name isn’t indicative of a specific format (unlike, say, a “CSV file”).</p>
<p>It’s a good idea to set up some kind of logging for any code that takes more
than a few minutes to run, because then if something goes wrong you can inspect
the log to diagnose the problem. Think of any output that’s not logged as
ephemeral: it could disappear if someone reboots the computer, or there’s a
power outage, or some other, unforeseen event.</p>
<p>R’s built-in tools for logging are rudimentary, but members of the community
have developed a variety of packages for logging. Here are a few that are still
actively maintained as of January 2023:</p>
<ul>
<li><a href="https://github.com/daroczig/logger">logger</a> – a relatively new package that aims to improve aspects of other
logging packages that R users find confusing.</li>
<li><a href="https://github.com/zatonovo/futile.logger">futile.logger</a> – a popular, mature logging package based on Apache’s
Log4j utility and on R idioms.</li>
<li><a href="https://github.com/WLOGSolutions/r-logging">logging</a> – a mature logging package based on Python’s <code>logging</code> module.</li>
<li><a href="https://github.com/ryapric/loggit">loggit</a> – integrates with R’s conditions system and writes logs in
JavaScript Object Notation (JSON) format so they are easy to inspect
programmatically.</li>
<li><a href="https://github.com/johnmyleswhite/log4r">log4r</a> – another package based on Log4j with an object-oriented
programming approach.</li>
</ul>
</div>
</div>
<div id="reading-input" class="section level2 hasAnchor" number="3.3">
<h2><span class="header-section-number">3.3</span> Reading Input<a href="best-practices-for-writing-r-scripts.html#reading-input" class="anchor-section" aria-label="Anchor link to header"></a></h2>
</div>
<div id="managing-packages" class="section level2 hasAnchor" number="3.4">
<h2><span class="header-section-number">3.4</span> Managing Packages<a href="best-practices-for-writing-r-scripts.html#managing-packages" class="anchor-section" aria-label="Anchor link to header"></a></h2>
</div>
<div id="iteration-strategies" class="section level2 hasAnchor" number="3.5">
<h2><span class="header-section-number">3.5</span> Iteration Strategies<a href="best-practices-for-writing-r-scripts.html#iteration-strategies" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>R is powerful tool for automating tasks that have repetitive steps. For
example, you can:</p>
<ul>
<li>Apply a transformation to an entire column of data.</li>
<li>Compute distances between all pairs from a set of points.</li>
<li>Read a large collection of files from disk in order to combine and analyze
the data they contain.</li>
<li>Simulate how a system evolves over time from a specific set of starting
parameters.</li>
<li>Scrape data from many pages of a website.</li>
</ul>
<p>You can implement concise, efficient solutions for these kinds of tasks in R by
using <strong>iteration</strong>, which means repeating a computation many times. R provides
four different strategies for writing iterative code:</p>
<ol style="list-style-type: decimal">
<li>Vectorization, where a function is implicitly called on each element of a
vector. See <a href="https://ucdavisdatalab.github.io/workshop_r_basics/data-structures.html#vectorization">this section</a> of the R Basics for more details.</li>
<li>Apply functions, where a function is explicitly called on each element of a
vector or array. See <a href="https://ucdavisdatalab.github.io/workshop_r_basics/exploring-data.html#apply-functions">this section</a> of the R Basics reader
for more details.</li>
<li>Loops, where an expression is evaluated repeatedly until some condition is
met.</li>
<li>Recursion, where a function calls itself.</li>
</ol>
<p>Vectorization is the most efficient and most concise iteration strategy, but
also the least flexible, because it only works with vectorized functions and
vectors. Apply functions are more flexible—they work with any function and
any data structure with elements—but less efficient and less concise. Loops
and recursion provide the most flexibility but are the least concise. In recent
versions of R, apply functions and loops are similar in terms of efficiency.
Recursion tends to be the least efficient iteration strategy in R.</p>
<p>The rest of this section explains how to write loops and how to choose which
iteration strategy to use. We assume you’re already comfortable with
vectorization and have at least some familiarity with apply functions.</p>
<div id="for-loops" class="section level3 hasAnchor" number="3.5.1">
<h3><span class="header-section-number">3.5.1</span> For-loops<a href="best-practices-for-writing-r-scripts.html#for-loops" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A <strong>for-loop</strong> evaluates an expression once for each element of a vector or
list. The <code>for</code> keyword creates a for-loop. The syntax is:</p>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb270-1"><a href="best-practices-for-writing-r-scripts.html#cb270-1" tabindex="-1"></a><span class="cf">for</span> (I <span class="cf">in</span> DATA) {</span>
<span id="cb270-2"><a href="best-practices-for-writing-r-scripts.html#cb270-2" tabindex="-1"></a>  <span class="co"># Your code goes here</span></span>
<span id="cb270-3"><a href="best-practices-for-writing-r-scripts.html#cb270-3" tabindex="-1"></a>}</span></code></pre></div>
<p>The variable <code>I</code> is called an <strong>induction variable</strong>. At the beginning of each
iteration, <code>I</code> is assigned the next element of <code>DATA</code>. The loop iterates once
for each element, unless a keyword instructs R to exit the loop early (more
about this in Section <a href="best-practices-for-writing-r-scripts.html#break-next">3.5.4</a>). As with if-statements and functions,
the curly braces <code>{ }</code> are only required if the body contains multiple lines of
code. Here’s a simple for-loop:</p>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb271-1"><a href="best-practices-for-writing-r-scripts.html#cb271-1" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb271-2"><a href="best-practices-for-writing-r-scripts.html#cb271-2" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">&quot;Hi from iteration  &quot;</span>, i)</span></code></pre></div>
<pre><code>## Hi from iteration  1</code></pre>
<pre><code>## Hi from iteration  2</code></pre>
<pre><code>## Hi from iteration  3</code></pre>
<pre><code>## Hi from iteration  4</code></pre>
<pre><code>## Hi from iteration  5</code></pre>
<pre><code>## Hi from iteration  6</code></pre>
<pre><code>## Hi from iteration  7</code></pre>
<pre><code>## Hi from iteration  8</code></pre>
<pre><code>## Hi from iteration  9</code></pre>
<pre><code>## Hi from iteration  10</code></pre>
<p>When some or all of the iterations in a task depend on results from prior
iterations, loops tend to be the most appropriate iteration strategy. For
instance, loops are a good way to implement time-based simulations or compute
values in recursively defined sequences.</p>
<p>As a concrete example, suppose you want to compute the result of starting from
the value 1 and composing the sine function 100 times:</p>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb282-1"><a href="best-practices-for-writing-r-scripts.html#cb282-1" tabindex="-1"></a>result <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb282-2"><a href="best-practices-for-writing-r-scripts.html#cb282-2" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>) {</span>
<span id="cb282-3"><a href="best-practices-for-writing-r-scripts.html#cb282-3" tabindex="-1"></a>  result <span class="ot">=</span> <span class="fu">sin</span>(result)</span>
<span id="cb282-4"><a href="best-practices-for-writing-r-scripts.html#cb282-4" tabindex="-1"></a>}</span>
<span id="cb282-5"><a href="best-practices-for-writing-r-scripts.html#cb282-5" tabindex="-1"></a></span>
<span id="cb282-6"><a href="best-practices-for-writing-r-scripts.html#cb282-6" tabindex="-1"></a>result</span></code></pre></div>
<pre><code>## [1] 0.1688525</code></pre>
<p>Unlike other iteration strategies, loops don’t return a result automatically.
It’s up to you to use variables to store any results you want to use later. If
you want to save a result from every iteration, you can use a vector or a list
indexed on the iteration number:</p>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="best-practices-for-writing-r-scripts.html#cb284-1" tabindex="-1"></a>n <span class="ot">=</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">100</span></span>
<span id="cb284-2"><a href="best-practices-for-writing-r-scripts.html#cb284-2" tabindex="-1"></a>result <span class="ot">=</span> <span class="fu">numeric</span>(n)</span>
<span id="cb284-3"><a href="best-practices-for-writing-r-scripts.html#cb284-3" tabindex="-1"></a>result[<span class="dv">1</span>] <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb284-4"><a href="best-practices-for-writing-r-scripts.html#cb284-4" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>n) {</span>
<span id="cb284-5"><a href="best-practices-for-writing-r-scripts.html#cb284-5" tabindex="-1"></a>  result[i] <span class="ot">=</span> <span class="fu">sin</span>(result[i <span class="sc">-</span> <span class="dv">1</span>])</span>
<span id="cb284-6"><a href="best-practices-for-writing-r-scripts.html#cb284-6" tabindex="-1"></a>}</span>
<span id="cb284-7"><a href="best-practices-for-writing-r-scripts.html#cb284-7" tabindex="-1"></a></span>
<span id="cb284-8"><a href="best-practices-for-writing-r-scripts.html#cb284-8" tabindex="-1"></a><span class="fu">plot</span>(result)</span></code></pre></div>
<p><img src="03_writing_r_scripts_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<p>Section <a href="best-practices-for-writing-r-scripts.html#saving-multiple-results">3.5.3</a> explains this in more detail.</p>
<p>If the iterations in a task are not dependent, it’s preferable to use
vectorization or apply functions instead of a loop. Vectorization is more
efficient, and apply functions are usually more concise.</p>
<p>In some cases, you can use vectorization to handle a task even if the
iterations are dependent. For example, you can use vectorized exponentiation
and the <code>sum</code> function to compute the sum of the cubes of many numbers:</p>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb285-1"><a href="best-practices-for-writing-r-scripts.html#cb285-1" tabindex="-1"></a>numbers <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">3</span>, <span class="dv">100</span>, <span class="sc">-</span><span class="dv">5</span>, <span class="dv">2</span>, <span class="dv">10</span>)</span>
<span id="cb285-2"><a href="best-practices-for-writing-r-scripts.html#cb285-2" tabindex="-1"></a><span class="fu">sum</span>(numbers<span class="sc">^</span><span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1] 1001910</code></pre>
</div>
<div id="while-loops" class="section level3 hasAnchor" number="3.5.2">
<h3><span class="header-section-number">3.5.2</span> While-loops<a href="best-practices-for-writing-r-scripts.html#while-loops" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A <strong>while-loop</strong> runs a block of code repeatedly as long as some condition is
<code>TRUE</code>. The <code>while</code> keyword creates a while-loop. The syntax is:</p>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="best-practices-for-writing-r-scripts.html#cb287-1" tabindex="-1"></a><span class="cf">while</span> (CONDITION) {</span>
<span id="cb287-2"><a href="best-practices-for-writing-r-scripts.html#cb287-2" tabindex="-1"></a>  <span class="co"># Your code goes here</span></span>
<span id="cb287-3"><a href="best-practices-for-writing-r-scripts.html#cb287-3" tabindex="-1"></a>}</span></code></pre></div>
<p>The <code>CONDITION</code> should be a scalar logical value or an expression that returns
one. At the beginning of each iteration, R checks the <code>CONDITION</code> and exits the
loop if it’s <code>FALSE</code>. As always, the curly braces <code>{ }</code> are only required if
the body contains multiple lines of code. Here’s a simple while-loop:</p>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb288-1"><a href="best-practices-for-writing-r-scripts.html#cb288-1" tabindex="-1"></a>i <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb288-2"><a href="best-practices-for-writing-r-scripts.html#cb288-2" tabindex="-1"></a><span class="cf">while</span> (i <span class="sc">&lt;</span> <span class="dv">10</span>) {</span>
<span id="cb288-3"><a href="best-practices-for-writing-r-scripts.html#cb288-3" tabindex="-1"></a>  i <span class="ot">=</span> i <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb288-4"><a href="best-practices-for-writing-r-scripts.html#cb288-4" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">&quot;Hello from iteration &quot;</span>, i)</span>
<span id="cb288-5"><a href="best-practices-for-writing-r-scripts.html#cb288-5" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## Hello from iteration 1</code></pre>
<pre><code>## Hello from iteration 2</code></pre>
<pre><code>## Hello from iteration 3</code></pre>
<pre><code>## Hello from iteration 4</code></pre>
<pre><code>## Hello from iteration 5</code></pre>
<pre><code>## Hello from iteration 6</code></pre>
<pre><code>## Hello from iteration 7</code></pre>
<pre><code>## Hello from iteration 8</code></pre>
<pre><code>## Hello from iteration 9</code></pre>
<pre><code>## Hello from iteration 10</code></pre>
<p>Notice that this example does the same thing as the simple for-loop in Section
<a href="best-practices-for-writing-r-scripts.html#for-loops">3.5.1</a>, but requires 5 lines of code instead of 2. While-loops are a
generalization of for-loops, and only do the bare minimum necessary to iterate.
They tend to be most useful when you don’t know how many iterations will be
necessary to complete a task.</p>
<p>As an example, suppose you want to add up the integers in order until the total
is greater than 50:</p>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb299-1"><a href="best-practices-for-writing-r-scripts.html#cb299-1" tabindex="-1"></a>total <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb299-2"><a href="best-practices-for-writing-r-scripts.html#cb299-2" tabindex="-1"></a>i <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb299-3"><a href="best-practices-for-writing-r-scripts.html#cb299-3" tabindex="-1"></a><span class="cf">while</span> (total <span class="sc">&lt;</span> <span class="dv">50</span>) {</span>
<span id="cb299-4"><a href="best-practices-for-writing-r-scripts.html#cb299-4" tabindex="-1"></a>  total <span class="ot">=</span> total <span class="sc">+</span> i</span>
<span id="cb299-5"><a href="best-practices-for-writing-r-scripts.html#cb299-5" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">&quot;i is &quot;</span>, i, <span class="st">&quot; total is &quot;</span>, total)</span>
<span id="cb299-6"><a href="best-practices-for-writing-r-scripts.html#cb299-6" tabindex="-1"></a>  i <span class="ot">=</span> i <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb299-7"><a href="best-practices-for-writing-r-scripts.html#cb299-7" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## i is 1 total is 1</code></pre>
<pre><code>## i is 2 total is 3</code></pre>
<pre><code>## i is 3 total is 6</code></pre>
<pre><code>## i is 4 total is 10</code></pre>
<pre><code>## i is 5 total is 15</code></pre>
<pre><code>## i is 6 total is 21</code></pre>
<pre><code>## i is 7 total is 28</code></pre>
<pre><code>## i is 8 total is 36</code></pre>
<pre><code>## i is 9 total is 45</code></pre>
<pre><code>## i is 10 total is 55</code></pre>
<div class="sourceCode" id="cb310"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb310-1"><a href="best-practices-for-writing-r-scripts.html#cb310-1" tabindex="-1"></a>total</span></code></pre></div>
<pre><code>## [1] 55</code></pre>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="best-practices-for-writing-r-scripts.html#cb312-1" tabindex="-1"></a>i</span></code></pre></div>
<pre><code>## [1] 11</code></pre>
</div>
<div id="saving-multiple-results" class="section level3 hasAnchor" number="3.5.3">
<h3><span class="header-section-number">3.5.3</span> Saving Multiple Results<a href="best-practices-for-writing-r-scripts.html#saving-multiple-results" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Loops often produce a different result for each iteration. If you want to save
more than one result, there are a few things you must do.</p>
<p>First, set up an index vector. The index vector should usually correspond to
the positions of the elements in the data you want to process. The <code>seq_along</code>
function returns an index vector when passed a vector or list. For instance:</p>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="best-practices-for-writing-r-scripts.html#cb314-1" tabindex="-1"></a>numbers <span class="ot">=</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">21</span>, <span class="dv">3</span>, <span class="sc">-</span><span class="dv">8</span>, <span class="dv">5</span>)</span>
<span id="cb314-2"><a href="best-practices-for-writing-r-scripts.html#cb314-2" tabindex="-1"></a>index <span class="ot">=</span> <span class="fu">seq_along</span>(numbers)</span></code></pre></div>
<p>The loop will iterate over the index rather than the input, so the induction
variable will track the current iteration number. On the first iteration, the
induction variable will be 1, on the second it will be 2, and so on. Then you
can use the induction variable and indexing to get the input for each
iteration.</p>
<p>Second, set up an empty output vector or list. This should usually also
correspond to the input, or one element longer (the extra element comes from
the initial value). R has several functions for creating vectors:</p>
<ul>
<li><p><code>logical</code>, <code>integer</code>, <code>numeric</code>, <code>complex</code>, and <code>character</code> create an empty
vector with a specific type and length</p></li>
<li><p><code>vector</code> creates an empty vector with a specific type and length</p></li>
<li><p><code>rep</code> creates a vector by repeating elements of some other vector</p></li>
</ul>
<p>Empty vectors are filled with <code>FALSE</code>, <code>0</code>, or <code>""</code>, depending on the type of
the vector. Here are some examples:</p>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb315-1"><a href="best-practices-for-writing-r-scripts.html#cb315-1" tabindex="-1"></a><span class="fu">logical</span>(<span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1] FALSE FALSE FALSE</code></pre>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb317-1"><a href="best-practices-for-writing-r-scripts.html#cb317-1" tabindex="-1"></a><span class="fu">numeric</span>(<span class="dv">4</span>)</span></code></pre></div>
<pre><code>## [1] 0 0 0 0</code></pre>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb319-1"><a href="best-practices-for-writing-r-scripts.html#cb319-1" tabindex="-1"></a><span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 1 2 1 2</code></pre>
<p>Let’s create an empty numeric vector congruent to the <code>numbers</code> vector:</p>
<div class="sourceCode" id="cb321"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb321-1"><a href="best-practices-for-writing-r-scripts.html#cb321-1" tabindex="-1"></a>n <span class="ot">=</span> <span class="fu">length</span>(numbers)</span>
<span id="cb321-2"><a href="best-practices-for-writing-r-scripts.html#cb321-2" tabindex="-1"></a>result <span class="ot">=</span> <span class="fu">numeric</span>(n)</span></code></pre></div>
<p>As with the input, you can use the induction variable and indexing to set the
output for each iteration.</p>
<p>Creating a vector or list in advance to store something, as we’ve just done, is
called <strong>preallocation</strong>. Preallocation is extremely important for efficiency
in loops. Avoid the temptation to use <code>c</code> or <code>append</code> to build up the output
bit by bit in each iteration.</p>
<p>Finally, write the loop, making sure to get the input and set the output. As an
example, this loop adds each element of <code>numbers</code> to a running total and
squares the new running total:</p>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="best-practices-for-writing-r-scripts.html#cb322-1" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> index) {</span>
<span id="cb322-2"><a href="best-practices-for-writing-r-scripts.html#cb322-2" tabindex="-1"></a>  prev <span class="ot">=</span> <span class="cf">if</span> (i <span class="sc">&gt;</span> <span class="dv">1</span>) result[i <span class="sc">-</span> <span class="dv">1</span>] <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb322-3"><a href="best-practices-for-writing-r-scripts.html#cb322-3" tabindex="-1"></a>  result[i] <span class="ot">=</span> (numbers[i] <span class="sc">+</span> prev)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb322-4"><a href="best-practices-for-writing-r-scripts.html#cb322-4" tabindex="-1"></a>}</span>
<span id="cb322-5"><a href="best-practices-for-writing-r-scripts.html#cb322-5" tabindex="-1"></a>result</span></code></pre></div>
<pre><code>## [1] 1.000000e+00 4.840000e+02 2.371690e+05 5.624534e+10 3.163538e+21</code></pre>
</div>
<div id="break-next" class="section level3 hasAnchor" number="3.5.4">
<h3><span class="header-section-number">3.5.4</span> Break &amp; Next<a href="best-practices-for-writing-r-scripts.html#break-next" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>break</code> keyword causes a loop to immediately exit. It only makes sense to
use <code>break</code> inside of an if-statement.</p>
<p>For example, suppose you want to print each string in a vector, but stop at the
first missing value. You can do this with a for-loop and the <code>break</code> keyword:</p>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb324-1"><a href="best-practices-for-writing-r-scripts.html#cb324-1" tabindex="-1"></a>my_messages <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;Hi&quot;</span>, <span class="st">&quot;Hello&quot;</span>, <span class="cn">NA</span>, <span class="st">&quot;Goodbye&quot;</span>)</span>
<span id="cb324-2"><a href="best-practices-for-writing-r-scripts.html#cb324-2" tabindex="-1"></a></span>
<span id="cb324-3"><a href="best-practices-for-writing-r-scripts.html#cb324-3" tabindex="-1"></a><span class="cf">for</span> (msg <span class="cf">in</span> my_messages) {</span>
<span id="cb324-4"><a href="best-practices-for-writing-r-scripts.html#cb324-4" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.na</span>(msg))</span>
<span id="cb324-5"><a href="best-practices-for-writing-r-scripts.html#cb324-5" tabindex="-1"></a>    <span class="cf">break</span></span>
<span id="cb324-6"><a href="best-practices-for-writing-r-scripts.html#cb324-6" tabindex="-1"></a></span>
<span id="cb324-7"><a href="best-practices-for-writing-r-scripts.html#cb324-7" tabindex="-1"></a>  <span class="fu">message</span>(msg)</span>
<span id="cb324-8"><a href="best-practices-for-writing-r-scripts.html#cb324-8" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## Hi</code></pre>
<pre><code>## Hello</code></pre>
<p>The <code>next</code> keyword causes a loop to immediately go to the next iteration. As
with <code>break</code>, it only makes sense to use <code>next</code> inside of an if-statement.</p>
<p>Let’s modify the previous example so that missing values are skipped, but don’t
cause printing to stop. Here’s the code:</p>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb327-1"><a href="best-practices-for-writing-r-scripts.html#cb327-1" tabindex="-1"></a><span class="cf">for</span> (msg <span class="cf">in</span> my_messages) {</span>
<span id="cb327-2"><a href="best-practices-for-writing-r-scripts.html#cb327-2" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.na</span>(msg))</span>
<span id="cb327-3"><a href="best-practices-for-writing-r-scripts.html#cb327-3" tabindex="-1"></a>    <span class="cf">next</span></span>
<span id="cb327-4"><a href="best-practices-for-writing-r-scripts.html#cb327-4" tabindex="-1"></a></span>
<span id="cb327-5"><a href="best-practices-for-writing-r-scripts.html#cb327-5" tabindex="-1"></a>  <span class="fu">message</span>(msg)</span>
<span id="cb327-6"><a href="best-practices-for-writing-r-scripts.html#cb327-6" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## Hi</code></pre>
<pre><code>## Hello</code></pre>
<pre><code>## Goodbye</code></pre>
<p>These keywords work with both for-loops and while-loops.</p>
</div>
<div id="planning-for-iteration" class="section level3 hasAnchor" number="3.5.5">
<h3><span class="header-section-number">3.5.5</span> Planning for Iteration<a href="best-practices-for-writing-r-scripts.html#planning-for-iteration" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>At first it may seem difficult to decide if and what kind of iteration to use.
Start by thinking about whether you need to do something over and over. If you
don’t, then you probably don’t need to use iteration. If you do, then try
iteration strategies in this order:</p>
<ol style="list-style-type: decimal">
<li>Vectorization</li>
<li>Apply functions
<ul>
<li>Try an apply function if iterations are independent.</li>
</ul></li>
<li>Loops
<ul>
<li>Try a for-loop if some iterations depend on others.</li>
<li>Try a while-loop if the number of iterations is unknown.</li>
</ul></li>
<li>Recursion (which isn’t covered here)
<ul>
<li>Convenient for naturally recursive problems (like Fibonacci),
but often there are faster solutions.</li>
</ul></li>
</ol>
<p>Start by writing the code for just one iteration. Make sure that code works;
it’s easy to test code for one iteration.</p>
<p>When you have one iteration working, then try using the code with an iteration
strategy (you will have to make some small changes). If it doesn’t work, try to
figure out which iteration is causing the problem. One way to do this is to use
<code>message</code> to print out information. Then try to write the code for the broken
iteration, get that iteration working, and repeat this whole process.</p>
</div>
<div id="case-study-the-collatz-conjecture" class="section level3 hasAnchor" number="3.5.6">
<h3><span class="header-section-number">3.5.6</span> Case Study: The Collatz Conjecture<a href="best-practices-for-writing-r-scripts.html#case-study-the-collatz-conjecture" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <a href="https://en.wikipedia.org/wiki/Collatz_conjecture">Collatz Conjecture</a> is a conjecture in math that was introduced
in 1937 by Lothar Collatz and remains unproven today, despite being relatively
easy to explain. Here’s a statement of the conjecture:</p>
<blockquote>
<p>Start from any positive integer. If the integer is even, divide by 2. If the
integer is odd, multiply by 3 and add 1.</p>
<p>If the result is not 1, repeat using the result as the new starting value.</p>
<p>The result will always reach 1 eventually, regardless of the starting value.</p>
</blockquote>
<p>The sequences of numbers this process generates are called <strong>Collatz
sequences</strong>. For instance, the Collatz sequence starting from 2 is <code>2, 1</code>. The
Collatz sequence starting from 12 is <code>12, 6, 3, 10, 5, 16, 8, 4, 2, 1</code>.</p>
<p>You can use iteration to compute the Collatz sequence for a given starting
value. Since each number in the sequence depends on the previous one, and since
the length of the sequence varies, a while-loop is the most appropriate
iteration strategy:</p>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb331-1"><a href="best-practices-for-writing-r-scripts.html#cb331-1" tabindex="-1"></a>n <span class="ot">=</span> <span class="dv">5</span></span>
<span id="cb331-2"><a href="best-practices-for-writing-r-scripts.html#cb331-2" tabindex="-1"></a>i <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb331-3"><a href="best-practices-for-writing-r-scripts.html#cb331-3" tabindex="-1"></a><span class="cf">while</span> (n <span class="sc">!=</span> <span class="dv">1</span>) {</span>
<span id="cb331-4"><a href="best-practices-for-writing-r-scripts.html#cb331-4" tabindex="-1"></a>  i <span class="ot">=</span> i <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb331-5"><a href="best-practices-for-writing-r-scripts.html#cb331-5" tabindex="-1"></a>  <span class="cf">if</span> (n <span class="sc">%%</span> <span class="dv">2</span> <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb331-6"><a href="best-practices-for-writing-r-scripts.html#cb331-6" tabindex="-1"></a>    n <span class="ot">=</span> n <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb331-7"><a href="best-practices-for-writing-r-scripts.html#cb331-7" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb331-8"><a href="best-practices-for-writing-r-scripts.html#cb331-8" tabindex="-1"></a>    n <span class="ot">=</span> <span class="dv">3</span> <span class="sc">*</span> n <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb331-9"><a href="best-practices-for-writing-r-scripts.html#cb331-9" tabindex="-1"></a>  }</span>
<span id="cb331-10"><a href="best-practices-for-writing-r-scripts.html#cb331-10" tabindex="-1"></a>  <span class="fu">message</span>(n, <span class="st">&quot; &quot;</span>, <span class="at">appendLF =</span> <span class="cn">FALSE</span>)</span>
<span id="cb331-11"><a href="best-practices-for-writing-r-scripts.html#cb331-11" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## 16 8 4 2 1</code></pre>
<p>As of 2020, scientists have used computers to check the Collatz sequences for
every number up to approximately <span class="math inline">\(2^{64}\)</span>. For more details about the Collatz
Conjecture, check out <a href="https://www.youtube.com/watch?v=094y1Z2wpJg">this video</a>.</p>
</div>
<div id="case-study-u.s.-fruit-prices" class="section level3 hasAnchor" number="3.5.7">
<h3><span class="header-section-number">3.5.7</span> Case Study: U.S. Fruit Prices<a href="best-practices-for-writing-r-scripts.html#case-study-u.s.-fruit-prices" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The U.S. Department of Agriculture (USDA) Economic Research Service (ERS)
publishes data about consumer food prices. For instance, in 2018 they posted a
<a href="https://www.ers.usda.gov/data-products/fruit-and-vegetable-prices/">dataset that estimates average retail prices for various fruits, vegetables,
and snack foods</a>. The estimates are formatted as a collection
of Excel files, one for each type of fruit or vegetable. In this case study,
you’ll use iteration to get the estimated “fresh” price for all of the fruits
in the dataset that are sold fresh.</p>
<p>To get started, download the <a href="https://www.ers.usda.gov/webdocs/DataFiles/51035/fruit%202013.zip?v=2437.6">zipped collection of fruit
spreadsheets</a> and save it somewhere on your computer. Then unzip the
file with a zip program or R’s own <code>unzip</code> function.</p>
<p>The first sheet of each file contains a table with the name of the fruit and
prices sorted by how the fruit was prepared. You can see this for yourself if
you use a spreadsheet program to inspect some of the files.</p>
<p>In order to read the files into R, first get a vector of their names. You can
use the <code>list.files</code> function to list all of the files in a directory. If you
set <code>full.names = TRUE</code>, the function will return the absolute path to each
file:</p>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="best-practices-for-writing-r-scripts.html#cb333-1" tabindex="-1"></a>paths <span class="ot">=</span> <span class="fu">list.files</span>(<span class="st">&quot;data/fruit&quot;</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb333-2"><a href="best-practices-for-writing-r-scripts.html#cb333-2" tabindex="-1"></a>paths</span></code></pre></div>
<pre><code>##  [1] &quot;data/fruit/apples_2013.xlsx&quot;         &quot;data/fruit/apricots_2013.xlsx&quot;      
##  [3] &quot;data/fruit/bananas_2013.xlsx&quot;        &quot;data/fruit/berries_mixed_2013.xlsx&quot; 
##  [5] &quot;data/fruit/blackberries_2013.xlsx&quot;   &quot;data/fruit/blueberries_2013.xlsx&quot;   
##  [7] &quot;data/fruit/cantaloupe_2013.xlsx&quot;     &quot;data/fruit/cherries_2013.xlsx&quot;      
##  [9] &quot;data/fruit/cranberries_2013.xlsx&quot;    &quot;data/fruit/dates_2013.xlsx&quot;         
## [11] &quot;data/fruit/figs_2013.xlsx&quot;           &quot;data/fruit/fruit_cocktail_2013.xlsx&quot;
## [13] &quot;data/fruit/grapefruit_2013.xlsx&quot;     &quot;data/fruit/grapes_2013.xlsx&quot;        
## [15] &quot;data/fruit/honeydew_2013.xlsx&quot;       &quot;data/fruit/kiwi_2013.xlsx&quot;          
## [17] &quot;data/fruit/mangoes_2013.xlsx&quot;        &quot;data/fruit/nectarines_2013.xlsx&quot;    
## [19] &quot;data/fruit/oranges_2013.xlsx&quot;        &quot;data/fruit/papaya_2013.xlsx&quot;        
## [21] &quot;data/fruit/peaches_2013.xlsx&quot;        &quot;data/fruit/pears_2013.xlsx&quot;         
## [23] &quot;data/fruit/pineapple_2013.xlsx&quot;      &quot;data/fruit/plums_2013.xlsx&quot;         
## [25] &quot;data/fruit/pomegranate_2013.xlsx&quot;    &quot;data/fruit/raspberries_2013.xlsx&quot;   
## [27] &quot;data/fruit/strawberries_2013.xlsx&quot;   &quot;data/fruit/tangerines_2013.xlsx&quot;    
## [29] &quot;data/fruit/watermelon_2013.xlsx&quot;</code></pre>
<p>The files are in Excel format, which you can read with the <code>read_excel</code>
function from the <a href="https://readxl.tidyverse.org/">readxl</a> package. First try reading one file and extracting
the fresh price:</p>
<div class="sourceCode" id="cb335"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb335-1"><a href="best-practices-for-writing-r-scripts.html#cb335-1" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;readxl&quot;</span>)</span>
<span id="cb335-2"><a href="best-practices-for-writing-r-scripts.html#cb335-2" tabindex="-1"></a></span>
<span id="cb335-3"><a href="best-practices-for-writing-r-scripts.html#cb335-3" tabindex="-1"></a>prices <span class="ot">=</span> <span class="fu">read_excel</span>(paths[<span class="dv">1</span>])</span></code></pre></div>
<pre><code>## New names:
## • `` -&gt; `...2`
## • `` -&gt; `...3`
## • `` -&gt; `...4`
## • `` -&gt; `...5`
## • `` -&gt; `...6`
## • `` -&gt; `...7`</code></pre>
<p>The name of the fruit is the first word in the first column’s name. The fresh
price appears in the row where the word in column 1 starts with <code>"Fresh"</code>. You
can use <code>str_which</code> from the stringr package (Section
<a href="string-date-processing.html#the-stringr-package">1.4.1</a>) to find and extract this row:</p>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb337-1"><a href="best-practices-for-writing-r-scripts.html#cb337-1" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;stringr&quot;</span>)</span>
<span id="cb337-2"><a href="best-practices-for-writing-r-scripts.html#cb337-2" tabindex="-1"></a></span>
<span id="cb337-3"><a href="best-practices-for-writing-r-scripts.html#cb337-3" tabindex="-1"></a>idx_fresh <span class="ot">=</span> <span class="fu">str_which</span>(prices[[<span class="dv">1</span>]], <span class="st">&quot;^Fresh&quot;</span>)</span>
<span id="cb337-4"><a href="best-practices-for-writing-r-scripts.html#cb337-4" tabindex="-1"></a>prices[idx_fresh, ]</span></code></pre></div>
<pre><code>## # A tibble: 1 × 7
##   Apples—Average retail price per pound or…¹ ...2  ...3  ...4  ...5  ...6  ...7 
##   &lt;chr&gt;                                      &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
## 1 Fresh1                                     1.56… per … 0.9   0.24… poun… 0.42…
## # ℹ abbreviated name:
## #   ¹​`Apples—Average retail price per pound or pint and per cup equivalent, 2013`</code></pre>
<p>The price and unit appear in column 2 and column 3.</p>
<p>Now generalize these steps by making a <code>read_fresh_price</code> function. The
function should accept a path as input and return a vector that contains the
fruit name, fresh price, and unit. Don’t worry about cleaning up the fruit name
at this point—you can do that with a vectorized operation after combining the
data from all of the files. A few fruits don’t have a fresh price, and the
function should return <code>NA</code> for the price and unit for those. Here’s one way to
implement the <code>read_fresh_price</code> function:</p>
<div class="sourceCode" id="cb339"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb339-1"><a href="best-practices-for-writing-r-scripts.html#cb339-1" tabindex="-1"></a>read_fresh_price <span class="ot">=</span> <span class="cf">function</span>(path) {</span>
<span id="cb339-2"><a href="best-practices-for-writing-r-scripts.html#cb339-2" tabindex="-1"></a>  prices <span class="ot">=</span> <span class="fu">read_excel</span>(path)</span>
<span id="cb339-3"><a href="best-practices-for-writing-r-scripts.html#cb339-3" tabindex="-1"></a></span>
<span id="cb339-4"><a href="best-practices-for-writing-r-scripts.html#cb339-4" tabindex="-1"></a>  <span class="co"># Get fruit name.</span></span>
<span id="cb339-5"><a href="best-practices-for-writing-r-scripts.html#cb339-5" tabindex="-1"></a>  fruit <span class="ot">=</span> <span class="fu">names</span>(prices)[[<span class="dv">1</span>]]</span>
<span id="cb339-6"><a href="best-practices-for-writing-r-scripts.html#cb339-6" tabindex="-1"></a></span>
<span id="cb339-7"><a href="best-practices-for-writing-r-scripts.html#cb339-7" tabindex="-1"></a>  <span class="co"># Find fresh price.</span></span>
<span id="cb339-8"><a href="best-practices-for-writing-r-scripts.html#cb339-8" tabindex="-1"></a>  idx <span class="ot">=</span> <span class="fu">str_which</span>(prices[[<span class="dv">1</span>]], <span class="st">&quot;^Fresh&quot;</span>)</span>
<span id="cb339-9"><a href="best-practices-for-writing-r-scripts.html#cb339-9" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(idx) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb339-10"><a href="best-practices-for-writing-r-scripts.html#cb339-10" tabindex="-1"></a>    prices <span class="ot">=</span> prices[idx, ]</span>
<span id="cb339-11"><a href="best-practices-for-writing-r-scripts.html#cb339-11" tabindex="-1"></a>    <span class="fu">c</span>(fruit, prices[[<span class="dv">2</span>]], prices[[<span class="dv">3</span>]])</span>
<span id="cb339-12"><a href="best-practices-for-writing-r-scripts.html#cb339-12" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb339-13"><a href="best-practices-for-writing-r-scripts.html#cb339-13" tabindex="-1"></a>    <span class="fu">c</span>(fruit, <span class="cn">NA</span>, <span class="cn">NA</span>)</span>
<span id="cb339-14"><a href="best-practices-for-writing-r-scripts.html#cb339-14" tabindex="-1"></a>  }</span>
<span id="cb339-15"><a href="best-practices-for-writing-r-scripts.html#cb339-15" tabindex="-1"></a>}</span></code></pre></div>
<p>Test that the function returns the correct result for a few of the files:</p>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb340-1"><a href="best-practices-for-writing-r-scripts.html#cb340-1" tabindex="-1"></a><span class="fu">read_fresh_price</span>(paths[[<span class="dv">1</span>]])</span></code></pre></div>
<pre><code>## New names:
## • `` -&gt; `...2`
## • `` -&gt; `...3`
## • `` -&gt; `...4`
## • `` -&gt; `...5`
## • `` -&gt; `...6`
## • `` -&gt; `...7`</code></pre>
<pre><code>## [1] &quot;Apples—Average retail price per pound or pint and per cup equivalent, 2013&quot;
## [2] &quot;1.5675153914496354&quot;                                                        
## [3] &quot;per pound&quot;</code></pre>
<div class="sourceCode" id="cb343"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb343-1"><a href="best-practices-for-writing-r-scripts.html#cb343-1" tabindex="-1"></a><span class="fu">read_fresh_price</span>(paths[[<span class="dv">4</span>]])</span></code></pre></div>
<pre><code>## New names:
## • `` -&gt; `...2`
## • `` -&gt; `...3`
## • `` -&gt; `...4`
## • `` -&gt; `...5`
## • `` -&gt; `...6`
## • `` -&gt; `...7`</code></pre>
<pre><code>## [1] &quot;Mixed berries—Average retail price per pound and per cup equivalent, 2013&quot;
## [2] NA                                                                         
## [3] NA</code></pre>
<div class="sourceCode" id="cb346"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb346-1"><a href="best-practices-for-writing-r-scripts.html#cb346-1" tabindex="-1"></a><span class="fu">read_fresh_price</span>(paths[[<span class="dv">8</span>]])</span></code></pre></div>
<pre><code>## New names:
## • `` -&gt; `...2`
## • `` -&gt; `...3`
## • `` -&gt; `...4`
## • `` -&gt; `...5`
## • `` -&gt; `...6`
## • `` -&gt; `...7`</code></pre>
<pre><code>## [1] &quot;Cherries—Average retail price per pound and per cup equivalent, 2013&quot;
## [2] &quot;3.5929897554945156&quot;                                                  
## [3] &quot;per pound&quot;</code></pre>
<p>Now that the function is working, it’s time to choose an iteration strategy.
The <code>read_fresh_price</code> function is not vectorized, so that strategy isn’t
possible. Reading one file doesn’t depend on reading any of the others, so
apply functions are the best strategy here. The <code>read_fresh_price</code> function
always returns a character vector with 3 elements, so you can use <code>sapply</code> to
process all of the files and get a matrix of results:</p>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb349-1"><a href="best-practices-for-writing-r-scripts.html#cb349-1" tabindex="-1"></a>all_prices <span class="ot">=</span> <span class="fu">sapply</span>(paths, read_fresh_price)</span></code></pre></div>
<pre><code>## New names:
## New names:
## New names:
## New names:
## New names:
## New names:
## New names:
## New names:
## New names:
## New names:
## New names:
## New names:
## New names:
## New names:
## New names:
## New names:
## New names:
## New names:
## New names:
## New names:
## New names:
## New names:
## New names:
## New names:
## New names:
## New names:
## New names:
## New names:
## New names:
## • `` -&gt; `...2`
## • `` -&gt; `...3`
## • `` -&gt; `...4`
## • `` -&gt; `...5`
## • `` -&gt; `...6`
## • `` -&gt; `...7`</code></pre>
<div class="sourceCode" id="cb351"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb351-1"><a href="best-practices-for-writing-r-scripts.html#cb351-1" tabindex="-1"></a><span class="co"># Transpose, convert to a data frame, and set names for easy reading.</span></span>
<span id="cb351-2"><a href="best-practices-for-writing-r-scripts.html#cb351-2" tabindex="-1"></a>all_prices <span class="ot">=</span> <span class="fu">t</span>(all_prices)</span>
<span id="cb351-3"><a href="best-practices-for-writing-r-scripts.html#cb351-3" tabindex="-1"></a>all_prices <span class="ot">=</span> <span class="fu">data.frame</span>(all_prices)</span>
<span id="cb351-4"><a href="best-practices-for-writing-r-scripts.html#cb351-4" tabindex="-1"></a><span class="fu">rownames</span>(all_prices) <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb351-5"><a href="best-practices-for-writing-r-scripts.html#cb351-5" tabindex="-1"></a><span class="fu">colnames</span>(all_prices) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;fruit&quot;</span>, <span class="st">&quot;price&quot;</span>, <span class="st">&quot;unit&quot;</span>)</span>
<span id="cb351-6"><a href="best-practices-for-writing-r-scripts.html#cb351-6" tabindex="-1"></a>all_prices</span></code></pre></div>
<pre><code>##                                                                              fruit
## 1       Apples—Average retail price per pound or pint and per cup equivalent, 2013
## 2             Apricots—Average retail price per pound and per cup equivalent, 2013
## 3              Bananas—Average retail price per pound and per cup equivalent, 2013
## 4        Mixed berries—Average retail price per pound and per cup equivalent, 2013
## 5         Blackberries—Average retail price per pound and per cup equivalent, 2013
## 6          Blueberries—Average retail price per pound and per cup equivalent, 2013
## 7           Cantaloupe—Average retail price per pound and per cup equivalent, 2013
## 8             Cherries—Average retail price per pound and per cup equivalent, 2013
## 9          Cranberries—Average retail price per pound and per cup equivalent, 2013
## 10               Dates—Average retail price per pound and per cup equivalent, 2013
## 11                Figs—Average retail price per pound and per cup equivalent, 2013
## 12      Fruit cocktail—Average retail price per pound and per cup equivalent, 2013
## 13  Grapefruit—Average retail price per pound or pint and per cup equivalent, 2013
## 14      Grapes—Average retail price per pound or pint and per cup equivalent, 2013
## 15      Honeydew melon—Average retail price per pound and per cup equivalent, 2013
## 16                Kiwi—Average retail price per pound and per cup equivalent, 2013
## 17             Mangoes—Average retail price per pound and per cup equivalent, 2013
## 18          Nectarines—Average retail price per pound and per cup equivalent, 2013
## 19     Oranges—Average retail price per pound or pint and per cup equivalent, 2013
## 20              Papaya—Average retail price per pound and per cup equivalent, 2013
## 21             Peaches—Average retail price per pound and per cup equivalent, 2013
## 22               Pears—Average retail price per pound and per cup equivalent, 2013
## 23   Pineapple—Average retail price per pound or pint and per cup equivalent, 2013
## 24       Plums—Average retail price per pound or pint and per cup equivalent, 2013
## 25 Pomegranate—Average retail price per pound or pint and per cup equivalent, 2013
## 26         Raspberries—Average retail price per pound and per cup equivalent, 2013
## 27        Strawberries—Average retail price per pound and per cup equivalent, 2013
## 28  Tangerines—Average retail price per pound or pint and per cup equivalent, 2013
## 29          Watermelon—Average retail price per pound and per cup equivalent, 2013
##                  price      unit
## 1   1.5675153914496354 per pound
## 2   3.0400719670964378 per pound
## 3  0.56698341453144807 per pound
## 4                 &lt;NA&gt;      &lt;NA&gt;
## 5   5.7747082503535152 per pound
## 6   4.7346216897250253 per pound
## 7  0.53587377610644515 per pound
## 8   3.5929897554945156 per pound
## 9                 &lt;NA&gt;      &lt;NA&gt;
## 10                &lt;NA&gt;      &lt;NA&gt;
## 11                &lt;NA&gt;      &lt;NA&gt;
## 12                &lt;NA&gt;      &lt;NA&gt;
## 13 0.89780204117954143 per pound
## 14  2.0938274120049827 per pound
## 15 0.79665620543008364 per pound
## 16  2.0446834079658482 per pound
## 17  1.3775634470319702 per pound
## 18  1.7611484827950696 per pound
## 19  1.0351727302444853 per pound
## 20  1.2980115892049107 per pound
## 21  1.5911868532458617 per pound
## 22  1.4615746043999458 per pound
## 23 0.62766194593569868 per pound
## 24  1.8274160078099031 per pound
## 25  2.1735904118559191 per pound
## 26  6.9758107988552958 per pound
## 27  2.3588084831103004 per pound
## 28  1.3779618772323634 per pound
## 29 0.33341203532340097 per pound</code></pre>
<p>Finally, the last step is to remove the extra text from the fruit name. One way
to do this is with the <code>str_split_fixed</code> function from the stringr package.
There’s an en dash <code>—</code> after each fruit name, which you can use for the split:</p>
<div class="sourceCode" id="cb353"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb353-1"><a href="best-practices-for-writing-r-scripts.html#cb353-1" tabindex="-1"></a>fruit <span class="ot">=</span> <span class="fu">str_split_fixed</span>(all_prices<span class="sc">$</span>fruit, <span class="st">&quot;—&quot;</span>, <span class="dv">2</span>)[, <span class="dv">1</span>]</span>
<span id="cb353-2"><a href="best-practices-for-writing-r-scripts.html#cb353-2" tabindex="-1"></a>all_prices<span class="sc">$</span>fruit <span class="ot">=</span> fruit</span>
<span id="cb353-3"><a href="best-practices-for-writing-r-scripts.html#cb353-3" tabindex="-1"></a>all_prices</span></code></pre></div>
<pre><code>##             fruit               price      unit
## 1          Apples  1.5675153914496354 per pound
## 2        Apricots  3.0400719670964378 per pound
## 3         Bananas 0.56698341453144807 per pound
## 4   Mixed berries                &lt;NA&gt;      &lt;NA&gt;
## 5    Blackberries  5.7747082503535152 per pound
## 6     Blueberries  4.7346216897250253 per pound
## 7      Cantaloupe 0.53587377610644515 per pound
## 8        Cherries  3.5929897554945156 per pound
## 9     Cranberries                &lt;NA&gt;      &lt;NA&gt;
## 10          Dates                &lt;NA&gt;      &lt;NA&gt;
## 11           Figs                &lt;NA&gt;      &lt;NA&gt;
## 12 Fruit cocktail                &lt;NA&gt;      &lt;NA&gt;
## 13     Grapefruit 0.89780204117954143 per pound
## 14         Grapes  2.0938274120049827 per pound
## 15 Honeydew melon 0.79665620543008364 per pound
## 16           Kiwi  2.0446834079658482 per pound
## 17        Mangoes  1.3775634470319702 per pound
## 18     Nectarines  1.7611484827950696 per pound
## 19        Oranges  1.0351727302444853 per pound
## 20         Papaya  1.2980115892049107 per pound
## 21        Peaches  1.5911868532458617 per pound
## 22          Pears  1.4615746043999458 per pound
## 23      Pineapple 0.62766194593569868 per pound
## 24          Plums  1.8274160078099031 per pound
## 25    Pomegranate  2.1735904118559191 per pound
## 26    Raspberries  6.9758107988552958 per pound
## 27   Strawberries  2.3588084831103004 per pound
## 28     Tangerines  1.3779618772323634 per pound
## 29     Watermelon 0.33341203532340097 per pound</code></pre>
<p>Now the data are ready for analysis. You could extend the reader function to
extract more of the data (e.g., dried and frozen prices), but the overall
process is fundamentally the same. Write the code to handle one file (one
step), generalize it to work on several, and then iterate.</p>
<p>For another example, see Liza Wood’s <a href="https://d-rug.github.io/realworld_functions_iteration/">Real-world Function Writing
Mini-reader</a>.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="tidy-relational-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="squashing-bugs-with-rs-debugging-tools.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/ucdavisdatalab/workshop_intermediate_r/edit/master/03_writing_r_scripts.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/ucdavisdatalab/workshop_intermediate_r/blob/master/03_writing_r_scripts.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
