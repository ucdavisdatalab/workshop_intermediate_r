<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Automating Tasks | Intermediate R</title>
  <meta name="description" content="4 Automating Tasks | Intermediate R" />
  <meta name="generator" content="bookdown 0.29 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Automating Tasks | Intermediate R" />
  <meta property="og:type" content="book" />
  
  
  <meta name="github-repo" content="ucdavisdatalab/workshop_intermediate_r" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Automating Tasks | Intermediate R" />
  
  
  

<meta name="author" content="Nick Ulle" />


<meta name="date" content="2022-12-16" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="string-date-processing.html"/>
<link rel="next" href="assessment.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="libs/str_view-0.1.0/str_view.css" rel="stylesheet" />
<script src="libs/str_view-binding-1.4.0/str_view.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="https://datalab.ucdavis.edu/">
  <img src="https://datalab.ucdavis.edu/wp-content/uploads/2019/07/datalab-logo-full-color-rgb-1.png" style="height: 100%; width: 100%; object-fit: contain" />
</a></li>
<li><a href="./" style="font-size: 18px">Intermediate R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Overview</a></li>
<li class="chapter" data-level="1" data-path="language-fundamentals.html"><a href="language-fundamentals.html"><i class="fa fa-check"></i><b>1</b> Language Fundamentals</a>
<ul>
<li class="chapter" data-level="1.1" data-path="language-fundamentals.html"><a href="language-fundamentals.html#variable-scope-lookup"><i class="fa fa-check"></i><b>1.1</b> Variable Scope &amp; Lookup</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="language-fundamentals.html"><a href="language-fundamentals.html#local-variables"><i class="fa fa-check"></i><b>1.1.1</b> Local Variables</a></li>
<li class="chapter" data-level="1.1.2" data-path="language-fundamentals.html"><a href="language-fundamentals.html#lexical-scoping"><i class="fa fa-check"></i><b>1.1.2</b> Lexical Scoping</a></li>
<li class="chapter" data-level="1.1.3" data-path="language-fundamentals.html"><a href="language-fundamentals.html#dynamic-lookup"><i class="fa fa-check"></i><b>1.1.3</b> Dynamic Lookup</a></li>
<li class="chapter" data-level="1.1.4" data-path="language-fundamentals.html"><a href="language-fundamentals.html#summary"><i class="fa fa-check"></i><b>1.1.4</b> Summary</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="debugging.html"><a href="debugging.html"><i class="fa fa-check"></i><b>2</b> Debugging</a></li>
<li class="chapter" data-level="3" data-path="string-date-processing.html"><a href="string-date-processing.html"><i class="fa fa-check"></i><b>3</b> String &amp; Date Processing</a>
<ul>
<li class="chapter" data-level="3.1" data-path="string-date-processing.html"><a href="string-date-processing.html#the-tidyverse"><i class="fa fa-check"></i><b>3.1</b> The Tidyverse</a></li>
<li class="chapter" data-level="3.2" data-path="string-date-processing.html"><a href="string-date-processing.html#date-processing"><i class="fa fa-check"></i><b>3.2</b> Date Processing</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="string-date-processing.html"><a href="string-date-processing.html#case-study-correcting-dates"><i class="fa fa-check"></i><b>3.2.1</b> Case Study: Correcting Dates</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="string-date-processing.html"><a href="string-date-processing.html#printing-output"><i class="fa fa-check"></i><b>3.3</b> Printing Output</a></li>
<li class="chapter" data-level="3.4" data-path="string-date-processing.html"><a href="string-date-processing.html#escape-sequences"><i class="fa fa-check"></i><b>3.4</b> Escape Sequences</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="string-date-processing.html"><a href="string-date-processing.html#raw-strings"><i class="fa fa-check"></i><b>3.4.1</b> Raw Strings</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="string-date-processing.html"><a href="string-date-processing.html#character-encodings"><i class="fa fa-check"></i><b>3.5</b> Character Encodings</a></li>
<li class="chapter" data-level="3.6" data-path="string-date-processing.html"><a href="string-date-processing.html#the-stringr-package"><i class="fa fa-check"></i><b>3.6</b> The stringr Package</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="string-date-processing.html"><a href="string-date-processing.html#splitting-strings"><i class="fa fa-check"></i><b>3.6.1</b> Splitting Strings</a></li>
<li class="chapter" data-level="3.6.2" data-path="string-date-processing.html"><a href="string-date-processing.html#replacing-parts-of-strings"><i class="fa fa-check"></i><b>3.6.2</b> Replacing Parts of Strings</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="string-date-processing.html"><a href="string-date-processing.html#regular-expressions"><i class="fa fa-check"></i><b>3.7</b> Regular Expressions</a>
<ul>
<li class="chapter" data-level="3.7.1" data-path="string-date-processing.html"><a href="string-date-processing.html#the-wildcard"><i class="fa fa-check"></i><b>3.7.1</b> The Wildcard</a></li>
<li class="chapter" data-level="3.7.2" data-path="string-date-processing.html"><a href="string-date-processing.html#escape-sequences-1"><i class="fa fa-check"></i><b>3.7.2</b> Escape Sequences</a></li>
<li class="chapter" data-level="3.7.3" data-path="string-date-processing.html"><a href="string-date-processing.html#anchors"><i class="fa fa-check"></i><b>3.7.3</b> Anchors</a></li>
<li class="chapter" data-level="3.7.4" data-path="string-date-processing.html"><a href="string-date-processing.html#character-classes"><i class="fa fa-check"></i><b>3.7.4</b> Character Classes</a></li>
<li class="chapter" data-level="3.7.5" data-path="string-date-processing.html"><a href="string-date-processing.html#quantifiers"><i class="fa fa-check"></i><b>3.7.5</b> Quantifiers</a></li>
<li class="chapter" data-level="3.7.6" data-path="string-date-processing.html"><a href="string-date-processing.html#groups"><i class="fa fa-check"></i><b>3.7.6</b> Groups</a></li>
<li class="chapter" data-level="3.7.7" data-path="string-date-processing.html"><a href="string-date-processing.html#extracting-matches"><i class="fa fa-check"></i><b>3.7.7</b> Extracting Matches</a></li>
<li class="chapter" data-level="3.7.8" data-path="string-date-processing.html"><a href="string-date-processing.html#case-study-extracting-emails"><i class="fa fa-check"></i><b>3.7.8</b> Case Study: Extracting Emails</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="automating-tasks.html"><a href="automating-tasks.html"><i class="fa fa-check"></i><b>4</b> Automating Tasks</a>
<ul>
<li class="chapter" data-level="4.1" data-path="automating-tasks.html"><a href="automating-tasks.html#loops"><i class="fa fa-check"></i><b>4.1</b> Loops</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="automating-tasks.html"><a href="automating-tasks.html#for-loops"><i class="fa fa-check"></i><b>4.1.1</b> For-loops</a></li>
<li class="chapter" data-level="4.1.2" data-path="automating-tasks.html"><a href="automating-tasks.html#while-loops"><i class="fa fa-check"></i><b>4.1.2</b> While-loops</a></li>
<li class="chapter" data-level="4.1.3" data-path="automating-tasks.html"><a href="automating-tasks.html#saving-multiple-results"><i class="fa fa-check"></i><b>4.1.3</b> Saving Multiple Results</a></li>
<li class="chapter" data-level="4.1.4" data-path="automating-tasks.html"><a href="automating-tasks.html#break-next"><i class="fa fa-check"></i><b>4.1.4</b> Break &amp; Next</a></li>
<li class="chapter" data-level="4.1.5" data-path="automating-tasks.html"><a href="automating-tasks.html#example-the-collatz-conjecture"><i class="fa fa-check"></i><b>4.1.5</b> Example: The Collatz Conjecture</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="automating-tasks.html"><a href="automating-tasks.html#planning-for-iteration"><i class="fa fa-check"></i><b>4.2</b> Planning for Iteration</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="assessment.html"><a href="assessment.html"><i class="fa fa-check"></i>Assessment</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Intermediate R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="automating-tasks" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">4</span> Automating Tasks<a href="automating-tasks.html#automating-tasks" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="loops" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Loops<a href="automating-tasks.html#loops" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<!--
* Run code repeatedly in a for-loop
* Describe the different types of loops and how to choose between them
-->
<p>One major benefit of using a programming language like R is that repetitive
tasks can be automated. We’ve already seen two ways to do this:</p>
<ol style="list-style-type: decimal">
<li><p>Vectorization, introduced in Section <a href="#vectorization"><strong>??</strong></a></p></li>
<li><p>Apply functions, introduced in Section <a href="#apply-functions"><strong>??</strong></a></p></li>
</ol>
<p>Both of these are <em>iteration strategies</em>. They <em>iterate</em> over some object, and
compute something for each element. Each one of these computations is one
<em>iteration</em>. Vectorization is the most efficient iteration strategy, but only
works with vectorized functions and vectors. Apply functions are more
flexible—they work with any function and any data structure with
elements—but less efficient and less concise.</p>
<p>A <em>loop</em> is another iteration strategy, one that’s even more flexible than
apply functions. Besides being flexible, loops are a feature of almost all
modern programming languages, so it’s useful to understand them. In R, there
are two kinds of loops. We’ll learn both.</p>
<div id="for-loops" class="section level3 hasAnchor" number="4.1.1">
<h3><span class="header-section-number">4.1.1</span> For-loops<a href="automating-tasks.html#for-loops" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A <em>for-loop</em> runs a block of code once for each element of a vector or list.
The <code>for</code> keyword creates a for-loop. Here’s the syntax:</p>
<pre><code>for (I in DATA) {
  # Your code goes here
}</code></pre>
<p>The variable <code>I</code> is called the <em>induction variable</em>. At the beginning of each
iteration, <code>I</code> is assigned the next element of the vector or list <code>DATA</code>. The
loop iterates once for each element of <code>DATA</code>, unless you use a keyword to exit
the loop early (more about this in Section <a href="automating-tasks.html#break-next">4.1.4</a>). As with
if-statements and functions, the curly braces <code>{ }</code> are only required if the
body contains multiple lines of code.</p>
<p>Unlike the other iteration strategies, loops do not automatically return a
result. You have complete control over the output, which means that anything
you want to save must be assigned to a variable.</p>
<p>For example, let’s make a loop that repeatedly adds a number to a running total
and squares the new total. We’ll use a variable <code>total</code> to keep track of the
running total as the loop iterates:</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="automating-tasks.html#cb113-1" aria-hidden="true" tabindex="-1"></a>numbers <span class="ot">=</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="sc">-</span><span class="dv">3</span>, <span class="dv">2</span>)</span>
<span id="cb113-2"><a href="automating-tasks.html#cb113-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-3"><a href="automating-tasks.html#cb113-3" aria-hidden="true" tabindex="-1"></a>total <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb113-4"><a href="automating-tasks.html#cb113-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (number <span class="cf">in</span> numbers) {</span>
<span id="cb113-5"><a href="automating-tasks.html#cb113-5" aria-hidden="true" tabindex="-1"></a>  total <span class="ot">=</span> (total <span class="sc">+</span> number)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb113-6"><a href="automating-tasks.html#cb113-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb113-7"><a href="automating-tasks.html#cb113-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-8"><a href="automating-tasks.html#cb113-8" aria-hidden="true" tabindex="-1"></a>total</span></code></pre></div>
<pre><code>## [1] 9</code></pre>
<p>Use for-loops when some or all of the iterations depend on results from other
iterations. If the iterations are not dependent, use one of:</p>
<ol style="list-style-type: decimal">
<li>Vectorization (because it’s faster)</li>
<li>Apply functions (because they’re idiomatic)</li>
</ol>
<p>In some cases, you can use vectorization even when the iterations are
dependent. For example, you can use vectorization to compute the sum of the
cubes of several numbers:</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="automating-tasks.html#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(numbers<span class="sc">^</span><span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1] -19</code></pre>
</div>
<div id="while-loops" class="section level3 hasAnchor" number="4.1.2">
<h3><span class="header-section-number">4.1.2</span> While-loops<a href="automating-tasks.html#while-loops" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A <em>while-loop</em> runs a block of code repeatedly as long as some condition is
<code>TRUE</code>. The <code>while</code> keyword creates a while-loop. Here’s the syntax:</p>
<pre><code>while (CONDITION) {
  # Your code goes here
}</code></pre>
<p>The <code>CONDITION</code> should be a scalar logical value or an expression that returns
one. At the beginning of each iteration, <code>CONDITION</code> is checked, and the loop
exits if it is <code>FALSE</code>. As always, the curly braces <code>{ }</code> are only required if
the body contains multiple lines of code.</p>
<p>For example, suppose you want to add up numbers from 0 to 50, but stop as soon
as the total is greater than 50:</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="automating-tasks.html#cb118-1" aria-hidden="true" tabindex="-1"></a>num50 <span class="ot">=</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">50</span>)</span>
<span id="cb118-2"><a href="automating-tasks.html#cb118-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-3"><a href="automating-tasks.html#cb118-3" aria-hidden="true" tabindex="-1"></a>total <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb118-4"><a href="automating-tasks.html#cb118-4" aria-hidden="true" tabindex="-1"></a>i <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb118-5"><a href="automating-tasks.html#cb118-5" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (total <span class="sc">&lt;</span> <span class="dv">50</span>) {</span>
<span id="cb118-6"><a href="automating-tasks.html#cb118-6" aria-hidden="true" tabindex="-1"></a>  total <span class="ot">=</span> total <span class="sc">+</span> num50[i]</span>
<span id="cb118-7"><a href="automating-tasks.html#cb118-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">&quot;i is &quot;</span>, i, <span class="st">&quot; total is &quot;</span>, total)</span>
<span id="cb118-8"><a href="automating-tasks.html#cb118-8" aria-hidden="true" tabindex="-1"></a>  i <span class="ot">=</span> i <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb118-9"><a href="automating-tasks.html#cb118-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## i is 1 total is 0</code></pre>
<pre><code>## i is 2 total is 1</code></pre>
<pre><code>## i is 3 total is 3</code></pre>
<pre><code>## i is 4 total is 6</code></pre>
<pre><code>## i is 5 total is 10</code></pre>
<pre><code>## i is 6 total is 15</code></pre>
<pre><code>## i is 7 total is 21</code></pre>
<pre><code>## i is 8 total is 28</code></pre>
<pre><code>## i is 9 total is 36</code></pre>
<pre><code>## i is 10 total is 45</code></pre>
<pre><code>## i is 11 total is 55</code></pre>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="automating-tasks.html#cb130-1" aria-hidden="true" tabindex="-1"></a>total</span></code></pre></div>
<pre><code>## [1] 55</code></pre>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="automating-tasks.html#cb132-1" aria-hidden="true" tabindex="-1"></a>i</span></code></pre></div>
<pre><code>## [1] 12</code></pre>
<p>While-loops are a generalization of for-loops. They tend to be most useful when
you don’t know how many iterations will be necessary. For example, suppose you
want to repeat a computation until the result falls within some range of
values.</p>
</div>
<div id="saving-multiple-results" class="section level3 hasAnchor" number="4.1.3">
<h3><span class="header-section-number">4.1.3</span> Saving Multiple Results<a href="automating-tasks.html#saving-multiple-results" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Loops often produce a different result for each iteration. If you want to save
more than one result, there are a few things you must do.</p>
<p>First, set up an index vector. The index vector should usually be congruent to
the number of iterations or the input. The <code>seq_along</code> function returns a
congruent index vector when passed a vector or list. For instance, let’s make
in index for the <code>numbers</code> vector from Section <a href="automating-tasks.html#for-loops">4.1.1</a>:</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="automating-tasks.html#cb134-1" aria-hidden="true" tabindex="-1"></a>index <span class="ot">=</span> <span class="fu">seq_along</span>(numbers)</span></code></pre></div>
<p>The loop will iterate over the index rather than the input, so the induction
variable will track the current iteration number. On the first iteration, the
induction variable will be 1, on the second it will be 2, and so on. Then you
can use the induction variable and indexing to get the input for each
iteration.</p>
<p>Second, set up an empty output vector or list. This should usually be congruent
to the input, or one element longer (the extra element comes from the initial
value). R has several functions for creating vectors. We’ve already seen a few,
but here are more:</p>
<ul>
<li><p><code>logical</code>, <code>integer</code>, <code>numeric</code>, <code>complex</code>, and <code>character</code> to create an
empty vector with a specific type and length</p></li>
<li><p><code>vector</code> to create an empty vector with a specific type and length</p></li>
<li><p><code>rep</code> to create a vector by repeating elements of some other vector</p></li>
</ul>
<p>Empty vectors are filled with <code>FALSE</code>, <code>0</code>, or <code>""</code>, depending on the type of
the vector. Here are some examples:</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="automating-tasks.html#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logical</span>(<span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1] FALSE FALSE FALSE</code></pre>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="automating-tasks.html#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="fu">numeric</span>(<span class="dv">4</span>)</span></code></pre></div>
<pre><code>## [1] 0 0 0 0</code></pre>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="automating-tasks.html#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 1 2 1 2</code></pre>
<p>Let’s create an empty numeric vector congruent to <code>numbers</code>:</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="automating-tasks.html#cb141-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">=</span> <span class="fu">length</span>(numbers)</span>
<span id="cb141-2"><a href="automating-tasks.html#cb141-2" aria-hidden="true" tabindex="-1"></a>result <span class="ot">=</span> <span class="fu">numeric</span>(n)</span></code></pre></div>
<p>As with the input, you can use the induction variable and indexing to set the
output for each iteration.</p>
<p>Creating a vector or list in advance to store something, as we’ve just done, is
called <em>preallocation</em>. Preallocation is extremely important for efficiency in
loops. Avoid the temptation to use <code>c</code> or <code>append</code> to build up the output bit
by bit in each iteration.</p>
<p>Finally, write the loop, making sure to get the input and set the output.
Here’s the loop for the squared sums example:</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="automating-tasks.html#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> index) {</span>
<span id="cb142-2"><a href="automating-tasks.html#cb142-2" aria-hidden="true" tabindex="-1"></a>  prev <span class="ot">=</span> <span class="cf">if</span> (i <span class="sc">&gt;</span> <span class="dv">1</span>) result[i <span class="sc">-</span> <span class="dv">1</span>] <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb142-3"><a href="automating-tasks.html#cb142-3" aria-hidden="true" tabindex="-1"></a>  result[i] <span class="ot">=</span> (numbers[i] <span class="sc">+</span> prev)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb142-4"><a href="automating-tasks.html#cb142-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb142-5"><a href="automating-tasks.html#cb142-5" aria-hidden="true" tabindex="-1"></a>result</span></code></pre></div>
<pre><code>## [1] 1 4 1 9</code></pre>
</div>
<div id="break-next" class="section level3 hasAnchor" number="4.1.4">
<h3><span class="header-section-number">4.1.4</span> Break &amp; Next<a href="automating-tasks.html#break-next" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>break</code> keyword causes a loop to immediately exit. It only makes sense to
use <code>break</code> inside of an if-statement.</p>
<p>For example, suppose we want to print each string in a vector, but stop at the
first missing value. We can do this with <code>break</code>:</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="automating-tasks.html#cb144-1" aria-hidden="true" tabindex="-1"></a>my_messages <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;Hi&quot;</span>, <span class="st">&quot;Hello&quot;</span>, <span class="cn">NA</span>, <span class="st">&quot;Goodbye&quot;</span>)</span>
<span id="cb144-2"><a href="automating-tasks.html#cb144-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-3"><a href="automating-tasks.html#cb144-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (msg <span class="cf">in</span> my_messages) {</span>
<span id="cb144-4"><a href="automating-tasks.html#cb144-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.na</span>(msg))</span>
<span id="cb144-5"><a href="automating-tasks.html#cb144-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">break</span></span>
<span id="cb144-6"><a href="automating-tasks.html#cb144-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-7"><a href="automating-tasks.html#cb144-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(msg)</span>
<span id="cb144-8"><a href="automating-tasks.html#cb144-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## Hi</code></pre>
<pre><code>## Hello</code></pre>
<p>The <code>next</code> keyword causes a loop to immediately go to the next iteration. As
with <code>break</code>, it only makes sense to use <code>next</code> inside of an if-statement.</p>
<p>Let’s modify the previous example so that missing values are skipped, but don’t
cause printing to stop. Here’s the code:</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="automating-tasks.html#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (msg <span class="cf">in</span> my_messages) {</span>
<span id="cb147-2"><a href="automating-tasks.html#cb147-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.na</span>(msg))</span>
<span id="cb147-3"><a href="automating-tasks.html#cb147-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">next</span></span>
<span id="cb147-4"><a href="automating-tasks.html#cb147-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-5"><a href="automating-tasks.html#cb147-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(msg)</span>
<span id="cb147-6"><a href="automating-tasks.html#cb147-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## Hi</code></pre>
<pre><code>## Hello</code></pre>
<pre><code>## Goodbye</code></pre>
<p>These keywords work with both for-loops and while-loops.</p>
</div>
<div id="example-the-collatz-conjecture" class="section level3 hasAnchor" number="4.1.5">
<h3><span class="header-section-number">4.1.5</span> Example: The Collatz Conjecture<a href="automating-tasks.html#example-the-collatz-conjecture" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <a href="">Collatz Conjecture</a> is a conjecture in math that was introduced
in 1937 by Lothar Collatz and remains unproven today, despite being relatively
easy to explain. Here’s a statement of the conjecture:</p>
<blockquote>
<p>Start from any positive integer. If the integer is even, divide by 2. If the
integer is odd, multiply by 3 and add 1.</p>
<p>If the result is not 1, repeat using the result as the new starting value.</p>
<p>The result will always reach 1 eventually, regardless of the starting value.</p>
</blockquote>
<p>The sequences of numbers this process generates are called <em>Collatz sequences</em>.
For instance, the Collatz sequence starting from 2 is <code>2, 1</code>. The Collatz
sequence starting from 12 is <code>12, 6, 3, 10, 5, 16, 8, 4, 2, 1</code>.</p>
<p>As a final loop example, let’s use a while-loop to compute Collatz sequences.
Here’s the code:</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="automating-tasks.html#cb151-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">=</span> <span class="dv">5</span></span>
<span id="cb151-2"><a href="automating-tasks.html#cb151-2" aria-hidden="true" tabindex="-1"></a>i <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb151-3"><a href="automating-tasks.html#cb151-3" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (n <span class="sc">!=</span> <span class="dv">1</span>) {</span>
<span id="cb151-4"><a href="automating-tasks.html#cb151-4" aria-hidden="true" tabindex="-1"></a>  i <span class="ot">=</span> i <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb151-5"><a href="automating-tasks.html#cb151-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (n <span class="sc">%%</span> <span class="dv">2</span> <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb151-6"><a href="automating-tasks.html#cb151-6" aria-hidden="true" tabindex="-1"></a>    n <span class="ot">=</span> n <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb151-7"><a href="automating-tasks.html#cb151-7" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb151-8"><a href="automating-tasks.html#cb151-8" aria-hidden="true" tabindex="-1"></a>    n <span class="ot">=</span> <span class="dv">3</span> <span class="sc">*</span> n <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb151-9"><a href="automating-tasks.html#cb151-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb151-10"><a href="automating-tasks.html#cb151-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="fu">paste0</span>(n, <span class="st">&quot; &quot;</span>))</span>
<span id="cb151-11"><a href="automating-tasks.html#cb151-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## 16</code></pre>
<pre><code>## 8</code></pre>
<pre><code>## 4</code></pre>
<pre><code>## 2</code></pre>
<pre><code>## 1</code></pre>
<p>As of 2020, scientists have used computers to check the Collatz sequences for
every number up to approximately <span class="math inline">\(2^{64}\)</span>. For more details about the Collatz
Conjecture, check out <a href="https://www.youtube.com/watch?v=094y1Z2wpJg">this video</a>.</p>
</div>
</div>
<div id="planning-for-iteration" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Planning for Iteration<a href="automating-tasks.html#planning-for-iteration" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>At first it may seem difficult to decide if and what kind of iteration to use.
Start by thinking about whether you need to do something over and over. If you
don’t, then you probably don’t need to use iteration. If you do, then try
iteration strategies in this order:</p>
<ol style="list-style-type: decimal">
<li>vectorization</li>
<li>apply functions
<ul>
<li>Try an apply function if iterations are independent.</li>
</ul></li>
<li>for/while-loops
<ul>
<li>Try a for-loop if some iterations depend on others.</li>
<li>Try a while-loop if the number of iterations is unknown.</li>
</ul></li>
<li>recursion (which isn’t covered here)
<ul>
<li>Convenient for naturally recursive problems (like Fibonacci),
but often there are faster solutions.</li>
</ul></li>
</ol>
<p>Start by writing the code for just one iteration. Make sure that code works;
it’s easy to test code for one iteration.</p>
<p>When you have one iteration working, then try using the code with an iteration
strategy (you will have to make some small changes). If it doesn’t work, try to
figure out which iteration is causing the problem. One way to do this is to use
<code>message</code> to print out information. Then try to write the code for the broken
iteration, get that iteration working, and repeat this whole process.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="string-date-processing.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="assessment.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/ucdavisdatalab/workshop_intermediate_r/edit/master/04_automating_tasks.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/ucdavisdatalab/workshop_intermediate_r/blob/master/04_automating_tasks.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
